<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"nigelkeel.gitee.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="9月16日（day 0）# 0 开发所需# 12345# node.js# vuenpm uninstall vue-cli -g # 先全局卸载脚手架2npm install @vue&#x2F;cli -g  # 安装脚手架4vue -V                   # 检查版本 1 新建项目并安装项目依赖# 123456vue create gshop_clientcd gshop_clie">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue 商城项目">
<meta property="og:url" content="http://nigelkeel.gitee.io/252001/index.html">
<meta property="og:site_name" content="永远的伊尔瓦">
<meta property="og:description" content="9月16日（day 0）# 0 开发所需# 12345# node.js# vuenpm uninstall vue-cli -g # 先全局卸载脚手架2npm install @vue&#x2F;cli -g  # 安装脚手架4vue -V                   # 检查版本 1 新建项目并安装项目依赖# 123456vue create gshop_clientcd gshop_clie">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-02-02T08:49:16.316Z">
<meta property="article:modified_time" content="2021-02-02T17:42:29.064Z">
<meta property="article:author" content="KEEL">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://nigelkeel.gitee.io/252001/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
  <title>Vue 商城项目 | 永远的伊尔瓦</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-material-oceanic.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">永远的伊尔瓦</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">个人知识库</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/random" rel="section"><i class="fa fa-sitemap fa-fw"></i>随机</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://nigelkeel.gitee.io/252001/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop= "name" content="KEEL">
      <meta itemprop="description" content="这个人很懒，什么都没留下。 ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="永远的伊尔瓦">
    </span>
      <header class="post-header">
        <!-- 自定义id -->
        <span style="color:#ddd; font-size:20px; font-weight: 888; ">252001</span>
        <h1 class="post-title" itemprop="name headline">
          Vue 商城项目
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-02 16:49:16" itemprop="dateCreated datePublished" datetime="2021-02-02T16:49:16+08:00">2021-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-03 01:42:29" itemprop="dateModified" datetime="2021-02-03T01:42:29+08:00">2021-02-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/2520%EF%BC%9AVue%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/" itemprop="url" rel="index"><span itemprop="name">2520：Vue商城项目</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>125k</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <a id="more"></a>
<h1><span id="9-yue-16-ri-day-0">9月16日（day 0）</span><a href="#9-yue-16-ri-day-0" class="header-anchor">#</a></h1>
<h2><span id="p0-kai-fa-suo-xu">0 开发所需</span><a href="#p0-kai-fa-suo-xu" class="header-anchor">#</a></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node.js</span></span><br><span class="line"><span class="comment"># vue</span></span><br><span class="line">npm uninstall vue-cli -g <span class="comment"># 先全局卸载脚手架2</span></span><br><span class="line">npm install @vue/cli -g  <span class="comment"># 安装脚手架4</span></span><br><span class="line">vue -V                   <span class="comment"># 检查版本</span></span><br></pre></td></tr></table></figure>
<h2><span id="p1-xin-jian-xiang-mu-bing-an-zhuang-xiang-mu-yi-lai">1 新建项目并安装项目依赖</span><a href="#p1-xin-jian-xiang-mu-bing-an-zhuang-xiang-mu-yi-lai" class="header-anchor">#</a></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vue create gshop_client</span><br><span class="line"><span class="built_in">cd</span> gshop_client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装项目所需依赖 --&gt; 建议一个一个装</span></span><br><span class="line">npm install vuex vue-router axios less less-loader</span><br><span class="line">npm install nprogress</span><br></pre></td></tr></table></figure>
<p>如果使用的是 stylus ，换成 <code>stylus stylus-loader</code></p>
<h2><span id="p2-xiang-mu-mu-lu-pei-zhi">2 项目目录配置</span><a href="#p2-xiang-mu-mu-lu-pei-zhi" class="header-anchor">#</a></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目目录（部分）</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">├── jsconfig.json         <span class="comment"># VSCode 路径配置文件</span></span><br><span class="line">├── vue.config.json       <span class="comment"># Vue 配置文件，设置代理，设置语法检查开关</span></span><br><span class="line">├── public</span><br><span class="line">│   ├── css              </span><br><span class="line">│   ├── font</span><br><span class="line">│   ├── images</span><br><span class="line">│   └── index.html</span><br><span class="line">└── src                </span><br><span class="line">    ├── api               <span class="comment"># --&gt; 存储封装后的api接口函数及二次封装的axios</span></span><br><span class="line">    ├── components        <span class="comment"># --&gt; 普通组件目录</span></span><br><span class="line">    │   ├── Footer        </span><br><span class="line">    │   │   └── index.vue</span><br><span class="line">    │   └── Header</span><br><span class="line">    │       └── index.vue</span><br><span class="line">    ├── pages             <span class="comment"># --&gt; 路由组件目录</span></span><br><span class="line">    │   ├── Home</span><br><span class="line">    │   │   └── index.vue</span><br><span class="line">    │   ├── Login</span><br><span class="line">    │   │   └── index.vue</span><br><span class="line">    │   ├── Register</span><br><span class="line">    │   │   └── index.vue</span><br><span class="line">    │   └── Search</span><br><span class="line">    │       └── index.vue</span><br><span class="line">    ├── router            <span class="comment"># --&gt; 路由器配置</span></span><br><span class="line">    │   ├── index.js</span><br><span class="line">    │   └── routes.js</span><br><span class="line">    ├── store             <span class="comment"># --&gt; Vuex 配置</span></span><br><span class="line">    │   ├── modules       <span class="comment"># Vue 模块化</span></span><br><span class="line">    │   ├── index.js</span><br><span class="line">    │   ├── state.js</span><br><span class="line">    │   ├── mutations.js</span><br><span class="line">    │   ├── actions.js</span><br><span class="line">    │   └── getters.js</span><br><span class="line">    ├── mock              <span class="comment"># --&gt; 模拟后台数据</span></span><br><span class="line">    ├── utils             <span class="comment"># --&gt; 工具</span></span><br><span class="line">    ├── App.vue           <span class="comment"># --&gt; 根组件</span></span><br><span class="line">    └── main.js           <span class="comment"># --&gt; 主入口</span></span><br></pre></td></tr></table></figure>
<p>配置 <code>jsconfig.json</code> 文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;paths&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;@/*&quot;</span>: [<span class="string">&quot;src/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;dist&quot;</span>] </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p3-pei-zhi-zhu-ru-kou-wen-jian">3 配置主入口文件</span><a href="#p3-pei-zhi-zhu-ru-kou-wen-jian" class="header-anchor">#</a></h2>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),     <span class="comment">// 渲染组件</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>) </span><br></pre></td></tr></table></figure>
<h2><span id="p4-pei-zhi-gen-zu-jian">4 配置根组件</span><a href="#p4-pei-zhi-gen-zu-jian" class="header-anchor">#</a></h2>
<p>引入普通组件</p>
<p>注册组件</p>
<p>App.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">   &lt;Header&#x2F;&gt;</span><br><span class="line">   &lt;Footer&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">&#x2F;&#x2F; 引入组件</span><br><span class="line">import Header from &#39;.&#x2F;components&#x2F;Header&#39;</span><br><span class="line">import Footer from &#39;.&#x2F;components&#x2F;Footer&#39;</span><br><span class="line">    </span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#39;App&#39;,</span><br><span class="line">  &#x2F;&#x2F; 注册组件</span><br><span class="line">  components: &#123;</span><br><span class="line">    Header,</span><br><span class="line">    Footer</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p5-xin-jian-zu-jian">5 新建组件</span><a href="#p5-xin-jian-zu-jian" class="header-anchor">#</a></h2>
<p>新建 <code>Header</code> <code>Footer</code> <code>Home</code> <code>Login</code> <code>Register</code> <code>Search</code> 目录下的 <code>index.vue</code></p>
<p>模板如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    Footer</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&#39;Footer&#39; &#x2F;&#x2F; 这里改成各组件名字</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p6-pei-zhi-lu-you">6 配置路由</span><a href="#p6-pei-zhi-lu-you" class="header-anchor">#</a></h2>
<p><code>router/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明使用路由插件</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化路由对象并暴露出去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>router/routes.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入组件</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;@/pages/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">&#x27;@/pages/Search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&#x27;@/pages/Login&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Register <span class="keyword">from</span> <span class="string">&#x27;@/pages/Register&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外暴露所有组件对象的数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  <span class="comment">// 注册组件对象</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    component: Home</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">    component: Search</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    component: Login</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    path: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">    component: Register</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 重定向</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    redirect: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2><span id="p7-zhu-ce-lu-you-qi">7 注册路由器</span><a href="#p7-zhu-ce-lu-you-qi" class="header-anchor">#</a></h2>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入路由器</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">// 注册路由器</span></span><br><span class="line">  router,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-18-ri-day-1">9月18日（day 1）</span><a href="#9-yue-18-ri-day-1" class="header-anchor">#</a></h1>
<h2><span id="p8-jia-zai-lu-you-shi-tu">8 加载路由视图</span><a href="#p8-jia-zai-lu-you-shi-tu" class="header-anchor">#</a></h2>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// App.vue</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载路由视图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Footer</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p9-lu-you-zhong-tian-jia-can-shu-shu-ju-geng-xin-shi-tu">9 路由中添加参数数据，更新视图</span><a href="#p9-lu-you-zhong-tian-jia-can-shu-shu-ju-geng-xin-shi-tu" class="header-anchor">#</a></h2>
<p>路由中加入参数数据</p>
<p>routes.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#125;, &#123;</span><br><span class="line">  path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">  component: Login,</span><br><span class="line">  <span class="comment">// 加入参数数据</span></span><br><span class="line">  meta: &#123;</span><br><span class="line">    isHideFooter: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  path: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">  component: Register,</span><br><span class="line">  <span class="comment">// 加入参数数据</span></span><br><span class="line">  meta: &#123;</span><br><span class="line">    isHideFooter: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>更新视图</p>
<p>App.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; App.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Header &#x2F;&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;&#x2F;router-view&gt;</span><br><span class="line">    &lt;!-- 加上 v-if 指令 --&gt;</span><br><span class="line">    &lt;Footer v-if&#x3D;&quot;!$route.meta.isHideFooter&quot; &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>
<p>实现在 <code>Login</code> 页面 和 <code>Resister</code> 页面不显示 <code>Footer</code> 组件</p>
<h2><span id="p10-index-html-jia-ru-yang-shi-wen-jian">10 index.html 加入样式文件</span><a href="#p10-index-html-jia-ru-yang-shi-wen-jian" class="header-anchor">#</a></h2>
<p>拷贝辉鸿的 <code>iconfont.css</code>   <code>reset.css</code> 放在 <code>/public/css</code>中</p>
<p>加入样式文件（🐛 用绝对路径）</p>
<p>public/index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 样式重置文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/reset.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 图标字体文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/iconfont.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p11-chai-fen-jing-tai-ye-mian-zhi-yi">11 拆分静态页面之一</span><a href="#p11-chai-fen-jing-tai-ye-mian-zhi-yi" class="header-anchor">#</a></h2>
<p>（在实际开发中，静态页面自己写）</p>
<p>辉鸿的 home/index.html   <code>&lt;header class=&quot;header&quot;&gt;</code> 内容复制到</p>
<p>components/Header/index.vue <code>&lt;template&gt;</code> 内</p>
<p>辉鸿的 home/css/home.less  <code>.header</code> 复制到</p>
<p>components/Header/index.vue <code>&lt;style lang=&quot;less&quot; rel=&quot;stylesheet/less&quot; scoped&gt;</code> 内</p>
<p>在这个目录新建 images 目录，把  Logo.png  复制过来</p>
<p>辉鸿的 home/index.html    <code>&lt;header class=&quot;footer&quot;&gt;</code> 内容复制到</p>
<p>components/Footer/index.vue <code>&lt;template&gt;</code> 内</p>
<p>辉鸿的 home/css/home.less  <code>.footer</code> 复制到</p>
<p>components/Footer/index.vue <code>&lt;style lang=&quot;less&quot; rel=&quot;stylesheet/less&quot; scoped&gt;</code> 内</p>
<p>在这个目录新建 images 目录，把  wz_cz.jpg  复制过来</p>
<p>如果出现错误可以<strong>重启</strong>一下（ <code>npm run serve</code>）排查问题</p>
<h2><span id="p12-chai-fen-jing-tai-ye-mian-zhi-er">12 拆分静态页面之二</span><a href="#p12-chai-fen-jing-tai-ye-mian-zhi-er" class="header-anchor">#</a></h2>
<p>辉鸿的 home/index.html   <code>&lt;header class=&quot;header&quot;&gt;</code> 到 <code>&lt;header class=&quot;footer&quot;&gt;</code> 之间的 内容复制到 <code>pages/Home/index.vue</code>  的 <code>&lt;template&gt; &lt;div&gt;</code> 内</p>
<p>拷贝对应的 less 样式</p>
<p>拷贝对应图片并修正图片路径</p>
<ul>
<li><code>./images/home</code> 替换成 <code>./images</code></li>
<li><code>../images</code> 替换成 <code>./images</code></li>
</ul>
<p>注释部分轮播图：查找 swiper 并注释（有三个地方），就是有多张图留一张就行，剩下的注释</p>
<h2><span id="p13-xin-jian-typenav-zu-jian-bing-zhu-ce-wei-gong-gong-zu-jian">13 新建 TypeNav 组件 并注册为公共组件</span><a href="#p13-xin-jian-typenav-zu-jian-bing-zhu-ce-wei-gong-gong-zu-jian" class="header-anchor">#</a></h2>
<p>在 <code>componets</code> 中新建 <code>TyperNav</code> ，再在里面新建 <code>index.vue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;TypeNav&#39;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>从 Home组件 中剪切对应的 结构+样式  黏贴在这个文件</p>
<p><strong>在 main.js 中注册为公共组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入的公共组件</span></span><br><span class="line"><span class="keyword">import</span> TypeNav <span class="keyword">from</span> <span class="string">&#x27;@/components/TypeNav&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置为全局的公共组件</span></span><br><span class="line">Vue.component(<span class="string">&#x27;TypeNav&#x27;</span>, TypeNav)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>在 <code>pages/Home/index.vue</code>  使用这个组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 在这里使用 --&gt;</span><br><span class="line">    &lt;TypeNav &#x2F;&gt;</span><br><span class="line">    </span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>
<h2><span id="p14-chai-fen-jing-tai-ye-mian-zhi-san">14 拆分静态页面之三</span><a href="#p14-chai-fen-jing-tai-ye-mian-zhi-san" class="header-anchor">#</a></h2>
<p>在 <code>pages/Home</code> 中新建  <code>ListContainer</code> <code>TodayRecommend</code> <code>Rank</code> <code>Floor</code> <code>Brand</code> <code>Like</code></p>
<p>新建 index.vue 拷贝对应的 html+css+images（注意修正路径）</p>
<p>在Home组件中引入并注册这六个组件，然后使用这些组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- @&#x2F;pages&#x2F;Home&#x2F;index.vue--&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 导航 --&gt;</span><br><span class="line">    &lt;TypeNav &#x2F;&gt;</span><br><span class="line">    &lt;!-- 列表 --&gt;</span><br><span class="line">    &lt;ListContainer &#x2F;&gt;</span><br><span class="line">    &lt;!-- 今日推荐 --&gt;</span><br><span class="line">    &lt;TodayRecommend &#x2F;&gt;</span><br><span class="line">    &lt;!-- 商品排行 --&gt;</span><br><span class="line">    &lt;Rank &#x2F;&gt;</span><br><span class="line">    &lt;!-- 猜你喜欢 --&gt;</span><br><span class="line">    &lt;Like &#x2F;&gt;</span><br><span class="line">    &lt;!-- 楼层 --&gt;</span><br><span class="line">    &lt;Floor &#x2F;&gt;</span><br><span class="line">    &lt;Floor &#x2F;&gt;</span><br><span class="line">    &lt;!-- 商标--&gt;</span><br><span class="line">    &lt;Brand &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  &#x2F;&#x2F; 引入组件</span><br><span class="line">  import Brand from &#39;.&#x2F;Brand&#39;</span><br><span class="line">  import Floor from &#39;.&#x2F;Floor&#39;</span><br><span class="line">  import ListContainer from &#39;.&#x2F;ListContainer&#39;</span><br><span class="line">  import Like from &#39;.&#x2F;Like&#39;</span><br><span class="line">  import Rank from &#39;.&#x2F;Rank&#39;</span><br><span class="line">  import TodayRecommend from &#39;.&#x2F;TodayRecommend&#39;</span><br><span class="line">  </span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#39;Home&#39;,</span><br><span class="line">    &#x2F;&#x2F; 注册组件</span><br><span class="line">    components: &#123;</span><br><span class="line">      Brand,</span><br><span class="line">      Floor,</span><br><span class="line">      ListContainer,</span><br><span class="line">      Like,</span><br><span class="line">      Rank,</span><br><span class="line">      TodayRecommend</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p15-chai-fen-jing-tai-ye-mian-zhi-si">15 拆分静态页面之四</span><a href="#p15-chai-fen-jing-tai-ye-mian-zhi-si" class="header-anchor">#</a></h2>
<p>志远的页面（仅复制登录和注册 div 以及 less）</p>
<p>登录 html + less + images （🐛 修正图片路径） <code>images/ --&gt; ./images</code></p>
<p>注册 html + less + images</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Login组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 登录 --&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;login-wrap&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">  .login-wrap </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Register组件</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 注册 --&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;register&quot;&gt;</span><br><span class="line">...</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; rel&#x3D;&quot;stylesheet&#x2F;less&quot; scoped&gt;</span><br><span class="line">  .register</span><br></pre></td></tr></table></figure>
<h2><span id="p16-jia-ji-ge-lu-you-lian-jie-sheng-ming-shi-lu-you-tiao-zhuan">16 加几个路由链接（声明式路由跳转）</span><a href="#p16-jia-ji-ge-lu-you-lian-jie-sheng-ming-shi-lu-you-tiao-zhuan" class="header-anchor">#</a></h2>
<p>点击头部的 <code>登陆</code> <code>免费注册</code> <code>logo</code> 和 登录页的 <code>立即跳转</code> 和 注册页的 <code>登录</code> 均会跳转到相应的页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Header  10 line</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;a href&#x3D;&quot;###&quot;&gt;登录&lt;&#x2F;a&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;###&quot; class&#x3D;&quot;register&quot;&gt;免费注册&lt;&#x2F;a&gt; --&gt;</span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;login&quot;&gt;登录&lt;&#x2F;router-link&gt;</span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;register&quot; class&#x3D;&quot;register&quot;&gt;免费注册&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 31 line</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;a class&#x3D;&quot;logo&quot; title&#x3D;&quot;尚品汇&quot; href&#x3D;&quot;###&quot; target&#x3D;&quot;_blank&quot;&gt;</span><br><span class="line">  &lt;img src&#x3D;&quot;.&#x2F;images&#x2F;Logo.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">&lt;&#x2F;a&gt; --&gt;</span><br><span class="line">&lt;router-link class&#x3D;&quot;logo&quot; title&#x3D;&quot;尚品汇&quot; to&#x3D;&quot;&#x2F;&quot;&gt;</span><br><span class="line">  &lt;img src&#x3D;&quot;.&#x2F;images&#x2F;Logo.png&quot; alt&#x3D;&quot;&quot;&gt;</span><br><span class="line">&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Register  6 line</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;a href&#x3D;&quot;login.html&quot; target&#x3D;&quot;_blank&quot;&gt;登陆&lt;&#x2F;a&gt; --&gt;</span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;login&quot;&gt;登陆&lt;&#x2F;router-link&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Login  42 line</span><br><span class="line"></span><br><span class="line">&lt;!-- &lt;a href&#x3D;&quot;##&quot; class&#x3D;&quot;register&quot;&gt;立即注册&lt;&#x2F;a&gt; --&gt;</span><br><span class="line">&lt;router-link to&#x3D;&quot;&#x2F;register&quot; class&#x3D;&quot;register&quot;&gt;立即注册&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p17-dian-ji-sou-suo-hou-tiao-zhuan-search-bian-cheng-shi-lu-you-tiao-zhuan">17 点击搜索后跳转 search（编程式路由跳转）  △</span><a href="#p17-dian-ji-sou-suo-hou-tiao-zhuan-search-bian-cheng-shi-lu-you-tiao-zhuan" class="header-anchor">#</a></h2>
<p>绑定事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Header 42 line</span><br><span class="line"></span><br><span class="line">&lt;button class&#x3D;&quot;sui-btn btn-xlarge btn-danger&quot; type&#x3D;&quot;button&quot; @click&#x3D;&quot;toSearch&quot;&gt;搜索&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure>
<p>对应的回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Header 50 line</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Header&#x27;</span>,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 点击按钮跳转到Search页面</span></span><br><span class="line">    toSearch() &#123;</span><br><span class="line">      <span class="comment">// 此时多次点击按钮会报错，是 vue-router 中的一个 bug</span></span><br><span class="line">      <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/search&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点击搜索按钮后 地址变为<code>/search</code></p>
<p>此处有一个 🐛 ，<code>this.$router.push</code> 上面那种方法使用，多次点击会报错，需传入成功和失败回调。</p>
<p><code>replace</code> 也有这个问题，考虑到多次使用，要从根本上解决就只能重写</p>
<h2><span id="p18-chong-xie-push-he-replace">18 重写 push 和 replace</span><a href="#p18-chong-xie-push-he-replace" class="header-anchor">#</a></h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/index.js 11 line</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写 push 和 replace</span></span><br><span class="line"><span class="keyword">const</span> pushOrigin = VueRouter.prototype.push</span><br><span class="line">VueRouter.prototype.push = <span class="function"><span class="keyword">function</span> (<span class="params">location, onComplete = () =&gt; &#123;&#125;, onAbort</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> pushOrigin.call(<span class="built_in">this</span>, location, onComplete, onAbort)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> replaceOrigin = VueRouter.prototype.replace</span><br><span class="line">VueRouter.prototype.replace = <span class="function"><span class="keyword">function</span> (<span class="params">location, onComplete, onAbort = () =&gt; &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> replaceOrigin.call(<span class="built_in">this</span>, location, onComplete, onAbort)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时出现报错就 <code>npm install --save core-js</code></p>
<h2><span id="p19-lu-you-chuan-can-params">19 路由传参（params） △</span><a href="#p19-lu-you-chuan-can-params" class="header-anchor">#</a></h2>
<p>💡  路由传参方式</p>
<p>获取搜索框输入内容，点击跳转，比如输入 <code>123</code> 则跳转到 <code>search/123</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  Header 41 line</span></span><br><span class="line"></span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;autocomplete&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;input-error input-xxlarge&quot;</span> v-model=<span class="string">&quot;keyword&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Header 51 line</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据对象</span></span><br><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    keyword: <span class="string">&#x27;&#x27;</span> <span class="comment">// 用来收集搜索框中的关键字</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 点击按钮跳转到Search页面</span></span><br><span class="line">  toSearch() &#123;</span><br><span class="line">    <span class="comment">// 判断文本框是否输入内容</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.keyword) &#123;</span><br><span class="line">      <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">        name: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">        params: &#123;</span><br><span class="line">          keyword: <span class="built_in">this</span>.keyword</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">        name: <span class="string">&#x27;search&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes.js 14 line</span></span><br><span class="line"></span><br><span class="line">path: <span class="string">&#x27;/search/:keyword?&#x27;</span>, <span class="comment">// ? 表示参数可传可不传</span></span><br><span class="line">component: Search,</span><br><span class="line">name: <span class="string">&#x27;search&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p20-er-ci-feng-zhuang-axios">20 二次封装 axios △</span><a href="#p20-er-ci-feng-zhuang-axios" class="header-anchor">#</a></h2>
<p>安装 Nprogress</p>
<p><code>npm install --save nprogress </code></p>
<p>新建 <code>api/ajax.js</code> 文件，内容如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二次封装 axios</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 引入Nprogress插件和插件的样式文件</span></span><br><span class="line"><span class="comment">// 可以在发送请求或者作出响应的时候有进度条的效果</span></span><br><span class="line"><span class="keyword">import</span> Nprogress <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置请求时的根路径和及请求超时时间 </span></span><br><span class="line"><span class="keyword">const</span> ajax = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">&#x27;/api&#x27;</span>, <span class="comment">// 设置根路径</span></span><br><span class="line">  timeOut: <span class="number">20000</span> <span class="comment">// 设置超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">ajax.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  Nprogress.start() <span class="comment">// 显示进度条</span></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">ajax.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  Nprogress.done() <span class="comment">// 隐藏进度条</span></span><br><span class="line">  <span class="keyword">return</span> response.data</span><br><span class="line">&#125;), <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  Nprogress.done() <span class="comment">// 隐藏进度条</span></span><br><span class="line">  alert(error.message)</span><br><span class="line">  <span class="comment">// 返回错误信息，外部可以处理</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ajax</span><br></pre></td></tr></table></figure>
<p>新建 <code>api/index.js</code> 文件，内容如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装每个接口的api函数</span></span><br><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">&#x27;./ajax&#x27;</span></span><br><span class="line"><span class="comment">// 获取首页三级分类信息的api接口函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqBaseCategoryList = <span class="function">() =&gt;</span> ajax.get(<span class="string">`/product/getBaseCategoryList`</span>)</span><br></pre></td></tr></table></figure>
<p>修改 <code>App.vue </code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--&gt; <span class="string">&quot;App.vue&quot;</span> <span class="number">15</span> line</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 api 接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqBaseCategoryList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"></span><br><span class="line">--&gt; <span class="number">27</span> line</span><br><span class="line"><span class="keyword">async</span> mounted() &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqBaseCategoryList()</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p21-vue-config-js-eslint-she-zhi-kua-yu-dai-li-she-zhi">21 vue.config.js / eslint 设置 / 跨域代理设置</span><a href="#p21-vue-config-js-eslint-she-zhi-kua-yu-dai-li-she-zhi" class="header-anchor">#</a></h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--&gt; <span class="string">&quot;vue.config.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  lintOnSave: <span class="literal">true</span>, <span class="comment">// eslint 语法检查开关</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        target: <span class="string">&#x27;http://182.92.128.115&#x27;</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>  <span class="comment">// 开启跨域</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-19-ri-day-2">9月19日（day 2）</span><a href="#9-yue-19-ri-day-2" class="header-anchor">#</a></h1>
<h2><span id="p22-store-da-jian-he-zhu-ce">22 store 搭建和注册</span><a href="#p22-store-da-jian-he-zhu-ce" class="header-anchor">#</a></h2>
<p>创建 <code>store/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入核心对象</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">&#x27;./state&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">&#x27;./mutations&#x27;</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">&#x27;./actions&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明使用插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化 + 暴露</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>创建 <code>store/state.js</code>  <code>store/mutations.js</code> <code>store/actions.js</code> <code>store/getters.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新 <code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--&gt; <span class="string">&quot;main.js&quot;</span></span><br><span class="line">--&gt; <span class="number">7</span> line</span><br><span class="line"><span class="comment">// 引入store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line">--&gt; <span class="number">20</span> line</span><br><span class="line"><span class="comment">// 注册store</span></span><br><span class="line">store,</span><br></pre></td></tr></table></figure>
<h2><span id="p23-vuex-zhi-modules">23 Vuex 之 modules</span><a href="#p23-vuex-zhi-modules" class="header-anchor">#</a></h2>
<p>💡 Vuex 的 modules 知识</p>
<p><code>store</code> 新建 目录 <code>modules</code></p>
<p>里面新建文件 <code>home.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state:&#123;&#125;,</span><br><span class="line">  mutations:&#123;&#125;,</span><br><span class="line">  actions:&#123;&#125;,</span><br><span class="line">  getters:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建文件 <code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 <code>store/index.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> modules <span class="keyword">from</span> <span class="string">&#x27;./modules&#x27;</span></span><br><span class="line"></span><br><span class="line">getters,</span><br><span class="line"><span class="comment">// 管理模块</span></span><br><span class="line">modules</span><br></pre></td></tr></table></figure>
<blockquote>
<p>组件中获取状态数据方式</p>
<p><code>this.$store.state.xxxx</code> / <code>...mapState/(['xxx'])</code></p>
<p><code>this.store.state.模块名字.xxx</code> / <code>..mapState(&#123; xxx:&#125;)</code></p>
<p>尽量不能让方法重名，如果总actions有一个a方法，某模块中也有a方法，最终这两个方法都会执行</p>
</blockquote>
<h2><span id="p24-home-zu-jian-xiang-guan-de-store">24 Home组件相关的 store</span><a href="#p24-home-zu-jian-xiang-guan-de-store" class="header-anchor">#</a></h2>
<p>修改 <code>store</code> 中的 <code>home.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入API接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqBaseCategoryList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;@/api&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理首页中的数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 三级分类信息数据数组</span></span><br><span class="line">    baseCategoryList: []</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接修改三级分类信息数据 </span></span><br><span class="line">    RECEIVE_BASE_CATEGORY_LIST(state, baseCategoryList) &#123;</span><br><span class="line">      state.baseCategoryList = baseCategoryList;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 异步请求，获取三级分类信息数据</span></span><br><span class="line">    <span class="keyword">async</span> getBaseCategoryList(&#123;</span><br><span class="line">      commit</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">      <span class="comment">// 调用接口发送异步请求</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqBaseCategoryList()</span><br><span class="line">      <span class="comment">// 判断</span></span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 提交</span></span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_BASE_CATEGORY_LIST&#x27;</span>, result.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>删除 <code>App.vue</code> 15行的引入api接口语句</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除这个</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqGetBaseCategoryList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<p>修改22行的 <code>async mounted()&#123;&#125;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> mounted() &#123;</span><br><span class="line">   <span class="comment">// 分发</span></span><br><span class="line">   <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getBaseCategoryList&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p25-bian-li-typenav-san-ji-fen-lei-shu-ju-bing-xian-shi">25 遍历 TypeNav 三级分类数据并显示</span><a href="#p25-bian-li-typenav-san-ji-fen-lei-shu-ju-bing-xian-shi" class="header-anchor">#</a></h2>
<p>删除 TypeNav 组件 <code>&lt;div class=&quot;item&quot;&gt;</code> 46 - 1688行</p>
<p>视图部分更新如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// &quot;TypeNav&quot; 6 line</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sort&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;all-sort-list2&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 遍历第一层 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c1, index) in baseCategoryList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c1.categoryId&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c1.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-list clearfix&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;subitem&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 遍历第二层 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;fore&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c2) in c1.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c2.categoryId&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dt</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c2.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 遍历第三层 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">em</span> <span class="attr">v-for</span>=<span class="string">&quot;(c3) in c2.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c3.categoryId&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c3.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 这个移动到这里 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>脚本更新如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;TypeNav&quot;</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">import</span> &#123;</span><br><span class="line">    mapState</span><br><span class="line">  &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">&#x27;TypeNav&#x27;</span>,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      <span class="comment">// 获取状态数据</span></span><br><span class="line">      ...mapState(&#123;</span><br><span class="line">        baseCategoryList: <span class="function">(<span class="params">state</span>) =&gt;</span> state.home.baseCategoryList</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p26-shu-biao-yi-ru-yi-chu-xiao-guo">26 鼠标移入移出效果</span><a href="#p26-shu-biao-yi-ru-yi-chu-xiao-guo" class="header-anchor">#</a></h2>
<p>TypeNav  添加事件和绑定样式属性 如下中的 1 和 2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// TypeNav 第4行</span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 1 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> @<span class="attr">mouseleave</span>=<span class="string">&quot;currentIndex=-2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;all&quot;</span>&gt;</span>全部商品分类<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sort&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 遍历显示导航数据 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;all-sort-list2&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 遍历第一层 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 2 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c1,index) in baseCategoryList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c1.categoryId&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;&#123;item_on:currentIndex===index&#125;&quot;</span> @<span class="attr">mouseenter</span>=<span class="string">&quot;showSubCategory(index)&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c1.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-list clearfix&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;subitem&quot;</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 遍历第二层 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;fore&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c2) in c1.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c2.categoryId&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dt</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c2.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 遍历第三层 --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">em</span> <span class="attr">v-for</span>=<span class="string">&quot;(c3) in c2.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c3.categoryId&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>&#123;&#123;c3.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- @mouseleave 事件那个div到这里结束 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>data更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    currentIndex: <span class="number">-2</span> <span class="comment">// 用来储存鼠标进入某一项的时候的索引</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>methods更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 鼠标进入事件</span></span><br><span class="line">  showSubCategory(index) &#123;</span><br><span class="line">    <span class="comment">// 鼠标进入的时候把当前这个项的索引保存起来</span></span><br><span class="line">    <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>样式更新 <code>&amp;:hover </code> 改成 <code>&amp;.item_on</code></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 187行</span></span><br><span class="line">            <span class="selector-tag">&amp;</span><span class="selector-class">.item_on</span> &#123;</span><br><span class="line">              <span class="attribute">background-color</span>: <span class="number">#02a774</span>;</span><br><span class="line"></span><br><span class="line">              <span class="selector-class">.item-list</span> &#123;</span><br><span class="line">                <span class="attribute">display</span>: block;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>呈现鼠标移入标记效果</p>
<h2><span id="p27-an-xu-yin-ru-lodash-zhong-jie-liu-han-shu">27 按需引入lodash中节流函数</span><a href="#p27-an-xu-yin-ru-lodash-zhong-jie-liu-han-shu" class="header-anchor">#</a></h2>
<p>💡 节流 / 防抖函数</p>
<p>安装 lodash</p>
<p><code>npm install lodash</code></p>
<p>引入 lodash</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeNav 55行</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 按需引入 lodash 中的 节流函数</span></span><br><span class="line">  <span class="keyword">import</span> throttle <span class="keyword">from</span> <span class="string">&#x27;lodash/throttle&#x27;</span></span><br></pre></td></tr></table></figure>
<p>更新 methods</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 鼠标进入事件</span></span><br><span class="line">showSubCategory: throttle( <span class="function"><span class="keyword">function</span> (<span class="params">index</span>)</span>&#123;</span><br><span class="line">   <span class="comment">// 鼠标进入的时候把当前这个项的索引保存起来</span></span><br><span class="line">  <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">&#125;, <span class="number">333</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="p28-query-fang-shi-lu-you-chuan-can-shi-jian-wei-tuo-mou-pao">28 query方式路由传参 + 事件委托（冒泡） △</span><a href="#p28-query-fang-shi-lu-you-chuan-can-shi-jian-wei-tuo-mou-pao" class="header-anchor">#</a></h2>
<p>这里不宜采用三层 <code>v-for</code> 嵌套的路由视图或者是事件，应该采用事件委托的方式</p>
<p>通过事件绑定委托绑定点击事件如 1 所示</p>
<p>给a标签添加自定义属性如 2 3 4 所示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// TypeNav 7行</span><br><span class="line">       <span class="comment">&lt;!-- 1 这里加了一个点击事件（事件委托） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sort&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toSearch&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 遍历显示导航数据 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;all-sort-list2&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 遍历第一层 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c1,index) in baseCategoryList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c1.categoryId&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;&#123; item_on:currentIndex===index&#125;&quot;</span> @<span class="attr">mouseenter</span>=<span class="string">&quot;showSubCategory(index)&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 2 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">:data-categoryName</span>=<span class="string">&quot;c1.categoryName&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">:data-category1Id</span>=<span class="string">&quot;c1.categoryId&quot;</span>&gt;</span>&#123;&#123;c1.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-list clearfix&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;subitem&quot;</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- 遍历第二层 --&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">&quot;fore&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(c2) in c1.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c2.categoryId&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dt</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 3 --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">:data-categoryName</span>=<span class="string">&quot;c2.categoryName&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">:data-category2Id</span>=<span class="string">&quot;c2.categoryId&quot;</span>&gt;</span>&#123;&#123;c2.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">                      <span class="comment">&lt;!-- 遍历第三层 --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">em</span> <span class="attr">v-for</span>=<span class="string">&quot;(c3) in c2.categoryChild&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;c3.categoryId&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 4 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">:data-categoryName</span>=<span class="string">&quot;c3.categoryName&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">:data-category3Id</span>=<span class="string">&quot;c3.categoryId&quot;</span>&gt;</span>&#123;&#123;c3.categoryName&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更新对应的点击事件 <code>toSearch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeNav 73行</span></span><br><span class="line">  methods: &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="comment">// 点击跳转事件（点击外层div，实现路由跳转）</span></span><br><span class="line">      toSearch(e) &#123;</span><br><span class="line">        <span class="comment">// 事件委托</span></span><br><span class="line">        <span class="keyword">const</span> nodeTarget = e.target</span><br><span class="line">        <span class="comment">// 判断是不是a标签</span></span><br><span class="line">        <span class="keyword">if</span> (nodeTarget.nodeName === <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">// 解构</span></span><br><span class="line">          <span class="keyword">const</span> &#123;</span><br><span class="line">            categoryname,</span><br><span class="line">            category1id,</span><br><span class="line">            category2id,</span><br><span class="line">            category3id</span><br><span class="line">          &#125; = nodeTarget.dataset</span><br><span class="line">          <span class="keyword">const</span> query = &#123;</span><br><span class="line">            categoryName: categoryname</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 判断</span></span><br><span class="line">          <span class="keyword">if</span> (category1id) &#123;</span><br><span class="line">            query.category1Id = category1id</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (category2id) &#123;</span><br><span class="line">            query.category2Id = category2id</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (category3id) &#123;</span><br><span class="line">            query.category3Id = category3id</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 路由跳转</span></span><br><span class="line">          <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">            path: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">            query</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="comment">// 隐藏高亮效果</span></span><br><span class="line">          <span class="built_in">this</span>.currentIndex = <span class="number">-2</span></span><br><span class="line">          </span><br><span class="line">          <span class="built_in">this</span>.isShowFirst = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>以上可以实现点击 TypeNav 中的一级二级三级链接跳转 Search</p>
<p>URL 为 <code>search?categoryName=电脑办公&amp;categoryId=6</code>  之类的效果</p>
<h2><span id="p29-search-ye-mian-tian-jia-typenav">29 Search 页面添加 TypeNav</span><a href="#p29-search-ye-mian-tian-jia-typenav" class="header-anchor">#</a></h2>
<p>Search 添加 TypeNav 标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TypeNav</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>TypeNav 第8行添加一个 <code>v-if</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sort&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toSearch&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;isShowFirst&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>data 添加一个 isShowFirst  数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    currentIndex: <span class="number">-2</span>, <span class="comment">// 用来储存鼠标进入某一项的时候的索引</span></span><br><span class="line">    isShowFirst: <span class="literal">true</span> <span class="comment">// 默认 true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>第5行 更新</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">mouseleave</span>=<span class="string">&quot;hideFirst&quot;</span> @<span class="attr">mouseenter</span>=<span class="string">&quot;showFirst&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第114行 添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该组件加载完毕的时候里面的菜单是否隐藏取决于当前的地址（路由地址/路径）</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.$route.path !== <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果不是首页 就隐藏菜单</span></span><br><span class="line">    <span class="built_in">this</span>.isShowFirst = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>methods 中添加两个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 鼠标进入</span></span><br><span class="line">  showFirst() &#123;</span><br><span class="line">    <span class="built_in">this</span>.isShowFirst = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">this</span>.currentIndex = <span class="number">-1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 鼠标离开</span></span><br><span class="line">  hideFirst() &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentIndex = <span class="number">-2</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.$route.path != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.isShowFirst = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>修改 showSubCategory</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">showSubCategory: throttle(<span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 鼠标进入的时候把当前这个项的索引保存起来</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.currentIndex !== <span class="number">-2</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">300</span>),</span><br></pre></td></tr></table></figure>
<h2><span id="p30-yin-ru-mockjs">30 引入 mockJS</span><a href="#p30-yin-ru-mockjs" class="header-anchor">#</a></h2>
<p>生成随机数据，拦截ajax请求</p>
<p>安装 <code>npm install mockjs</code></p>
<p>mock 目录新建 <code>banners.json</code> （直接拷贝代码）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id|1-10&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/banner1.jpg&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/banner2.jpg&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/banner3.jpg&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/banner4.jpg&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mock 目录新建 <code>floors.json</code> （直接拷贝代码）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;家用电器&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;节能补贴&quot;</span>,</span><br><span class="line">      <span class="string">&quot;4K电视&quot;</span>,</span><br><span class="line">      <span class="string">&quot;空气净化器&quot;</span>,</span><br><span class="line">      <span class="string">&quot;IH电饭煲&quot;</span>,</span><br><span class="line">      <span class="string">&quot;滚筒洗衣机&quot;</span>,</span><br><span class="line">      <span class="string">&quot;电热水器&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-1.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navList&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;热门&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;大家电&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;生活电器&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;厨房电器&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;应季电器&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;空气/净水&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;高端电器&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;carouselList&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0011&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b01.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0012&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b02.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0013&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b03.png&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;recommendList&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/images/floor-1-2.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-3.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-5.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-6.png&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;bigImg&quot;</span>: <span class="string">&quot;/images/floor-1-4.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;002&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;手机通讯&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;keywords&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;节能补贴2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;4K电视2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;空气净化器2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;IH电饭煲2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;滚筒洗衣机2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;电热水器2&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-1.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navList&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;热门2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;大家电2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;生活电器2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;厨房电器2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;应季电器2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;空气/净水2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;高端电器2&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;carouselList&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0011&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b01.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0012&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b02.png&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;0013&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgUrl&quot;</span>: <span class="string">&quot;/images/floor-1-b03.png&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;recommendList&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/images/floor-1-2.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-3.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-5.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/floor-1-6.png&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;bigImg&quot;</span>: <span class="string">&quot;/images/floor-1-4.png&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mock 目录新建 <code>index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 Mock</span></span><br><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">&#x27;mockjs&#x27;</span></span><br><span class="line"><span class="comment">// 引入模版数据</span></span><br><span class="line"><span class="keyword">import</span> banners <span class="keyword">from</span> <span class="string">&#x27;./banners.json&#x27;</span></span><br><span class="line"><span class="keyword">import</span> floors <span class="keyword">from</span> <span class="string">&#x27;./floors.json&#x27;</span></span><br><span class="line"><span class="comment">// 根据指定的地址生成随机的数据</span></span><br><span class="line">Mock.mock(<span class="string">&#x27;/mock/banners&#x27;</span>, &#123;</span><br><span class="line">  code: <span class="number">200</span>,</span><br><span class="line">  message: <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">  data: banners</span><br><span class="line">&#125;)</span><br><span class="line">Mock.mock(<span class="string">&#x27;/mock/floors&#x27;</span>, &#123;</span><br><span class="line">  code: <span class="number">200</span>,</span><br><span class="line">  message: <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">  data: floors</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>复制一份 <code>api/ajax.js</code> 改名 <code>ajaxMock.js</code></p>
<p>把其中根路径（第11行）<code>baseURL:'/api'</code> 改成 <code>baseURL:'/mock'</code></p>
<p><code>api/index.js</code> 引入 ajaxMock</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ajaxMock <span class="keyword">from</span> <span class="string">&#x27;./ajaxMock&#x27;</span></span><br></pre></td></tr></table></figure>
<p>末尾 加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置 mock 相关的接口函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqBanners = <span class="function">() =&gt;</span> ajaxMock.get(<span class="string">&#x27;/mock/banners&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqFloors = <span class="function">() =&gt;</span> ajaxMock.get(<span class="string">&#x27;/mock/floors&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>main.js</code> 加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./mock&quot;</span></span><br></pre></td></tr></table></figure>
<p>Home 组件引入测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    reqBanners,</span><br><span class="line">    reqFloors</span><br><span class="line">  &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">async</span> mounted() &#123;</span><br><span class="line">      <span class="keyword">const</span> r1 = <span class="keyword">await</span> reqBanners()</span><br><span class="line">      <span class="keyword">const</span> r2 = <span class="keyword">await</span> reqFloors()</span><br><span class="line">      <span class="built_in">console</span>.log(r1, r2)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p31-mock-xiang-guan-shu-ju-jia-ru-store-zhong">31 mock相关数据加入 store 中</span><a href="#p31-mock-xiang-guan-shu-ju-jia-ru-store-zhong" class="header-anchor">#</a></h2>
<p><code>store/modules/home.js</code></p>
<p>修改引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqBaseCategoryList,</span><br><span class="line">  reqBanners,</span><br><span class="line">  reqFloors</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<p>state 加入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大轮播图数据</span></span><br><span class="line">banners: [],</span><br><span class="line"><span class="comment">// 楼层数据</span></span><br><span class="line">floors: []</span><br></pre></td></tr></table></figure>
<p>mutations 加入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接修改大轮播图的数据</span></span><br><span class="line">RECEIVE_BANNERS(state, banners) &#123;</span><br><span class="line">  state.banners = banners</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 直接修改楼层的数据</span></span><br><span class="line">RECEIVE_FLOORS(state, floors) &#123;</span><br><span class="line">  state.floors = floors</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>actions 加入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步获取大轮播图的数据</span></span><br><span class="line"><span class="keyword">async</span> getBanners (&#123; commit &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqBanners()</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">    commit(<span class="string">&#x27;RECEIVE_BANNERS&#x27;</span>, result.data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 异步获取楼层的数据</span></span><br><span class="line"><span class="keyword">async</span> getFloors (&#123; commit &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqFloors()</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">    commit(<span class="string">&#x27;RECEIVE_FLOORS&#x27;</span>, result.data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Home 组件引入测试</p>
<p>删除前面的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    reqBanners,</span><br><span class="line">    reqFloors</span><br><span class="line">  &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<p>修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> mounted() &#123;</span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getBanners&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getFloors&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Home-&gt;ListContainer 组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ListContainer&#x27;</span>,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      banners:<span class="function"><span class="params">state</span>=&gt;</span>state.home.banners</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p32-swiper-shi-xian-lun-bo-tu">32 Swiper 实现轮播图</span><a href="#p32-swiper-shi-xian-lun-bo-tu" class="header-anchor">#</a></h2>
<p>安装 Swiper <code>npm install swiper@5.4.2</code></p>
<p>ListContainer 轮播图 第5行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--banner轮播--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/banner1.jpg&quot;</span> <span class="attr">alt</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/banner2.jpg&quot;</span> <span class="attr">alt</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/banner3.jpg&quot;</span> <span class="attr">alt</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/banner4.jpg&quot;</span> <span class="attr">alt</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果需要分页器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-pagination&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果需要导航按钮 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-prev&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>115行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入swiper对象</span></span><br><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">&#x27;swiper&#x27;</span></span><br><span class="line"><span class="comment">// 引入swiper的样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;swiper/css/swiper.css&#x27;</span></span><br></pre></td></tr></table></figure>
<p>126行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 当前组件渲染完毕的生命周期回调</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper(<span class="string">&#x27;.swiper-container&#x27;</span>, &#123;</span><br><span class="line">    loop: <span class="literal">true</span>, <span class="comment">// 循环模式选项</span></span><br><span class="line">    <span class="comment">// 如果需要分页器</span></span><br><span class="line">    pagination: &#123;</span><br><span class="line">      el: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 如果需要前进后退按钮</span></span><br><span class="line">    navigation: &#123;</span><br><span class="line">      nextEl: <span class="string">&#x27;.swiper-button-next&#x27;</span>,</span><br><span class="line">      prevEl: <span class="string">&#x27;.swiper-button-prev&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>实现轮播图效果</p>
<h1><span id="9-yue-21-ri-day-3">9月21日（day 3）</span><a href="#9-yue-21-ri-day-3" class="header-anchor">#</a></h1>
<h2><span id="p33-xiang-mu-you-hua">33 项目优化</span><a href="#p33-xiang-mu-you-hua" class="header-anchor">#</a></h2>
<p>store/modules/home.js 20行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RECEIVE_BASE_CATEGORY_LIST(state, baseCategoryList) &#123;</span><br><span class="line">  state.baseCategoryList = baseCategoryList.splice(<span class="number">0</span>, baseCategoryList.length - <span class="number">2</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ListContainer <code>  import 'swiper/css/swiper.css'</code> 去掉，改为在 <code>main.js</code> 中引入</p>
<h2><span id="p34-lun-bo-tu-yu-shu-ju-jia-zai-yu-xuan-ran-swiper-dui-xiang-chuang-jian-shi-ji">34 轮播图与数据加载与渲染，Swiper对象创建时机</span><a href="#p34-lun-bo-tu-yu-shu-ju-jia-zai-yu-xuan-ran-swiper-dui-xiang-chuang-jian-shi-ji" class="header-anchor">#</a></h2>
<p>public/image 里面要有轮播使用的图</p>
<p>ListContainer 5行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--banner轮播--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-container&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sw&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(carousel) in banners&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;carousel.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;carousel.imgUrl&quot;</span> <span class="attr">alt</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果需要分页器 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>script部分更新为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      banners: <span class="function"><span class="params">state</span> =&gt;</span> state.home.banners</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    banners() &#123;</span><br><span class="line">      <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper(<span class="string">&#x27;.swiper-container&#x27;</span>, &#123;</span><br><span class="line">          loop: <span class="literal">true</span>, <span class="comment">// 循环模式选项</span></span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 如果需要前进后退按钮</span></span><br><span class="line">          navigation: &#123;</span><br><span class="line">            nextEl: <span class="string">&#x27;.swiper-button-next&#x27;</span>,</span><br><span class="line">            prevEl: <span class="string">&#x27;.swiper-button-prev&#x27;</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里应该可以看到轮播图效果（banner）</p>
<h2><span id="p35-floor-shi-tu-sheng-cheng">35 Floor 视图生成</span><a href="#p35-floor-shi-tu-sheng-cheng" class="header-anchor">#</a></h2>
<p>Home 组件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  mapState</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取数据</span></span><br><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    floors: <span class="function"><span class="params">state</span> =&gt;</span> state.home.floors</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 分发 actions</span></span><br><span class="line"><span class="keyword">async</span> mounted() &#123;</span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getBanners&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getFloors&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>14行，删除一个留一个</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 楼层 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Floor</span> <span class="attr">v-for</span>=<span class="string">&quot;(floor) in floors&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;floor.id&quot;</span> <span class="attr">:floor</span>=<span class="string">&quot;floor&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>Floor中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取参数</span></span><br><span class="line">props: &#123;</span><br><span class="line">  floor: <span class="built_in">Object</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第6行修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;fl&quot;</span>&gt;</span>&#123;&#123;floor.name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第8行修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav-tabs clearfix&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:index===0&#125;&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(nav,index) in floor.navList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;tab&quot;</span>&gt;</span>&#123;&#123;nav.text&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第19行修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jd-list&quot;</span>&gt;</span><br><span class="line">  &lt;li v-<span class="keyword">for</span>=<span class="string">&quot;(keyword,index) in floor.keywords&quot;</span> :key=<span class="string">&quot;index&quot;</span>&gt;</span><br><span class="line">    &#123;&#123;keyword&#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>第51行修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floor-conver-pit&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;floor.recommendList[0]&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floor-conver-pit&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;floor.recommendList[1]&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;split center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;floor.bigImg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;split&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;floor-x-line&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floor-conver-pit&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;floor.recommendList[2]&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floor-conver-pit&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;floor.recommendList[3]&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p36-lun-bo-tu-feng-zhuang-wei-gong-gong-zu-jian">36 轮播图封装为公共组件</span><a href="#p36-lun-bo-tu-feng-zhuang-wei-gong-gong-zu-jian" class="header-anchor">#</a></h2>
<p>在 components 新建 Carousel 新建 index.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-container&quot;</span> id=<span class="string">&quot;swL&quot;</span> ref=<span class="string">&quot;sw&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-slide&quot;</span> v-<span class="keyword">for</span>=<span class="string">&quot;(carousel,index) in carouselList&quot;</span> :key=<span class="string">&quot;carousel.id&quot;</span>&gt;</span><br><span class="line">        &lt;img :src=<span class="string">&quot;carousel.imgUrl&quot;</span> alt /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 如果需要分页器 --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-pagination&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;!-- 如果需要导航按钮 --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-button-prev&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;swiper-button-next&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// 引入swiper对象</span></span><br><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">&#x27;swiper&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Carousel&#x27;</span>,</span><br><span class="line">  props:&#123;</span><br><span class="line">    carouselList:<span class="built_in">Array</span></span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    carouselList() &#123;</span><br><span class="line">      <span class="comment">// 将回调延迟到下次 DOM 更新循环之后执行。在修改数据之后立即使用它，然后等待 DOM 更新。</span></span><br><span class="line">      <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper(<span class="built_in">this</span>.$refs.sw, &#123;</span><br><span class="line">          loop: <span class="literal">true</span>, <span class="comment">// 循环模式选项</span></span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 如果需要前进后退按钮</span></span><br><span class="line">          navigation: &#123;</span><br><span class="line">            nextEl: <span class="string">&#x27;.swiper-button-next&#x27;</span>,</span><br><span class="line">            prevEl: <span class="string">&#x27;.swiper-button-prev&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 main.js 注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入Carousel组件---轮播图组件(ListContainer和Floor组件中使用)</span></span><br><span class="line"><span class="keyword">import</span> Carousel <span class="keyword">from</span> <span class="string">&#x27;@/components/Carousel&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数1:组件的名字,参数2:组件对象</span></span><br><span class="line">Vue.component(<span class="string">&#x27;Carousel&#x27;</span>,Carousel)</span><br></pre></td></tr></table></figure>
<p>Floor 26行更新</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 轮播图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floorBanner&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">Carousel</span> <span class="attr">:carouselList</span>=<span class="string">&quot;floor.carouselList&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ListContainer 4行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--banner轮播--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Carousel</span> <span class="attr">:carouselList</span>=<span class="string">&quot;banners&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>清理 ListContainer 组件轮播图相关的数据</p>
<p>此时大轮播图可以，小轮播图不能轮播，接下去分析 🐛</p>
<h2><span id="p37-xiu-fu-lun-bo-tu-wen-ti">37 修复轮播图问题</span><a href="#p37-xiu-fu-lun-bo-tu-wen-ti" class="header-anchor">#</a></h2>
<p>Carousel 中 watch 修改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  carouselList: &#123;</span><br><span class="line">    <span class="comment">// 该回调会在监听开始被立即调用</span></span><br><span class="line">    handler: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.carouselList.length === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">         ....</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    immediate: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p38-search-zu-jian">38 Search 组件</span><a href="#p38-search-zu-jian" class="header-anchor">#</a></h2>
<p>封装api接口函数 api/index.js 加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品信息数据对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqProductList = <span class="function">(<span class="params">searchParams</span>) =&gt;</span> ajax.post(<span class="string">&#x27;list&#x27;</span>, searchParams)</span><br></pre></td></tr></table></figure>
<p>去静态组件文件夹拿Search</p>
<p>封装Vuex modules/新建 search.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入API接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqProductList</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理Search组件中的数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 商品信息数据对象</span></span><br><span class="line">    productList: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接更新商品信息数据对象</span></span><br><span class="line">    RECEIVE_PRODUCT_LIST(state, productList) &#123;</span><br><span class="line">      state.productList = productList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 获取商品信息数据对象</span></span><br><span class="line">    <span class="keyword">async</span> getProductList(&#123;</span><br><span class="line">      commit</span><br><span class="line">    &#125;, searchParams) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqProductList(searchParams)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_PRODUCT_LIST&#x27;</span>, result.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    trademarkList(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.productList.trademarkList || []</span><br><span class="line">    &#125;,</span><br><span class="line">    attrsList(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.productList.attrsList || []</span><br><span class="line">    &#125;,</span><br><span class="line">    goodsList(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.productList.goodsList || []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新 index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home,</span><br><span class="line">  search</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Search 去分发 Vuex</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    options: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="comment">// 分发 actions</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 获取商品信息数据对象</span></span><br><span class="line">  getProductList() &#123;</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getProductList&#x27;</span>, <span class="built_in">this</span>.options)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p39-bian-li-shang-pin-fen-lei-xin-xi">39 遍历商品分类信息</span><a href="#p39-bian-li-shang-pin-fen-lei-xin-xi" class="header-anchor">#</a></h2>
<p>Search 下面 SearchSelector 前面部分修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;clearfix selector&quot;</span>&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;type-wrap logo&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fl key brand&quot;</span>&gt;品牌&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;value logos&quot;</span>&gt;</span><br><span class="line">      &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;logo-list&quot;</span>&gt;</span><br><span class="line">        &lt;li v-<span class="keyword">for</span>=<span class="string">&quot;(tm) in trademarkList&quot;</span> :key=<span class="string">&quot;tm.tmId&quot;</span>&gt;&#123;&#123;tm.tmName&#125;&#125;&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;type-wrap&quot;</span> v-<span class="keyword">for</span>=<span class="string">&quot;(attr) in attrsList&quot;</span> :key=<span class="string">&quot;attr.attrId&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fl key&quot;</span>&gt;&#123;&#123;attr.attrName&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fl value&quot;</span>&gt;</span><br><span class="line">      &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;type-list&quot;</span>&gt;</span><br><span class="line">        &lt;li v-<span class="keyword">for</span>=<span class="string">&quot;(value,index) in attr.attrValueList&quot;</span> :key=<span class="string">&quot;index&quot;</span>&gt;</span><br><span class="line">          &lt;a&gt;&#123;&#123;value&#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fl ext&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>script 部分修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入辅助函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  mapGetters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;SearchSelector&#x27;</span>,</span><br><span class="line">  <span class="comment">// 获取数据</span></span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapGetters([<span class="string">&#x27;trademarkList&#x27;</span>, <span class="string">&#x27;attrsList&#x27;</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-22-ri-day-4">9月22日（day 4）</span><a href="#9-yue-22-ri-day-4" class="header-anchor">#</a></h1>
<h2><span id="p40-search-zu-jian-xian-shi-shang-pin-xin-xi">40 Search 组件显示商品信息</span><a href="#p40-search-zu-jian-xian-shi-shang-pin-xin-xi" class="header-anchor">#</a></h2>
<p>Search 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  mapState,</span><br><span class="line">  mapGetters</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// 获取商品信息数据对象</span></span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    productList: <span class="function"><span class="params">state</span> =&gt;</span> state.search.productList</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// 获取当前这一页的商品信息数据</span></span><br><span class="line">  ...mapGetters([<span class="string">&#x27;goodsList&#x27;</span>])</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><code>&lt;li class=&quot;yui3-u-1-5&quot;&gt;</code> 删除留一个，进行以下更新</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;yui3-g&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;yui3-u-1-5&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(goods, index) in goodsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;goods.id&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-wrap&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;p-img&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;item.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;goods.defaultImg&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">em</span>&gt;</span>¥<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123;goods.price&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;attr&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;item.html&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;goods.title&quot;</span>&gt;</span>&#123;&#123;goods.title&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;commit&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;command&quot;</span>&gt;</span>已有<span class="tag">&lt;<span class="name">span</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">span</span>&gt;</span>人评价<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;operate&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;success-cart.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sui-btn btn-bordered btn-danger&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sui-btn btn-bordered&quot;</span>&gt;</span>收藏<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p41-jie-jue-yi-ge-tiao-zhuan-bug">41 解决一个跳转bug</span><a href="#p41-jie-jue-yi-ge-tiao-zhuan-bug" class="header-anchor">#</a></h2>
<p>TypeNav 106行修改（路由跳转）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由跳转</span></span><br><span class="line"><span class="comment">// 如果当前组件路由跳转的时候，地址栏有 params 参数，那么和 query 参数应该一起携带，如果没有，那么携带 query参数即可</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  path,</span><br><span class="line">  params</span><br><span class="line">&#125; = <span class="built_in">this</span>.$route</span><br><span class="line"><span class="comment">// 判断当前的路径有没有 /search</span></span><br><span class="line"><span class="keyword">if</span> (path.indexOf(<span class="string">&#x27;/search&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">    path,</span><br><span class="line">    query,</span><br><span class="line">    params</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">    path: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">    query</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>知识点：</p>
<ul>
<li>路由信息对象 <code>route</code></li>
<li>字符串的<code>indexOf</code> 方法</li>
<li>路由的 <code>params</code> 和 <code>query</code> 传参方式</li>
<li>路由的编程式跳转 <code>push</code> <code>replace</code></li>
</ul>
<p>Header 更新 <code>toSearch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  toSearch() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      path,</span><br><span class="line">      query</span><br><span class="line">    &#125; = <span class="built_in">this</span>.$route</span><br><span class="line">    <span class="comment">// 判断文本框是否输入内容</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.keyword) &#123;</span><br><span class="line">      <span class="comment">// 此时说明文本框中已经有内容</span></span><br><span class="line">      <span class="keyword">if</span> (path.indexOf(<span class="string">&#x27;/search&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 此时说明点击按钮的时候，文本框中有搜索关键字，而且也点击了分类信息</span></span><br><span class="line">        <span class="comment">// 需要携带 params 和 query 参数</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">          name: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">          params: &#123;</span><br><span class="line">            keyword: <span class="built_in">this</span>.keyword</span><br><span class="line">          &#125;,</span><br><span class="line">          query</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 此时说明文本框有搜索关键字，但是没有 search 界面中，所以，也不需要携带 query 参数</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">          name: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">          params: &#123;</span><br><span class="line">            keyword: <span class="built_in">this</span>.keyword</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 此时文本框中没有搜索关键字</span></span><br><span class="line">      <span class="keyword">if</span> (path.indexOf(<span class="string">&#x27;/search&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 确实在 search 中，所以要携带 query 参数</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">          name: <span class="string">&#x27;search&#x27;</span>,</span><br><span class="line">          query</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 没有搜索关键字，也没有在 /search 中</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">          name: <span class="string">&#x27;search&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h2><span id="p42-search-fen-fa-shi-chuan-ru-can-shu">42 Search 分发时传入参数</span><a href="#p42-search-fen-fa-shi-chuan-ru-can-shu" class="header-anchor">#</a></h2>
<p>Search 更新data数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">      category1Id: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 各级分类的id</span></span><br><span class="line">      category2Id: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      category3Id: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      categoryName: <span class="string">&#x27;&#x27;</span>,  <span class="comment">// 分级名字</span></span><br><span class="line">      props: [], <span class="comment">// [&#x27;2218:6.75-6.84英寸:屏幕尺寸&#x27;]---&gt;[&#x27;平台属性的id:属性值:属性名字&#x27;]</span></span><br><span class="line">      trademark: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 品牌的名字  &#x27;品牌的id:品牌的名字&#x27;</span></span><br><span class="line">      order: <span class="string">&#x27;1:desc&#x27;</span>, <span class="comment">// 排序的方式 1---&gt;排序的标识,desc---&gt;排序的方式 ,1--综合,2---价格 ,desc---降序,asc---升序</span></span><br><span class="line">      pageNo: <span class="number">1</span>, <span class="comment">// 获取的是第一页的数据</span></span><br><span class="line">      pageSize: <span class="number">3</span>, <span class="comment">// 默认每页三条数据</span></span><br><span class="line">      keyword: <span class="string">&#x27;&#x27;</span> <span class="comment">// 搜索关键字</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<p>更新mounted数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    query,</span><br><span class="line">    params</span><br><span class="line">  &#125; = <span class="built_in">this</span>.$route</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    ...this.options,</span><br><span class="line">    ...query,</span><br><span class="line">    ...params</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.options = options</span><br><span class="line">  <span class="comment">// 分发 actions</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>更新watch数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  <span class="comment">// to 模版路由器对象</span></span><br><span class="line">  <span class="comment">// from 从哪里来的路由信息对象</span></span><br><span class="line">  $route(to, <span class="keyword">from</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      query,</span><br><span class="line">      params</span><br><span class="line">    &#125; = to</span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">      ...this.options,</span><br><span class="line">      <span class="comment">// 重置数据</span></span><br><span class="line">      category1Id: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      category2Id: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      category3Id: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      categoryName: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      ...query,</span><br><span class="line">      ...params</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.options = options</span><br><span class="line">    <span class="comment">// 分发 actions</span></span><br><span class="line">    <span class="built_in">this</span>.getProductList()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p43-dian-ji-biao-qian-de-yi-chu-yi-ji-di-zhi-de-xiu-zheng">43 点击标签的移除以及地址的修正</span><a href="#p43-dian-ji-biao-qian-de-yi-chu-yi-ji-di-zhi-de-xiu-zheng" class="header-anchor">#</a></h2>
<p>Search 第13行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;fl sui-tag&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 分类信息的名字 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;with-x&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;options.categoryName&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;options.categoryName&#125;&#125;<span class="tag">&lt;<span class="name">i</span> @<span class="attr">click</span>=<span class="string">&quot;removeCategory&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 搜索关键字 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;with-x&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;options.keyword&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;options.keyword&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> @<span class="attr">click</span>=<span class="string">&quot;removeKeyword&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更新 methods</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除分类信息的名字</span></span><br><span class="line">removeCategory() &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.category1Id = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="built_in">this</span>.options.category2Id = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="built_in">this</span>.options.category3Id = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="built_in">this</span>.options.categoryName = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$router.replace(<span class="built_in">this</span>.$route.path)</span><br><span class="line">&#125;,</span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建事件总线 main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  <span class="comment">// 注册路由器</span></span><br><span class="line">  router,</span><br><span class="line">  <span class="comment">// 注册store</span></span><br><span class="line">  store,</span><br><span class="line">  <span class="comment">// 数据初始化之前</span></span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="comment">// 事件总线</span></span><br><span class="line">    Vue.prototype.$bus = <span class="keyword">new</span> Vue()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 渲染组件</span></span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br></pre></td></tr></table></figure>
<p>Header 组件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  <span class="built_in">this</span>.$bus.$on(<span class="string">&#x27;removeKeyword&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.keyword = <span class="string">&#x27;&#x27;</span> <span class="comment">// 清空文本框</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Search 组件 methods</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除搜索关键字</span></span><br><span class="line">removeKeyword() &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.keyword = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment">// 路由跳转</span></span><br><span class="line">  <span class="built_in">this</span>.$router.replace(&#123;</span><br><span class="line">    path: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">    query: <span class="built_in">this</span>.$route.query</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 清理Header组件中的搜索框数据</span></span><br><span class="line">  <span class="built_in">this</span>.$bus.$emit(<span class="string">&#x27;removeKeyword&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p44-dian-ji-pin-pai-biao-qian-jin-xing-shai-xuan">44 点击品牌标签进行筛选</span><a href="#p44-dian-ji-pin-pai-biao-qian-jin-xing-shai-xuan" class="header-anchor">#</a></h2>
<p>Search组件中 methods 加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新品牌的参数数据</span></span><br><span class="line">setTrademark(tmId, tmName) &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.trademark = <span class="string">`<span class="subst">$&#123;tmId&#125;</span>:<span class="subst">$&#123;tmName&#125;</span>`</span></span><br><span class="line">  <span class="comment">// 重新发送请求，获取商品信息数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>26行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--selector--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SearchSelector</span> <span class="attr">:setTrademark</span>=<span class="string">&quot;setTrademark&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>SearchSelector</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name: <span class="string">&#x27;SearchSelector&#x27;</span>,</span><br><span class="line">props: &#123;</span><br><span class="line">  setTrademark: <span class="built_in">Function</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>7行 加点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(tm) in trademarkList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;tm.tmId&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setTrademark(tm.tmId, tm.tmName)&quot;</span>&gt;</span>&#123;&#123;tm.tmName&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Search 23行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 品牌关键字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;with-x&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;options.trademark&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;options.trademark&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> @<span class="attr">click</span>=<span class="string">&quot;removeTrademark&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除品牌的名字</span></span><br><span class="line">removeTrademark()&#123;</span><br><span class="line">  <span class="built_in">this</span>.options.trademark = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment">// 重新发送请求，获取商品信息数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p45-ping-tai-shu-xing-xiang-guan">45 平台属性相关</span><a href="#p45-ping-tai-shu-xing-xiang-guan" class="header-anchor">#</a></h2>
<p>Search methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新平台属性数组的数据</span></span><br><span class="line">addProps(propId, propVal, propName) &#123;</span><br><span class="line">  <span class="comment">// 拼接平台属性的值</span></span><br><span class="line">  <span class="keyword">const</span> prop = <span class="string">`<span class="subst">$&#123;propId&#125;</span>:<span class="subst">$&#123;propVal&#125;</span>:<span class="subst">$&#123;propName&#125;</span>`</span></span><br><span class="line">  <span class="comment">// 判断这该数组中这个数据是否存在，不存在就则增加</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.options.props.indexOf(prop) === <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.options.props.push(prop)</span><br><span class="line">    <span class="comment">// 重新获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.getProductList()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>30行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--selector--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SearchSelector</span> <span class="attr">:setTrademark</span>=<span class="string">&quot;setTrademark&quot;</span> <span class="attr">:addProps</span>=<span class="string">&quot;addProps&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>SearchSelector 更新 props</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  setTrademark: <span class="built_in">Function</span>,</span><br><span class="line">  addProps: <span class="built_in">Function</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>13行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl key&quot;</span>&gt;</span>&#123;&#123;attr.attrName&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>		</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fl value&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;type-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,index) in attr.attrValueList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addProps(attr.attrId,value, attr.attrName)&quot;</span>&gt;</span>&#123;&#123;value&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Search 28行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 平台属性关键字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;with-x&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(prop, index) in options.props&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;prop&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;prop&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">i</span> @<span class="attr">click</span>=<span class="string">&quot;removeProp(index)&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除平台属性数据</span></span><br><span class="line">removeProp(index) &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.props.splice(index, <span class="number">1</span>)</span><br><span class="line">  <span class="comment">// 重新获取数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p46-pai-xu">46 排序</span><a href="#p46-pai-xu" class="header-anchor">#</a></h2>
<p>Search 40行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot; details clearfix&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sui-navbar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-inner filter&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;sui-nav&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:isActive(&#x27;1&#x27;)&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setOrder(&#x27;1&#x27;)&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>综合&#123;&#123;getOrderText(&#x27;1&#x27;)&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>销量<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>新品<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>评价<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:isActive(&#x27;2&#x27;)&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> </span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;setOrder(&#x27;2&#x27;)&quot;</span>&gt;</span>价格&#123;&#123;getOrderText(&#x27;2&#x27;)&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置排序的选项类样式</span></span><br><span class="line">isActive(flag) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.options.order.indexOf(flag) === <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 改变排序的方式</span></span><br><span class="line">setOrder(flag) &#123;</span><br><span class="line">  <span class="comment">// 获取排序的标识和排序方式</span></span><br><span class="line">  <span class="keyword">let</span> [</span><br><span class="line">    orderFlag,</span><br><span class="line">    orderType</span><br><span class="line">  ] = <span class="built_in">this</span>.options.order.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">  <span class="comment">// 判断排序的标识是否一致</span></span><br><span class="line">  <span class="keyword">if</span> (orderFlag === flag) &#123;</span><br><span class="line">    orderType = orderType === <span class="string">&#x27;desc&#x27;</span> ? <span class="string">&#x27;asc&#x27;</span> : <span class="string">&#x27;desc&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    orderFlag = flag <span class="comment">// 标识已经改变</span></span><br><span class="line">    orderType = <span class="string">&#x27;desc&#x27;</span> <span class="comment">// 默认是降序</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 更新参数数据</span></span><br><span class="line">  <span class="built_in">this</span>.options.order = orderFlag + <span class="string">&quot;:&quot;</span> + orderType</span><br><span class="line">  <span class="comment">// 重新获取数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 显示箭头</span></span><br><span class="line">getOrderText(flag) &#123;</span><br><span class="line">  <span class="comment">// 获取排序的标识和方式</span></span><br><span class="line">  <span class="keyword">let</span> [orderFlag, orderType] = <span class="built_in">this</span>.options.order.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">  <span class="comment">// 判断标识符是否一致</span></span><br><span class="line">  <span class="keyword">if</span> (orderFlag === flag) &#123;</span><br><span class="line">    <span class="keyword">return</span> orderType === <span class="string">&#x27;desc&#x27;</span>? <span class="string">&quot;↓&quot;</span>: <span class="string">&quot;↑&quot;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p47-qing-li-kong-shu-ju">47 清理空数据</span><a href="#p47-qing-li-kong-shu-ju" class="header-anchor">#</a></h2>
<p>data 中的数据是响应式的，会触发视图更新</p>
<p>不能用常规方法增加或者删除</p>
<p>用 <code>Vue.get</code> <code>Vue.delete</code></p>
<p>Search 的 data 中 注释</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// trademark: &#x27;&#x27;, // 品牌的名字  &#x27;品牌的id:品牌的名字&#x27;</span></span><br></pre></td></tr></table></figure>
<p>setTrademark  和 removeTrademark 修改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">setTrademark(tmId, tmName) &#123;</span><br><span class="line">  <span class="comment">// 这种方式添加的属性属于非响应式属性数据,</span></span><br><span class="line">  <span class="comment">// 响应式数据:在data中定义的数据,该数据如果发生了变化,页面会自动的渲染</span></span><br><span class="line">  <span class="comment">// this.options.trademark = `$&#123;tmId&#125;:$&#123;tmName&#125;`</span></span><br><span class="line">  <span class="built_in">this</span>.$set(<span class="built_in">this</span>.options, <span class="string">&#x27;trademark&#x27;</span>, <span class="string">`<span class="subst">$&#123;tmId&#125;</span>:<span class="subst">$&#123;tmName&#125;</span>`</span>)</span><br><span class="line">  <span class="comment">// 重新发送请求，获取商品信息数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 移除品牌的名字</span></span><br><span class="line">removeTrademark() &#123;</span><br><span class="line">  <span class="comment">// 是把数据清空,并不是删除</span></span><br><span class="line">  <span class="comment">// this.options.trademark = &#x27;&#x27;</span></span><br><span class="line">  <span class="comment">// 这种方式不是移除响应式数据的操作</span></span><br><span class="line">  <span class="comment">// delete this.options.trademark</span></span><br><span class="line">  <span class="comment">// 删除对象的 property。如果对象是响应式的，确保删除能触发更新视图</span></span><br><span class="line">  <span class="built_in">this</span>.$delete(<span class="built_in">this</span>.options, <span class="string">&#x27;trademark&#x27;</span>)</span><br><span class="line">  <span class="comment">// 重新发送请求，获取商品信息数据</span></span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>store 中的 search.js 的 actions 进行如下更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line">  <span class="comment">// 获取商品信息数据对象</span></span><br><span class="line">  <span class="keyword">async</span> getProductList(&#123;</span><br><span class="line">    commit</span><br><span class="line">  &#125;, searchParams) &#123;</span><br><span class="line">    <span class="comment">// 清理无用的参数数据</span></span><br><span class="line">    <span class="comment">// 浅拷贝</span></span><br><span class="line">    searchParams = &#123;</span><br><span class="line">      ...searchParams</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 优化参数处理</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(searchParams).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 判断这里的数据是不是空的数据，或者是这里的数据</span></span><br><span class="line">        <span class="keyword">if</span> (searchParams[key] === <span class="string">&#x27;&#x27;</span> || searchParams[key] <span class="keyword">instanceof</span> <span class="built_in">Array</span> &amp;&amp; searchParams[key].length === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">delete</span> searchParams[key]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqProductList(searchParams)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_PRODUCT_LIST&#x27;</span>, result.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-23-ri-day-5">9月23日（day 5）</span><a href="#9-yue-23-ri-day-5" class="header-anchor">#</a></h1>
<h2><span id="p48-fen-ye-zu-jian">48 分页组件</span><a href="#p48-fen-ye-zu-jian" class="header-anchor">#</a></h2>
<p>思路：分页组件（Pagination）要注册为公共组件（多次使用）</p>
<p>components  中新建 Pagination 目录 新建 index.vue （直接拷贝以下代码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!--分页组件--&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;pagination&quot; v-if&#x3D;&quot;pageConfig.total&gt;0&quot;&gt;</span><br><span class="line">    &lt;!--上一页--&gt;</span><br><span class="line">    &lt;button :disabled&#x3D;&quot;currentPage&#x3D;&#x3D;&#x3D;1&quot; @click&#x3D;&quot;changeCurrentPage(currentPage-1)&quot;&gt;上一页&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 第1页 --&gt;</span><br><span class="line">    &lt;button v-if&#x3D;&quot;startEnd.start&gt;1&quot; @click&#x3D;&quot;changeCurrentPage(1)&quot;&gt;1&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 省略号 start&gt;2才显示 --&gt;</span><br><span class="line">    &lt;button disabled v-if&#x3D;&quot;startEnd.start&gt;2&quot;&gt;···&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 连续页码 --&gt;</span><br><span class="line">    &lt;button v-for&#x3D;&quot;no in startEnd.end&quot; :key&#x3D;&quot;no&quot; v-if&#x3D;&quot;no&gt;&#x3D;startEnd.start&quot; :class&#x3D;&quot;&#123;active: currentPage&#x3D;&#x3D;&#x3D;no&#125;&quot;</span><br><span class="line">      @click&#x3D;&quot;changeCurrentPage(no)&quot;&gt;&#123;&#123;no&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 34567 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 省略号 end&lt;totalPages-1  --&gt;</span><br><span class="line">    &lt;button disabled v-if&#x3D;&quot;startEnd.end&lt;totalPages-1&quot;&gt;···&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 最后一页 --&gt;</span><br><span class="line">    &lt;button v-if&#x3D;&quot;startEnd.end&lt;totalPages&quot; @click&#x3D;&quot;changeCurrentPage(totalPages)&quot;&gt;&#123;&#123;totalPages&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!--下一页--&gt;</span><br><span class="line">    &lt;button :disabled&#x3D;&quot;currentPage&#x3D;&#x3D;&#x3D;totalPages&quot; @click&#x3D;&quot;changeCurrentPage(currentPage+1)&quot;&gt;下一页&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 总记录数 --&gt;</span><br><span class="line">    &lt;button disabled style&#x3D;&quot;margin-left: 30px&quot;&gt;共 &#123;&#123;pageConfig.total&#125;&#125; 条&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#39;Pagination&#39;,</span><br><span class="line"></span><br><span class="line">    props: &#123;</span><br><span class="line">      pageConfig: &#123;</span><br><span class="line">        type: Object,</span><br><span class="line">        default: &#123;</span><br><span class="line">          total: 0, &#x2F;&#x2F; 总数据个数</span><br><span class="line">          showPageNo: 5, &#x2F;&#x2F; 连续显示的页码数</span><br><span class="line">          pageNo: 1, &#x2F;&#x2F; 当前页码</span><br><span class="line">          pageSize: 10 &#x2F;&#x2F; 每页的数据个数</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    data() &#123;</span><br><span class="line">      &#x2F;&#x2F; 在data中可以读取props和Vue原型对象上的属性</span><br><span class="line">      &#x2F;&#x2F; console.log(&#39;----&#39;, this.pageConfig, this.$bus)</span><br><span class="line">      &#x2F;&#x2F; 在data()中不可以直接读取data对象中的数据</span><br><span class="line">      &#x2F;&#x2F; console.log(&#39;++++&#39;, this.currentPage)</span><br><span class="line"></span><br><span class="line">      return &#123;</span><br><span class="line">        currentPage: this.pageConfig.pageNo &#x2F;&#x2F; 当前页码</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    computed: &#123;</span><br><span class="line">      &#x2F;* </span><br><span class="line">        总页码数</span><br><span class="line">        *&#x2F;</span><br><span class="line">      totalPages() &#123;</span><br><span class="line">        &#x2F;&#x2F; 取出总数量和每页记录数     36 &#x2F; 5  &#x3D;&#x3D;&gt; 8页</span><br><span class="line">        const &#123;</span><br><span class="line">          total,</span><br><span class="line">          pageSize</span><br><span class="line">        &#125; &#x3D; this.pageConfig</span><br><span class="line">        if (total &lt;&#x3D; 0 || pageSize &lt;&#x3D; 0) return 0</span><br><span class="line"></span><br><span class="line">        return Math.ceil(total &#x2F; pageSize) &#x2F;&#x2F; 需要向上取整</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#x2F;* </span><br><span class="line">        计算得到连续页码的start和end </span><br><span class="line">            连续页码数: pageConfig.showPageNo   5</span><br><span class="line">            当前页码: currentPage    4       23456</span><br><span class="line">            总页码数: totalPages 10&#x2F;5</span><br><span class="line">        *&#x2F;</span><br><span class="line">      startEnd() &#123;</span><br><span class="line">        let start &#x3D; 0</span><br><span class="line">        let end &#x3D; 0</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 取出相关数据</span><br><span class="line">        &#x2F;&#x2F; const &#123; showPageNo &#125; &#x3D; this.pageConfig</span><br><span class="line">        &#x2F;&#x2F; const &#123;totalPages, currentPage&#125; &#x3D; this</span><br><span class="line">        const &#123;</span><br><span class="line">          totalPages,</span><br><span class="line">          currentPage,</span><br><span class="line">          pageConfig: &#123;</span><br><span class="line">            showPageNo</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; &#x3D; this &#x2F;&#x2F; 多层级对象解构</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 计算后更新start和end</span><br><span class="line">        &#x2F;* </span><br><span class="line">          currentPage  showPageNo  totalPages</span><br><span class="line">            4             5             10     23456</span><br><span class="line">            2             5             10     123445</span><br><span class="line">            9             5             10     6789 10</span><br><span class="line">          *&#x2F;</span><br><span class="line">        &#x2F;&#x2F; 计算start</span><br><span class="line">        start &#x3D; currentPage - Math.floor(showPageNo &#x2F; 2)</span><br><span class="line">        &#x2F;&#x2F; 如果start页码小于1, 就为1</span><br><span class="line">        if (start &lt; 1) &#123;</span><br><span class="line">          start &#x3D; 1</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 计算end</span><br><span class="line">        &#x2F;* </span><br><span class="line">          9             5             10     </span><br><span class="line">          start &#x3D; 7  &#x3D;&#x3D;&#x3D;&gt; 6</span><br><span class="line">          end &#x3D;7 + 4 &#x3D; 11  &#x3D;&#x3D;&gt; end &#x3D; 10</span><br><span class="line"></span><br><span class="line">          2             5               3</span><br><span class="line">          start &#x3D; 1 </span><br><span class="line">          end &#x3D; 3</span><br><span class="line">          start &#x3D; -1 </span><br><span class="line">          *&#x2F;</span><br><span class="line">        end &#x3D; start + showPageNo - 1</span><br><span class="line">        &#x2F;&#x2F; 如果end大于了总页码数</span><br><span class="line">        if (end &gt; totalPages) &#123;</span><br><span class="line">          &#x2F;&#x2F; end值为总页码数</span><br><span class="line">          end &#x3D; totalPages</span><br><span class="line">          &#x2F;&#x2F; 修正start: 让start到end为showPageNo</span><br><span class="line">          start &#x3D; end - showPageNo + 1</span><br><span class="line">          &#x2F;&#x2F; 如果start小于1, 指定为1</span><br><span class="line">          if (start &lt; 1) &#123;</span><br><span class="line">            start &#x3D; 1</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return &#123;</span><br><span class="line">          start,</span><br><span class="line">          end</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      &#x2F;* </span><br><span class="line">        要根据已有数据计算出连续页码的start和end</span><br><span class="line">        *&#x2F;</span><br><span class="line">      startEnd2() &#123;</span><br><span class="line">        &#x2F;&#x2F; 得到已有依赖数据</span><br><span class="line">        &#x2F;&#x2F; 当前页码 &#x2F; 连续数码数 &#x2F; 总页码数</span><br><span class="line">        const currentPage &#x3D; this.currentPage</span><br><span class="line">        const showPageNo &#x3D; this.pageConfig.showPageNo</span><br><span class="line">        const totalPages &#x3D; this.totalPages</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 计算产生需要的数据</span><br><span class="line">        let start &#x3D; 0</span><br><span class="line">        let end &#x3D; 0</span><br><span class="line">        &#x2F;* </span><br><span class="line">          currentPage  showPageNo  totalPages</span><br><span class="line">            4             5             10     &#x3D;&#x3D;&gt; start &#x3D; 4 - 2</span><br><span class="line">          *&#x2F;</span><br><span class="line">        start &#x3D; currentPage - Math.floor(showPageNo &#x2F; 2)</span><br><span class="line"></span><br><span class="line">        &#x2F;* </span><br><span class="line">          currentPage  showPageNo  totalPages</span><br><span class="line">            2             5             10     &#x3D;&#x3D;&gt; start &#x3D; 2 - 2 不对  应该是1</span><br><span class="line">          *&#x2F;</span><br><span class="line">        if (start &lt; 1) &#123;</span><br><span class="line">          start &#x3D; 1</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;* </span><br><span class="line">          currentPage  showPageNo  totalPages</span><br><span class="line">            4             5             10     &#x3D;&#x3D;&gt;   start + 5 -1</span><br><span class="line">         *&#x2F;</span><br><span class="line">        &#x2F;&#x2F; end &#x3D; currentPage + Math.floor(showPageNo&#x2F;2)</span><br><span class="line">        &#x2F;&#x2F; start&#x3D;1 &#x3D;&#x3D;&gt; 1 + 5 -1   5</span><br><span class="line">        &#x2F;&#x2F; start&#x3D;4 &#x3D;&#x3D;&#x3D;&gt; 4 + 5 -1  8</span><br><span class="line">        end &#x3D; start + showPageNo - 1</span><br><span class="line">        &#x2F;* </span><br><span class="line">          currentPage  showPageNo  totalPages</span><br><span class="line">            9             5             10     &#x3D;&#x3D;&gt; end &#x3D; 11   9 + 2  超过了最大页码</span><br><span class="line">         *&#x2F;</span><br><span class="line">        if (end &gt; totalPages) &#123;</span><br><span class="line">          end &#x3D; totalPages &#x2F;&#x2F; 如果end超过了最大页码, 修正为最大页码</span><br><span class="line"></span><br><span class="line">          &#x2F;* </span><br><span class="line">             currentPage  showPageNo  totalPages</span><br><span class="line">              9             5             10</span><br><span class="line">              start &#x3D; 9 - 2  应该是6</span><br><span class="line">              end &#x3D; 10</span><br><span class="line">            *&#x2F;</span><br><span class="line">          start &#x3D; end - showPageNo + 1 &#x2F;&#x2F; 10 - 5 + 1</span><br><span class="line"></span><br><span class="line">          &#x2F;&#x2F; 如果start小于1, 指定为1</span><br><span class="line">          if (start &lt; 1) &#123;</span><br><span class="line">            start &#x3D; 1</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 返回数据</span><br><span class="line">        return &#123;</span><br><span class="line">          start,</span><br><span class="line">          end</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    watch: &#123;</span><br><span class="line">      &#x2F;*</span><br><span class="line">        当接收的pageConfig中的pageNo发生改变调用 </span><br><span class="line">         *&#x2F;</span><br><span class="line">      &#39;pageConfig.pageNo&#39;(value) &#123;</span><br><span class="line">        &#x2F;&#x2F; 将当前页码指定为外部传入的值</span><br><span class="line">        this.currentPage &#x3D; value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">      &#x2F;* </span><br><span class="line">        将当前页码改为指定页码</span><br><span class="line">        *&#x2F;</span><br><span class="line">      changeCurrentPage(page) &#123;</span><br><span class="line">        &#x2F;&#x2F; 修改当前页码</span><br><span class="line">        this.currentPage &#x3D; page</span><br><span class="line">        &#x2F;&#x2F; 通知外部父组件</span><br><span class="line">        this.$emit(&#39;changeCurrentPage&#39;, page)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      &#x2F;&#x2F; beforeCreate()在data()之前执行</span><br><span class="line">      &#x2F;&#x2F; console.log(&#39;beforeCreate()&#39;, this.currentPage) &#x2F;&#x2F; undefined</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      &#x2F;&#x2F; created()在data()之后执行</span><br><span class="line">      &#x2F;&#x2F; console.log(&#39;created()&#39;, this.currentPage) &#x2F;&#x2F; 有值</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;</span><br><span class="line">  .pagination &#123;</span><br><span class="line">    button &#123;</span><br><span class="line">      margin: 0 5px;</span><br><span class="line">      background-color: #f4f4f5;</span><br><span class="line">      color: #606266;</span><br><span class="line">      outline: none;</span><br><span class="line">      border-radius: 2px;</span><br><span class="line">      padding: 0 4px;</span><br><span class="line">      vertical-align: top;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      font-size: 13px;</span><br><span class="line">      min-width: 35.5px;</span><br><span class="line">      height: 28px;</span><br><span class="line">      line-height: 28px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">      box-sizing: border-box;</span><br><span class="line">      text-align: center;</span><br><span class="line">      border: 0;</span><br><span class="line"></span><br><span class="line">      &amp;[disabled] &#123;</span><br><span class="line">        color: #c0c4cc;</span><br><span class="line">        cursor: not-allowed;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      &amp;.active &#123;</span><br><span class="line">        cursor: not-allowed;</span><br><span class="line">        background-color: #409eff;</span><br><span class="line">        color: #fff;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>main.js 中注册为公共组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入分页组件</span></span><br><span class="line"><span class="keyword">import</span> Pagination <span class="keyword">from</span> <span class="string">&#x27;@/components/Pagination&#x27;</span></span><br><span class="line">Vue.component(<span class="string">&#x27;Pagination&#x27;</span>, Pagination)</span><br></pre></td></tr></table></figure>
<p>Search 组件中使用 Pagination 需要传入一个对象 pageConfig</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 89行</span><br><span class="line">          <span class="comment">&lt;!-- 分页 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fr page&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pagination</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:pageConfig</span>=<span class="string">&quot;&#123;total:productList.total, pageNo:options.pageNo, pageSize:options.pageSize, showPageNo:5&#125;&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">changeCurrentPage</span>=<span class="string">&quot;changeCurrentPage&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 中新增一个自定义事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义事件</span></span><br><span class="line">changeCurrentPage(pageNo) &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.pageNo = pageNo</span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>此时可以实现分页效果。</p>
<h2><span id="p49-zi-ji-shi-xian-fen-ye-zu-jian">49 自己实现分页组件</span><a href="#p49-zi-ji-shi-xian-fen-ye-zu-jian" class="header-anchor">#</a></h2>
<p>开发通用组件的思路流程</p>
<ol>
<li>搭建结构和样式（html + css）</li>
<li>初始化数据（data）</li>
<li>接收调用该组件的时候传入的数据（props） - 考虑健壮性，要有默认值</li>
<li>考虑接收什么样的事件或者函数</li>
<li>制作组件</li>
<li>制作组件使用的文档</li>
</ol>
<p>分页组件，有数据才能使用，没有数据也不能报错</p>
<p>可以分成八块（上一页，第一页，省略号，连续页码，省略号，最后一页，下一页，共多少条）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!--分页组件 有数据才能使用，没有数据，也不能报错--&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;pagination&quot;&gt;</span><br><span class="line">    &lt;!-- 上一页 --&gt;</span><br><span class="line">    &lt;button disabled&gt;上一页&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 第一页 --&gt;</span><br><span class="line">    &lt;button&gt;1&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 省略号 --&gt;</span><br><span class="line">    &lt;button disabled&gt;···&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 连续页码 --&gt;</span><br><span class="line">    &lt;button&gt;连续页码&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 省略号 --&gt;</span><br><span class="line">    &lt;button disabled&gt;···&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 最后一页 --&gt;</span><br><span class="line">    &lt;button&gt;200&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 下一页 --&gt;</span><br><span class="line">    &lt;button disabled&gt;下一页&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;!-- 共多少条 --&gt;</span><br><span class="line">    &lt;button disabled key&#x3D;&quot;&quot; style&#x3D;&quot;margin-left: 30px&quot;&gt;共 1000 条&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>
<p>传入的数据</p>
<ul>
<li>总条数 total</li>
<li>默认选中的页码 pageNo</li>
<li>每页显示的条数 pageSize</li>
<li>连续的页码 showPageNo</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  pageConfig: &#123;</span><br><span class="line">    type: <span class="built_in">Object</span>, <span class="comment">// 限制传入的数据的类型</span></span><br><span class="line">    <span class="keyword">default</span>: &#123; <span class="comment">// 设置默认的值</span></span><br><span class="line">      total: <span class="number">0</span>, <span class="comment">// 总条数</span></span><br><span class="line">      pageNo: <span class="number">1</span>, <span class="comment">// 默认的第一页</span></span><br><span class="line">      pageSize: <span class="number">5</span>, <span class="comment">// 每页显示多少条</span></span><br><span class="line">      showPageNo: <span class="number">5</span> <span class="comment">// 连续显示的页码数</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 选中的页面 --&gt; 页码会随时变化</span></span><br><span class="line">    currentPage: <span class="built_in">this</span>.pageConfig.pageNo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>计算总的页码数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// 计算总的页码数</span></span><br><span class="line">  totalPage() &#123;</span><br><span class="line">    <span class="comment">// 获取总条数和每页的数据条数</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      total,</span><br><span class="line">      pageSize</span><br><span class="line">    &#125; = <span class="built_in">this</span>.pageConfig</span><br><span class="line">    <span class="comment">// 判断</span></span><br><span class="line">    <span class="keyword">if</span> (total &lt; <span class="number">0</span> || pageSize &lt; <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// 计算总的页码数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(total / pageSize)</span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="comment">// 计算连续页码的开始页码和结束页码</span></span><br><span class="line">  startEnd() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      currentPage,</span><br><span class="line">      totalPage,</span><br><span class="line">      pageConfig: &#123;</span><br><span class="line">        showPageNo</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 开始页码</span></span><br><span class="line">    <span class="keyword">let</span> start = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 结束页码</span></span><br><span class="line">    <span class="keyword">let</span> end = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 计算开始页码 当前页码 - 向下取整（连续页码/2）</span></span><br><span class="line">    start = currentPage - <span class="built_in">Math</span>.floor(showPageNo / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> (start &lt; <span class="number">1</span>) start = <span class="number">1</span></span><br><span class="line">    <span class="comment">// 计算结束页码 当前页码 + 向下取整（连续页码/2）</span></span><br><span class="line">    <span class="comment">//             开始页码 + 连续页码 -1</span></span><br><span class="line">    <span class="comment">// end = currentPage + Math.floor(showPageNo / 2)</span></span><br><span class="line">    end = start + showPageNo - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (end &gt; totalPage) &#123;</span><br><span class="line">      end = totalPage</span><br><span class="line">      <span class="comment">// 修正一下开始页码</span></span><br><span class="line">      start = totalPage - showPageNo + <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (start &lt; <span class="number">1</span>) start = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      start,</span><br><span class="line">      end</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>上一页</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 上一页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;currentPage===1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(currentPage-1)&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  changeCurrentPage(pageNo) &#123;</span><br><span class="line">    <span class="comment">// 更新当前的页码</span></span><br><span class="line">    <span class="built_in">this</span>.currentPage = pageNo</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>第一页</p>
<p>省略号</p>
<p>下一页</p>
<p>等等</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--分页组件 有数据才能使用，没有数据，也不能报错--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--上一页--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;currentPage===1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(currentPage-1)&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--第一页--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;startEnd.start&gt;1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(1)&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--第一个省略号--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span> <span class="attr">v-if</span>=<span class="string">&quot;startEnd.start&gt;2&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--连续页码--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;no&gt;=startEnd.start&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;no in startEnd.end&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;no&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(no)&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;&#123;active:currentPage===no&#125;&quot;</span>&gt;</span>&#123;&#123;no&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--第二个省略号--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span> <span class="attr">v-if</span>=<span class="string">&quot;startEnd.end&lt;totalPage-1&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--最后一页--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-if</span>=<span class="string">&quot;startEnd.end&lt;totalPage&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(totalPage)&quot;</span>&gt;</span>&#123;&#123;totalPage&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--下一页--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;currentPage===totalPage&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentPage(currentPage+1)&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--共多少条--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span> <span class="attr">style</span>=<span class="string">&quot;margin-left:30px&quot;</span>&gt;</span>共&#123;&#123;pageConfig.total&#125;&#125;条<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更新methods</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  changeCurrentPage(pageNo) &#123;</span><br><span class="line">    <span class="comment">// 更新当前的页面</span></span><br><span class="line">    <span class="built_in">this</span>.currentPage = pageNo</span><br><span class="line">    <span class="comment">// 通知父级组件，页码改变了，父级组件需重新获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;changeCurrentPage&#x27;</span>, pageNo)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Search 组件中 method</p>
<p>更新这个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 获取商品信息数据对象</span></span><br><span class="line">  getProductList(pageNo = <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.options.pageNo = pageNo</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getProductList&#x27;</span>, <span class="built_in">this</span>.options)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>删除这个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义事件</span></span><br><span class="line">changeCurrentPage(pageNo) &#123;</span><br><span class="line">  <span class="built_in">this</span>.options.pageNo = pageNo</span><br><span class="line">  <span class="built_in">this</span>.getProductList()</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>更新这里</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;fr page&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Pagination</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:pageConfig</span>=<span class="string">&quot;&#123;total:productList.total, pageNo:options.pageNo, pageSize:options.pageSize, showPageNo:5&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">changeCurrentPage</span>=<span class="string">&quot;getProductList&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Pagination 中新增一个 watch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">watch:&#123;</span><br><span class="line">  <span class="comment">// 监视的是传入的页码值，如果变化了，立即更新当前的页码</span></span><br><span class="line">  <span class="string">&#x27;pageConfig.pageNo&#x27;</span>(val)&#123;</span><br><span class="line">    <span class="comment">// 立即更新当前的页码</span></span><br><span class="line">    <span class="built_in">this</span>.currentPage = val</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p50-mei-you-shu-ju-de-shi-hou-fen-ye-zu-jian-de-xiang-guan-chu-li">50 没有数据的时候，分页组件的相关处理</span><a href="#p50-mei-you-shu-ju-de-shi-hou-fen-ye-zu-jian-de-xiang-guan-chu-li" class="header-anchor">#</a></h2>
<p>加个 v-if</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--分页组件,有数据才能使用,没有数据,也不能报错--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;pageConfig.total&gt;0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p51-shang-pin-xiang-qing-ye">51 商品详情页</span><a href="#p51-shang-pin-xiang-qing-ye" class="header-anchor">#</a></h2>
<p>制作路由组件 Detail （直接搬运到pages）</p>
<p>routes.js 中注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">&#x27;@/pages/Detail&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 33行</span></span><br><span class="line">  <span class="comment">// Detail组件 -- 详情页 -- params</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/detail/:skuId&#x27;</span>,</span><br><span class="line">    component: Detail,</span><br><span class="line">    name: <span class="string">&#x27;detail&#x27;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>Search 组件中设置 图片和名称 的路由链接跳转</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 63行</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;goods-list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;yui3-g&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;yui3-u-1-5&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;goods in goodsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;goods.id&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list-wrap&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;p-img&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 产品的图片 --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- &lt;a href=&quot;item.html&quot; target=&quot;_blank&quot;&gt;</span></span><br><span class="line"><span class="comment">                      &lt;img :src=&quot;goods.defaultImg&quot; /&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/a&gt; --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/detail/$&#123;goods.id&#125;`&quot;</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;goods.defaultImg&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">em</span>&gt;</span>¥<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123;goods.price&#125;&#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;attr&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 产品的名字 --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- &lt;a target=&quot;_blank&quot; href=&quot;item.html&quot; :title=&quot;goods.title&quot; v-html=&quot;goods.title&quot;&gt;&lt;/a&gt; --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/detail/$&#123;goods.id&#125;`&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;goods.title&quot;</span> <span class="attr">v-html</span>=<span class="string">&quot;goods.title&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>点击跳转后，并不能在最上面，此时 scrollBehavior 来控制</p>
<p>更新 router/index 中这个部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化路由器对象,并暴露出去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>, <span class="comment">// 地址栏中不带#</span></span><br><span class="line">  routes,</span><br><span class="line">  <span class="comment">// 解决路由器跳转到滚动的位置的问题</span></span><br><span class="line">  scrollBehavior(to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      x: <span class="number">0</span>,</span><br><span class="line">      y: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="p52-shang-pin-xiang-qing-ye-jie-kou">52 商品详情页-接口</span><a href="#p52-shang-pin-xiang-qing-ye-jie-kou" class="header-anchor">#</a></h2>
<p>测试接口，在api/index.js 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 商品详情页接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqDetailInfo = <span class="function">(<span class="params">skuId</span>) =&gt;</span> ajax.get(<span class="string">`/item/<span class="subst">$&#123;skuId&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="p53-feng-zhuang-vuex">53 封装 Vuex</span><a href="#p53-feng-zhuang-vuex" class="header-anchor">#</a></h2>
<p>store/modules/detail.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqDetailInfo</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    <span class="comment">// 商品的详情信息对象</span></span><br><span class="line">    detailInfo: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接修改商品详情信息对象数据</span></span><br><span class="line">    RECEIVE_DETAIL_INFO(state, detailInfo) &#123;</span><br><span class="line">      state.detailInfo = detailInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 异步请求获取</span></span><br><span class="line">    <span class="keyword">async</span> getDetailInfo(&#123;</span><br><span class="line">      commit</span><br><span class="line">    &#125;, skuId) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqDetailInfo(skuId)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_DETAIL_INFO&#x27;</span>, result.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="comment">// 分类信息对象</span></span><br><span class="line">    categoryView(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.detailInfo.categoryView || []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 销售属性数组</span></span><br><span class="line">    spuSaleAttrList(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.detailInfo.spuSaleAttrList || []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 单个产品的信息对象</span></span><br><span class="line">    skuInfo(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.detailInfo.skuInfo || []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 图片轮播图数组</span></span><br><span class="line">    skuImageList(state) &#123;</span><br><span class="line">      <span class="keyword">const</span> skuInfo = state.detailInfo.skuInfo</span><br><span class="line">      <span class="keyword">return</span> skuInfo ? skuInfo.skuImageList : []</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js 引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> detail <span class="keyword">from</span> <span class="string">&#x27;./detail&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home,</span><br><span class="line">  search,</span><br><span class="line">  detail</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p54-xian-shi-ji-ben-xin-xi">54 显示基本信息</span><a href="#p54-xian-shi-ji-ben-xin-xi" class="header-anchor">#</a></h2>
<p>Detail 当详情页加载完毕根据id要获取当前商品信息数据对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="comment">// 引入图片轮播图组件</span></span><br><span class="line">  <span class="keyword">import</span> ImageList <span class="keyword">from</span> <span class="string">&#x27;./ImageList/ImageList&#x27;</span></span><br><span class="line">  <span class="comment">// 引入放大镜组件</span></span><br><span class="line">  <span class="keyword">import</span> Zoom <span class="keyword">from</span> <span class="string">&#x27;./Zoom/Zoom&#x27;</span></span><br><span class="line">  <span class="comment">// 引入 Vuex 辅助函数</span></span><br><span class="line">  <span class="keyword">import</span> &#123;</span><br><span class="line">    mapGetters</span><br><span class="line">  &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">&#x27;Detail&#x27;</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">      ImageList,</span><br><span class="line">      Zoom</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 组件界面渲染完毕后的生命周期回调</span></span><br><span class="line">    <span class="keyword">async</span> mounted() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        skuId</span><br><span class="line">      &#125; = <span class="built_in">this</span>.$route.params</span><br><span class="line">      <span class="comment">// 调用接口 -- 分发actions</span></span><br><span class="line">      <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getDetailInfo&#x27;</span>, skuId)</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      ...mapGetters([<span class="string">&#x27;categoryView&#x27;</span>, <span class="string">&#x27;spuSaleAttrList&#x27;</span>, <span class="string">&#x27;skuInfo&#x27;</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 8</span><br><span class="line">      &lt;!-- 导航路径区域 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;conPoin&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123;categoryView.category1Name&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123;categoryView.category2Name&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123;categoryView.category3Name&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 23</span><br><span class="line">        &lt;!-- 右侧选择区域布局 --&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;InfoWrap&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;goodsDetail&quot;&gt;</span><br><span class="line">            &lt;h3 class&#x3D;&quot;InfoName&quot;&gt;&#123;&#123;skuInfo.skuName&#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">            &lt;p class&#x3D;&quot;news&quot;&gt;&#123;&#123;skuInfo.skuDesc&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;priceArea&quot;&gt;</span><br><span class="line">              &lt;div class&#x3D;&quot;priceArea1&quot;&gt;</span><br><span class="line">                &lt;div class&#x3D;&quot;title&quot;&gt;价&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;格&lt;&#x2F;div&gt;</span><br><span class="line">                &lt;div class&#x3D;&quot;price&quot;&gt;</span><br><span class="line">                  &lt;i&gt;¥&lt;&#x2F;i&gt;</span><br><span class="line">                  &lt;em&gt;&#123;&#123;skuInfo.price&#125;&#125;&lt;&#x2F;em&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p55-bian-li-xiao-shou-shu-xing">55 遍历销售属性</span><a href="#p55-bian-li-xiao-shou-shu-xing" class="header-anchor">#</a></h2>
<p>Detail 63</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 销售属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;choose&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chooseArea&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;choosed&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">v-for</span>=<span class="string">&quot;(attr,index) in spuSaleAttrList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;attr.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dt</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;attr.saleAttrName&#125;&#125;<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dd</span> <span class="attr">changepirce</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:spuVal.isChecked===`1`&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;(spuVal, index) in attr.spuSaleAttrValueList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;spuVal.id&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;setChecked(spuVal, attr.spuSaleAttrValueList)&quot;</span>&gt;</span>&#123;&#123;spuVal.saleAttrValueName&#125;&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加 methods 及方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  setChecked(spuVal, valueList) &#123;</span><br><span class="line">    <span class="comment">// 排他效果，先把数组中每个销售属性值对象置0</span></span><br><span class="line">    valueList.forEach(<span class="function"><span class="params">v</span> =&gt;</span> v.isChecked = <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment">// 只有当前点击的这个属性值为1</span></span><br><span class="line">    spuVal.isChecked = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-24-ri-day-6">9月24日（day 6）</span><a href="#9-yue-24-ri-day-6" class="header-anchor">#</a></h1>
<h2><span id="p56-shu-liang-de-zeng-jia-he-jian-shao-cao-zuo">56 数量的增加和减少操作</span><a href="#p56-shu-liang-de-zeng-jia-he-jian-shao-cao-zuo" class="header-anchor">#</a></h2>
<p>默认值设为1，不能设置为0（减少用户的操作，更好的体验）</p>
<p>在 Detail  的 data 中创建 skuNum</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    skuNum: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>第75行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 75</span><br><span class="line">              <span class="comment">&lt;!-- 数量的增加和减少操作 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">                                                       <span class="comment">&lt;!-- 这里 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;skuNum&quot;</span> /&gt;</span></span><br><span class="line">                                                   <span class="comment">&lt;!-- 这里 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span> <span class="attr">class</span>=<span class="string">&quot;plus&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;skuNum++&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mins&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;skuNum&gt;1?skuNum--:</span></span></span><br><span class="line"><span class="tag"><span class="string">                  &#x27;&#x27;&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p57-xian-shi-xiang-qing-tu-pian-lun-bo">57 显示详情图片（轮播）</span><a href="#p57-xian-shi-xiang-qing-tu-pian-lun-bo" class="header-anchor">#</a></h2>
<p>ImageList 中更新</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span></span><br><span class="line">                              <span class="comment">&lt;!-- 这里 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(skuImg, index) in skuImageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;skuImg.id&quot;</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 这里 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;skuImg.imgUrl&quot;</span> <span class="attr">:class:</span>=<span class="string">&quot;&#123;active:currentIndex===index&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 剩下的img都删除 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">    <span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">&#x27;swiper&#x27;</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        name: <span class="string">&quot;ImageList&quot;</span>,</span><br><span class="line">        data() &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                currentIndex: <span class="number">0</span>, <span class="comment">// 储存某个图片索引</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">          ...mapGetters([<span class="string">&#x27;skuImageList&#x27;</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p58-yin-ru-lun-bo-tu-zu-jian">58 引入轮播图组件</span><a href="#p58-yin-ru-lun-bo-tu-zu-jian" class="header-anchor">#</a></h2>
<p>ImageList 更新（直接CV）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-container&quot;</span> <span class="attr">id</span>=<span class="string">&quot;swL&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sw4&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 轮播图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(carousel,index) in skuImageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;carousel.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;carousel.imgUrl&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:currentIndex===index&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;currentIndex=index&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-prev&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Swiper <span class="keyword">from</span> <span class="string">&#x27;swiper&#x27;</span></span><br></pre></td></tr></table></figure>
<p>增加 watch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  skuImageList: &#123;</span><br><span class="line">    <span class="comment">// 该回调会在监听开始被立即调用</span></span><br><span class="line">    handler: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.skuImageList.length === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> mySwiper = <span class="keyword">new</span> Swiper(<span class="built_in">this</span>.$refs.sw4, &#123;</span><br><span class="line">          <span class="comment">// 每一屏中显示图片的数量</span></span><br><span class="line">          slidesPerView: <span class="number">5</span>,</span><br><span class="line">          <span class="comment">// 每次移动图片的数量</span></span><br><span class="line">          slidesPerGroup: <span class="number">2</span>,</span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">&#x27;.swiper-pagination&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 如果需要前进后退按钮</span></span><br><span class="line">          navigation: &#123;</span><br><span class="line">            nextEl: <span class="string">&#x27;.swiper-button-next&#x27;</span>,</span><br><span class="line">            prevEl: <span class="string">&#x27;.swiper-button-prev&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// immediate</span></span><br><span class="line">    immediate: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p59-fang-da-jing-1">59 放大镜1</span><a href="#p59-fang-da-jing-1" class="header-anchor">#</a></h2>
<p>ImageList</p>
<p>更新点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-container&quot;</span> <span class="attr">id</span>=<span class="string">&quot;swL&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sw4&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 轮播图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-wrapper&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(carousel,index) in skuImageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;carousel.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 更新点击事件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;carousel.imgUrl&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;active:currentIndex===index&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCurrentIndex(index)&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-next&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-button-prev&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">  changeCurrentIndex(index)&#123;</span><br><span class="line">    <span class="comment">// 修改当前图片的选中的索引</span></span><br><span class="line">    <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">    <span class="comment">// 分发父级组件的事件</span></span><br><span class="line">    <span class="built_in">this</span>.$emit(<span class="string">&#x27;changeCurrentIndex&#x27;</span>, index)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Detail 15行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 左侧放大镜区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;previewWrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--放大镜效果--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Zoom</span> <span class="attr">v-if</span>=<span class="string">&quot;skuImageList.length&gt;0&quot;</span> <span class="attr">:imgUrl</span>=<span class="string">&quot;skuImageList[currentImageIndex].imgUrl&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:bigImgUrl</span>=<span class="string">&quot;skuImageList[currentImageIndex].imgUrl&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 小图列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ImageList</span> @<span class="attr">changeCurrentIndex</span>=<span class="string">&quot;changeCurrentIndex&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更新data</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    skuNum: <span class="number">1</span>, <span class="comment">// 该产品默认的数量</span></span><br><span class="line">    currentImageIndex: <span class="number">0</span> <span class="comment">// 储存轮播图选择索引</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>更新computed</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapGetters([<span class="string">&#x27;categoryView&#x27;</span>, <span class="string">&#x27;spuSaleAttrList&#x27;</span>, <span class="string">&#x27;skuInfo&#x27;</span>, <span class="string">&#x27;skuImageList&#x27;</span>])</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子级组件 imageList中点击某个小图 该图的索引 传递过来</span></span><br><span class="line">changeCurrentIndex(index) &#123;</span><br><span class="line">  <span class="built_in">this</span>.currentImageIndex = index</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>Zoom 中更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;spec-preview&quot;&gt;</span><br><span class="line">    &lt;img :src&#x3D;&quot;imgUrl&quot; &#x2F;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;mask&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;big&quot;&gt;</span><br><span class="line">      &lt;img src&#x3D;&quot;bigImgUrl&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;small&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;Zoom&quot;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      imgUrl: String,</span><br><span class="line">      bigImgUrl: String</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p60-fang-da-jing-2">60 放大镜2</span><a href="#p60-fang-da-jing-2" class="header-anchor">#</a></h2>
<p>Zoom 替换</p>
<ul>
<li>mask --&gt; event</li>
<li>small --&gt; mask</li>
</ul>
<p>加 ref 和点击事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spec-preview&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imgUrl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;event&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;event&quot;</span> @<span class="attr">mousemove</span>=<span class="string">&quot;handleMove&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;big&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;bigImgUrl&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bigImg&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mask&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>mounted 和 methods 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="comment">// 获取当前遮挡层的宽度</span></span><br><span class="line">    <span class="built_in">this</span>.maskWidth = <span class="built_in">this</span>.$refs.event.clientWidth / <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 鼠标移动事件</span></span><br><span class="line">    handleMove(e) &#123;</span><br><span class="line">      <span class="comment">// 获取鼠标移动的横纵坐标</span></span><br><span class="line">      <span class="keyword">const</span> &#123;</span><br><span class="line">        offsetX,</span><br><span class="line">        offsetY</span><br><span class="line">      &#125; = e</span><br><span class="line">      <span class="comment">// 获取当前遮挡层的宽度</span></span><br><span class="line">      <span class="keyword">const</span> maskWidth = <span class="built_in">this</span>.maskWidth</span><br><span class="line">      <span class="comment">// 获取遮挡层对象</span></span><br><span class="line">      <span class="keyword">const</span> maskDiv = <span class="built_in">this</span>.$refs.mask</span><br><span class="line">      <span class="comment">// 获取大图</span></span><br><span class="line">      <span class="keyword">const</span> bigImg = <span class="built_in">this</span>.$refs.bigImg</span><br><span class="line">      <span class="comment">// 横纵坐标</span></span><br><span class="line">      <span class="keyword">let</span> left = <span class="number">0</span></span><br><span class="line">      <span class="keyword">let</span> top = <span class="number">0</span></span><br><span class="line">      <span class="comment">// 计算鼠标的遮挡层中间的位置</span></span><br><span class="line">      left = offsetX - maskWidth / <span class="number">2</span></span><br><span class="line">      top = offsetY - maskWidth / <span class="number">2</span></span><br><span class="line">      <span class="comment">// 限制</span></span><br><span class="line">      left: left &lt; <span class="number">0</span> ? <span class="number">0</span> : left &gt; maskWidth ? maskWidth : left</span><br><span class="line">      top: top &lt; <span class="number">0</span> ? <span class="number">0</span> : top &gt; maskWidth ? maskWidth : top</span><br><span class="line">      <span class="comment">// 设置遮挡层的移动的位置</span></span><br><span class="line">      maskDiv.style.left = left + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      maskDiv.style.top = top + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      <span class="comment">// 设置大图的移动</span></span><br><span class="line">      bigImg.style.left = -left * <span class="number">2</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      bigImg.style.top = -top * <span class="number">2</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>less 中 .big 加</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: <span class="number">#fff</span>;</span><br></pre></td></tr></table></figure>
<h2><span id="p61-tian-jia-gou-wu-che-cheng-gong">61 添加购物车成功</span><a href="#p61-tian-jia-gou-wu-che-cheng-gong" class="header-anchor">#</a></h2>
<p>AddCartSuccess 拷贝到 pages</p>
<p>routes.js 注册路由组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AddCartSuccess <span class="keyword">from</span> <span class="string">&#x27;@/pages/AddCartSuccess&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 40</span></span><br><span class="line">  <span class="comment">// AddCartSuccess -- query</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">    component: AddCartSuccess</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>在 Detail 详情页中 找到 加入购物车 84</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addToCart&quot;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods 新增</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击加入购物车，跳转到添加购物车成功界面</span></span><br><span class="line">addToCart() &#123;</span><br><span class="line">  <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">    path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">    query: &#123;</span><br><span class="line">      skuId: <span class="built_in">this</span>.skuInfo.id,</span><br><span class="line">      skuNum: <span class="built_in">this</span>.skuNum</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>AddCartSuccess 8 对应的图片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./images/s3.png&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p62-feng-zhuang-api-jie-kou-han-shu">62 封装api接口函数</span><a href="#p62-feng-zhuang-api-jie-kou-han-shu" class="header-anchor">#</a></h2>
<p>添加 api 接口函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加购物车接口函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddToCart = <span class="function">(<span class="params">skuId, skuNum</span>) =&gt;</span> ajax.post(<span class="string">`/cart/addToCart/<span class="subst">$&#123;skuId&#125;</span>/<span class="subst">$&#123;skuNum&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<p>store/modules/ 新建 shopcart.js 在 index.js 注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> detail <span class="keyword">from</span> <span class="string">&#x27;./detail&#x27;</span></span><br><span class="line"><span class="keyword">import</span> shopcart <span class="keyword">from</span> <span class="string">&#x27;./shopcart&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home,</span><br><span class="line">  search,</span><br><span class="line">  detail,</span><br><span class="line">  shopcart</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqAddToCart</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    shopList: [] <span class="comment">// 购物车中的商品信息按钮</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;&#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 添加购物车操作</span></span><br><span class="line">    <span class="keyword">async</span> addToCart1(&#123;</span><br><span class="line">      commit</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      skuId,</span><br><span class="line">      skuNum</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Detail</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 点击加入购物车，跳转到添加购物车成功界面</span></span><br><span class="line">  addToCart() &#123;</span><br><span class="line">    <span class="keyword">const</span> query = &#123;</span><br><span class="line">      skuId: <span class="built_in">this</span>.skuInfo.id,</span><br><span class="line">      skuNum: <span class="built_in">this</span>.skuNum</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addToCart1&#x27;</span>, query)</span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">        path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">        query</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p63-hui-diao-han-shu">63 回调函数</span><a href="#p63-hui-diao-han-shu" class="header-anchor">#</a></h2>
<p>shopcart.js 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line">  <span class="comment">// 添加购物车操作</span></span><br><span class="line">  <span class="keyword">async</span> addToCart1(&#123;</span><br><span class="line">    commit</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    skuId,</span><br><span class="line">    skuNum,</span><br><span class="line">    callback</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum, callback)</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">      callback(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      callback(result.message || <span class="string">&#x27;添加失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Detail 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击加入购物车，跳转到添加购物车成功界面</span></span><br><span class="line">addToCart() &#123;</span><br><span class="line">  <span class="keyword">const</span> query = &#123;</span><br><span class="line">    skuId: <span class="built_in">this</span>.skuInfo.id,</span><br><span class="line">    skuNum: <span class="built_in">this</span>.skuNum</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 分发 有可能不成功</span></span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addToCart1&#x27;</span>, &#123;</span><br><span class="line">    ...query,</span><br><span class="line">    callback: <span class="built_in">this</span>.callback</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line">callback(error) &#123;</span><br><span class="line">  <span class="comment">// 成功</span></span><br><span class="line">  <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">    <span class="keyword">const</span> query = &#123;</span><br><span class="line">      skuId: <span class="built_in">this</span>.skuInfo.id,</span><br><span class="line">      skuNum: <span class="built_in">this</span>.skuNum</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">      path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">      query</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 失败</span></span><br><span class="line">    alert(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p64-dispatch-fan-hui-promise">64 dispatch 返回 Promise</span><a href="#p64-dispatch-fan-hui-promise" class="header-anchor">#</a></h2>
<p>shopcart.js 更新 actions</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> addToCart2(&#123;</span><br><span class="line">    commit</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    skuId,</span><br><span class="line">    skuNum</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum)</span><br><span class="line">    <span class="keyword">return</span> result.code === <span class="number">200</span> ? <span class="string">&#x27;&#x27;</span> : result.message || <span class="string">&#x27;添加失败&#x27;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>Detail 更新 addToCart 删除callback</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 点击加入购物车，跳转到添加购物车成功界面</span></span><br><span class="line">  <span class="comment">// + async</span></span><br><span class="line">  <span class="keyword">async</span> addToCart() &#123;</span><br><span class="line">    <span class="keyword">const</span> query = &#123;</span><br><span class="line">      skuId: <span class="built_in">this</span>.$route.params.skuId,</span><br><span class="line">      skuNum: <span class="built_in">this</span>.skuNum</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 分发 有可能不成功</span></span><br><span class="line">    <span class="keyword">const</span> errorMsg = <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addToCart2&#x27;</span>, &#123;</span><br><span class="line">      ...query</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 成功</span></span><br><span class="line">    <span class="keyword">if</span> (!errorMsg) &#123;</span><br><span class="line">      <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">        path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">        query</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 失败</span></span><br><span class="line">      alert(errorMsg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AddCartSuccess 更新 16行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">class</span>=<span class="string">&quot;sui-btn btn-xlarge&quot;</span> <span class="attr">:to</span>=<span class="string">&quot;&#123;name:&#x27;detail&#x27;, params:&#123;skuId:this.$route.query.skuId&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  查看商品详情</span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p65-addcartsuccess-geng-xin">65 AddCartSuccess 更新</span><a href="#p65-addcartsuccess-geng-xin" class="header-anchor">#</a></h2>
<p>Detail 更新 addToCart</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!errorMsg) &#123;</span><br><span class="line">  <span class="comment">// 通过浏览器缓存当前商品信息数据对象</span></span><br><span class="line">  <span class="built_in">window</span>.localStorage.setItem(<span class="string">&#x27;SKU_INFO&#x27;</span>, <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.skuInfo))</span><br><span class="line">  <span class="comment">// 路由跳转</span></span><br></pre></td></tr></table></figure>
<p>AddCartSuccess 更新 8行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!-- 1 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;skuInfo.skuDefaultImg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right-info&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;skuInfo.skuName&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;attr&quot;</span>&gt;</span>颜色：24K金 数量：&#123;&#123;this.$route.query.skuNum&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    skuInfo: &#123;&#125; <span class="comment">// 响应式数据对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">mounted() &#123;</span><br><span class="line">  <span class="comment">// 浏览器的缓存读取</span></span><br><span class="line">  <span class="built_in">this</span>.skuInfo = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">&#x27;SKU_INFO&#x27;</span>) || &#123;&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p66-gou-wu-che">66 购物车</span><a href="#p66-gou-wu-che" class="header-anchor">#</a></h2>
<p>新建购物车组件 ShopCart 在 pages里面（直接拷贝）</p>
<p>routes.js 注册为路由组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ShopCart <span class="keyword">from</span> <span class="string">&#x27;@/pages/ShopCart&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 46</span></span><br><span class="line">  <span class="comment">// ShopCart</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/shopcart&#x27;</span>,</span><br><span class="line">    component: ShopCart</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>AddCartSuccess 21行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span>&gt;</span>去购物车结算 &gt; <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span> --&gt;</span><br><span class="line">&lt;router-link to=<span class="string">&quot;/shopcart&quot;</span>&gt;去购物车结算&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p67-sheng-cheng-lin-shi-yong-hu-id">67 生成临时用户id</span><a href="#p67-sheng-cheng-lin-shi-yong-hu-id" class="header-anchor">#</a></h2>
<p>生成临时用户id</p>
<p>uuidjs <code>npm i uuidjs</code></p>
<p>utils 中新建 storageUtils.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 暴露出去一个函数，用户生成用户的临时id凭证</span></span><br><span class="line"><span class="comment">// 引入 uuid</span></span><br><span class="line"><span class="keyword">import</span> UUID <span class="keyword">from</span> <span class="string">&#x27;uuidjs&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUUID</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 先从浏览器的缓存中读取用户的临时凭证</span></span><br><span class="line">  <span class="keyword">let</span> uuid = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;UUID_KEY&#x27;</span>)</span><br><span class="line">  <span class="comment">// 判断是否存在</span></span><br><span class="line">  <span class="keyword">if</span> (!uuid) &#123;</span><br><span class="line">    <span class="comment">// 产生临时用户id</span></span><br><span class="line">    uuid = UUID.generate()</span><br><span class="line">    <span class="comment">// 保存到浏览器</span></span><br><span class="line">    <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;UUID_KEY&#x27;</span>, uuid)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回</span></span><br><span class="line">  <span class="keyword">return</span> uuid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>store/modules 中新建一个 user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模块</span></span><br><span class="line"><span class="comment">// 引入 生成uuid 工具</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getUUID</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storageUtils&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    userInfo: &#123;&#125;, <span class="comment">// 用户信息对象</span></span><br><span class="line">    userTempId: getUUID() <span class="comment">// 用户的临时id</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;&#125;,</span><br><span class="line">  actions: &#123;&#125;,</span><br><span class="line">  getters: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在index.js中注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> detail <span class="keyword">from</span> <span class="string">&#x27;./detail&#x27;</span></span><br><span class="line"><span class="keyword">import</span> shopcart <span class="keyword">from</span> <span class="string">&#x27;./shopcart&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home,</span><br><span class="line">  search,</span><br><span class="line">  detail,</span><br><span class="line">  shopcart,</span><br><span class="line">  user</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>api/ajax.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br></pre></td></tr></table></figure>
<p>更新请求拦截器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">ajax.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  Nprogress.start() <span class="comment">// 显示进度条</span></span><br><span class="line">  <span class="comment">// 在请求头中携带用户的临时凭证id</span></span><br><span class="line">  config.headers[<span class="string">&#x27;userTempId&#x27;</span>] = store.state.user.userTempId</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>调用接口发请求的时候，在请求头携带用户临时id</p>
<h1><span id="9-yue-25-ri-day-7">9月25日（day 7）</span><a href="#9-yue-25-ri-day-7" class="header-anchor">#</a></h1>
<h2><span id="p68-huo-qu-gou-wu-che-shu-ju-feng-zhuang-api-vuex">68 获取购物车数据（封装api + vuex）</span><a href="#p68-huo-qu-gou-wu-che-shu-ju-feng-zhuang-api-vuex" class="header-anchor">#</a></h2>
<p>api +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取购物车中的商品信息列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqShopCartList = <span class="function">() =&gt;</span> ajax.get(<span class="string">&#x27;/cart/cartList&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>store/modules/shopcart.js +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api</span></span><br><span class="line"><span class="keyword">import</span> &#123; reqAddToCart, reqShopCartList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mutations: &#123;</span><br><span class="line">  <span class="comment">// 直接修改 shopList 数据</span></span><br><span class="line">  RECEIVE_SHOP_LIST(state, shopList) &#123;</span><br><span class="line">    state.shopList = shopList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>actions 中 +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取购物车中的商品信息对象</span></span><br><span class="line"><span class="keyword">async</span> getShopList(&#123; commit &#125;) &#123;</span><br><span class="line">  <span class="comment">// 调用 api 接口，发送异步请求</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopCartList()</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">// 更新数据</span></span><br><span class="line">    commit(<span class="string">&#x27;RECEIVE_SHOP_LIST&#x27;</span>, result.data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ShopCart 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;ShopCart&#x27;</span>,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="comment">// 获取购物车中的商品数据</span></span><br><span class="line">    <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    getShopCartList() &#123;</span><br><span class="line">      <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getShopList&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2><span id="p69-xuan-ran-gou-wu-che-nei-rong">69 渲染购物车内容</span><a href="#p69-xuan-ran-gou-wu-che-nei-rong" class="header-anchor">#</a></h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123; <span class="attr">shopList</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.shopcart.shopList &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>14行 <code>&lt;ul class=&quot;cart-list&quot;&gt;</code> 删掉留一个</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 选中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;chk_list&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 图片和名字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.imgUrl&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-msg&quot;</span>&gt;</span>&#123;&#123; item.skuName &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con3&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-txt&quot;</span>&gt;</span>绝版<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 价格 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con4&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span>&#123;&#123; item.skuPrice &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加减 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mins&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">minnum</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;plus&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 总价 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con6&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sum&quot;</span>&gt;</span>&#123;&#123; item.skuPrice * item.skuNum &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 删除 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con7&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p69-xuan-ran-gou-wu-che-jie-mian-2">69 渲染购物车界面2</span><a href="#p69-xuan-ran-gou-wu-che-jie-mian-2" class="header-anchor">#</a></h2>
<p>store 更新 shopcart 中的 getters</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 总数量</span></span><br><span class="line">totalCount(state) &#123;</span><br><span class="line">  <span class="keyword">return</span> state.shopList.reduce(<span class="function">(<span class="params">pre, item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.isChecked === <span class="number">1</span> ? pre + item.skuNum : pre</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 总价格</span></span><br><span class="line">totalPrice(state) &#123;</span><br><span class="line">  <span class="keyword">return</span> state.shopList.reduce(<span class="function">(<span class="params">pre, item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> item.isChecked === <span class="number">1</span> ? pre + item.skuNum * item.skuPrice : pre</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 是否全部选中</span></span><br><span class="line">isCheckAll(state) &#123;</span><br><span class="line">  <span class="comment">// 数组中要有数据,并且每个数据都是选中的,才有意义</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    state.shopList.length &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">    state.shopList.every(<span class="function"><span class="params">item</span> =&gt;</span> item.isChecked === <span class="number">1</span>)</span><br><span class="line">  )</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ShopCart</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123; <span class="attr">shopList</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.shopcart.shopList &#125;),</span><br><span class="line">  ...mapGetters([<span class="string">&#x27;totalCount&#x27;</span>, <span class="string">&#x27;totalPrice&#x27;</span>, <span class="string">&#x27;isChecked&#x27;</span>])</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>61行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;money-box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chosed&quot;</span>&gt;</span></span><br><span class="line">    已选择 <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; totalCount &#125;&#125;<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">    &gt;</span>件商品</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sumprice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">em</span>&gt;</span>总价（不含运费） ：<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    &lt;i class=&quot;summoney&quot;&#123;&#123; totalPrice &#125;&#125;&lt;/i&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sumbtn&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p70-gou-wu-che-shan-chu">70 购物车删除</span><a href="#p70-gou-wu-che-shan-chu" class="header-anchor">#</a></h2>
<p>api +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 购物车删除操作</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqDeleteCartItem = <span class="function">(<span class="params">skuId</span>) =&gt;</span> ajax.delete(<span class="string">`/cart/deleteCart/<span class="subst">$&#123;skuId&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<p>shopcart.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reqAddToCart, reqShopCartList,reqDeleteCartItem &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<p>actions+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除购物车的商品信息对象</span></span><br><span class="line"><span class="keyword">async</span> deleteCartItem1(&#123; commit &#125;, skuId) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqDeleteCartItem(skuId)</span><br><span class="line">  <span class="keyword">return</span> result.code === <span class="number">200</span> ? <span class="string">&#x27;&#x27;</span> : result.message || <span class="string">&#x27;删除失败&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ShopCart  methods+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">async</span> deleteCartItem(skuId) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.confirm(<span class="string">&#x27;你确定要删除吗？&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> error = <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;deleteCartItem1&#x27;</span>, skuId)</span><br><span class="line">    <span class="comment">// 删除成功</span></span><br><span class="line">    <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">      <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">      <span class="comment">// 删除失败</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ShopCart</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 删除 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con7&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sindelet&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteCartItem(item.skuId)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>删除<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>移到收藏<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p71-qing-kong-gou-wu-che">71 清空购物车</span><a href="#p71-qing-kong-gou-wu-che" class="header-anchor">#</a></h2>
<p>shopcart.js 中 getters +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取所有选中的购物项</span></span><br><span class="line">selectedCartItems(state) &#123;</span><br><span class="line">  <span class="keyword">return</span> state.shopList.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.isChecked === <span class="number">1</span>)</span><br><span class="line">  <span class="comment">// return state.shopList.reduce((pre, item) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   判断是否选中</span></span><br><span class="line">  <span class="comment">//   if (item.isChecked === 1) &#123;</span></span><br><span class="line">  <span class="comment">//     pre.push(item)</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   return pre</span></span><br><span class="line">  <span class="comment">// &#125;, [])</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>actions +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> deleteCartItem2(&#123; commit &#125;, skuId) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqDeleteCartItem(skuId)</span><br><span class="line">  <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">// 抛出一个异常</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ShopCart 64行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;option&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteCartItems&quot;</span>&gt;</span>删除选中的商品<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>computed 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123; <span class="attr">shopList</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.shopcart.shopList &#125;),</span><br><span class="line">  ...mapGetters([</span><br><span class="line">    <span class="string">&#x27;totalCount&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;totalPrice&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;isCheckAll&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;selectedCartItems&#x27;</span>  <span class="comment">// 新增</span></span><br><span class="line">  ])</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>methods +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除所有选中的购物项</span></span><br><span class="line"><span class="keyword">async</span> deleteCartItems(skuId) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; selectedCartItems &#125; = <span class="built_in">this</span></span><br><span class="line">  <span class="comment">// 如果该数组中的数据是没有的，那么也没有必要删除</span></span><br><span class="line">  <span class="keyword">if</span> (selectedCartItems.length === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.confirm(<span class="string">&#x27;你确定要删除所有选中的购物项吗&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 定义一个储存Promise的数组</span></span><br><span class="line">    <span class="keyword">const</span> promises = []</span><br><span class="line">    <span class="comment">// 遍历数组，一个一个删除</span></span><br><span class="line">    selectedCartItems.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 分发action</span></span><br><span class="line">      <span class="keyword">const</span> promise = <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;deleteCartItem2&#x27;</span>, item.skuId)</span><br><span class="line">      promises.push(promise)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 统一的处理 Promise</span></span><br><span class="line">    <span class="built_in">Promise</span>.all(promises).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 成功了</span></span><br><span class="line">      <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">    &#125;),</span><br><span class="line">      error =&gt; &#123;</span><br><span class="line">        <span class="comment">// 失败了</span></span><br><span class="line">        alert(error.message)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p72-qie-huan-xuan-zhong-zhuang-tai">72 切换选中状态</span><a href="#p72-qie-huan-xuan-zhong-zhuang-tai" class="header-anchor">#</a></h2>
<p>api +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换商品选中状态</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCheckCartItem = <span class="function">(<span class="params">skuId, isChecked</span>) =&gt;</span></span><br><span class="line">  ajax.get(<span class="string">`/cart/checkCart/<span class="subst">$&#123;skuId&#125;</span>/<span class="subst">$&#123;isChecked&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<p>store shopcart.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api</span></span><br><span class="line"><span class="keyword">import</span> &#123; reqAddToCart, reqShopCartList, reqDeleteCartItem,reqCheckCartItem &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换购物选中状态</span></span><br><span class="line"><span class="keyword">async</span> checkCartItem1(&#123; commit &#125;, &#123; skuId, isChecked &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqCheckCartItem(skuId, isChecked)</span><br><span class="line">  <span class="comment">// 失败的问题</span></span><br><span class="line">  <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message || <span class="string">&#x27;切换勾选状态失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ShopCart methods +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置购物项商品的选中状态</span></span><br><span class="line"><span class="keyword">async</span> checkCartItem(item) &#123;</span><br><span class="line">  <span class="keyword">const</span> isChecked = item.isChecked === <span class="number">1</span> ? <span class="number">0</span> : <span class="number">1</span></span><br><span class="line">  <span class="comment">// 分发</span></span><br><span class="line">  <span class="built_in">this</span>.$store</span><br><span class="line">    .dispatch(<span class="string">&#x27;checkCartItem1&#x27;</span>, &#123; <span class="attr">skuId</span>: item.skuId, isChecked &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 成功了，重新获取购物车的数据</span></span><br><span class="line">      <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">    &#125;),</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">      <span class="comment">// 失败了</span></span><br><span class="line">      alert(error.message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>更新html 15行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 是否选中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">&quot;chk_list&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:checked</span>=<span class="string">&quot;item.isChecked&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">change</span>=<span class="string">&quot;checkCartItem(item)&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p73-quan-xuan-quan-bu-xuan">73 全选/全不选</span><a href="#p73-quan-xuan-quan-bu-xuan" class="header-anchor">#</a></h2>
<p>shopcart.js actions+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换购物选中状态</span></span><br><span class="line"> <span class="keyword">async</span> checkCartItem1(&#123; commit &#125;, &#123; skuId, isChecked &#125;) &#123;</span><br><span class="line">   <span class="keyword">const</span> result = <span class="keyword">await</span> reqCheckCartItem(skuId, isChecked)</span><br><span class="line">   <span class="comment">// 失败的问题</span></span><br><span class="line">   <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message || <span class="string">&#x27;切换勾选状态失败&#x27;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>ShopCart methods+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换全选/全不选择操作</span></span><br><span class="line"><span class="keyword">async</span> checkCartItems(e) &#123;</span><br><span class="line">  <span class="comment">// 获取当前复选框的选中状态</span></span><br><span class="line">  <span class="keyword">const</span> isChecked = e.target.checked * <span class="number">1</span></span><br><span class="line">  <span class="comment">// const promises = []</span></span><br><span class="line">  <span class="comment">// 遍历购物车中所有的购物项,统一修改选中状态</span></span><br><span class="line">  <span class="comment">// this.shopList.forEach((item) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   // 分发action</span></span><br><span class="line">  <span class="comment">//   const promise = this.$store.dispatch(&#x27;checkCartItem1&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//     skuId: item.skuId,</span></span><br><span class="line">  <span class="comment">//     isChecked,</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">//   // 放在promises数组中</span></span><br><span class="line">  <span class="comment">//   promises.push(promise)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 使用reduce</span></span><br><span class="line">  <span class="comment">// const promises = this.shopList.reduce((pre, item) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   const promise = this.$store.dispatch(&#x27;checkCartItem1&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//     skuId: item.skuId,</span></span><br><span class="line">  <span class="comment">//     isChecked,</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">//   pre.push(promise)</span></span><br><span class="line">  <span class="comment">//   return pre</span></span><br><span class="line">  <span class="comment">// &#125;, [])</span></span><br><span class="line">  <span class="comment">// 使用map</span></span><br><span class="line">  <span class="keyword">const</span> promises = <span class="built_in">this</span>.shopList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;checkCartItem1&#x27;</span>, &#123;</span><br><span class="line">      skuId: item.skuId,</span><br><span class="line">      isChecked</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 统一处理</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">Promise</span>.all(promises)</span><br><span class="line">    <span class="comment">// 成功了,重新获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    alert(error.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>79行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全选 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;select-all&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;chooseAll&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:checked</span>=<span class="string">&quot;isCheckAll&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">change</span>=<span class="string">&quot;checkCartItems&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p74-shu-liang-cao-zuo">74 数量操作</span><a href="#p74-shu-liang-cao-zuo" class="header-anchor">#</a></h2>
<p>shopcart.js actions+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> addToCart3(&#123; commit, dispatch &#125;, &#123; skuId, skuNum &#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum)</span><br><span class="line">  <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">// 成功了</span></span><br><span class="line">    dispatch(<span class="string">&#x27;getShopList&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 失败了</span></span><br><span class="line">    alert(result.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>ShopCart methods+</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改商品购物项的数量</span></span><br><span class="line"><span class="keyword">async</span> changeCount(item, changeNum) &#123;</span><br><span class="line">  <span class="comment">// 获取skuId</span></span><br><span class="line">  <span class="keyword">const</span> &#123; skuId &#125; = item</span><br><span class="line">  <span class="comment">// 判断当前商品的数量和传入进来的修改的数量相加,要大于0</span></span><br><span class="line">  <span class="keyword">if</span> (item.skuNum + changeNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 分发action</span></span><br><span class="line">    <span class="keyword">const</span> errorMsg = <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addToCart2&#x27;</span>, &#123;</span><br><span class="line">      skuId,</span><br><span class="line">      skuNum: changeNum</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (!errorMsg) &#123;</span><br><span class="line">      <span class="comment">// 成功了</span></span><br><span class="line">      <span class="built_in">this</span>.getShopCartList()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 失败了</span></span><br><span class="line">      alert(errorMsg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">changeCount2(item, changeNum) &#123;</span><br><span class="line">  <span class="comment">// 获取skuId</span></span><br><span class="line">  <span class="keyword">const</span> &#123; skuId &#125; = item</span><br><span class="line">  <span class="comment">// 判断当前商品的数量和传入进来的修改的数量相加,要大于0</span></span><br><span class="line">  <span class="keyword">if</span> (item.skuNum + changeNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 分发action</span></span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;addToCart3&#x27;</span>, &#123;</span><br><span class="line">      skuId,</span><br><span class="line">      skuNum: changeNum</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
<p>37行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数量操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;cart-list-con5&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 减 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">    <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;mins&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;changeCount2(item, -1)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>-<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 直接输入 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">minnum</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;itxt&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:value</span>=<span class="string">&quot;item.skuNum&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">change</span>=<span class="string">&quot;changeCount2(item, $event.target.value * 1 - item.skuNum)&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 加 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">    <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;plus&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;changeCount2(item, 1)&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>+<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>至此</p>
<p>ShopCart</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;cart&quot;&gt;</span><br><span class="line">    &lt;h4&gt;全部商品&lt;&#x2F;h4&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;cart-main&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;cart-th&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th1&quot;&gt;全部&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th2&quot;&gt;商品&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th3&quot;&gt;单价（元）&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th4&quot;&gt;数量&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th5&quot;&gt;小计（元）&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;cart-th6&quot;&gt;操作&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;cart-body&quot;&gt;</span><br><span class="line">        &lt;ul class&#x3D;&quot;cart-list&quot; v-for&#x3D;&quot;item in shopList&quot; :key&#x3D;&quot;item.id&quot;&gt;</span><br><span class="line">          &lt;!-- 是否选中 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con1&quot;&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type&#x3D;&quot;checkbox&quot;</span><br><span class="line">              name&#x3D;&quot;chk_list&quot;</span><br><span class="line">              :checked&#x3D;&quot;item.isChecked&quot;</span><br><span class="line">              @change&#x3D;&quot;checkCartItem(item)&quot;</span><br><span class="line">            &#x2F;&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 图片和名字 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con2&quot;&gt;</span><br><span class="line">            &lt;img :src&#x3D;&quot;item.imgUrl&quot; &#x2F;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;item-msg&quot;&gt;&#123;&#123; item.skuName &#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 无用 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con3&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;item-txt&quot;&gt;绝版&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 单价 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con4&quot;&gt;</span><br><span class="line">            &lt;span class&#x3D;&quot;price&quot;&gt;&#123;&#123; item.skuPrice &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 数量操作 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con5&quot;&gt;</span><br><span class="line">            &lt;!-- 减 --&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              href&#x3D;&quot;javascript:void(0)&quot;</span><br><span class="line">              class&#x3D;&quot;mins&quot;</span><br><span class="line">              @click&#x3D;&quot;changeCount2(item, -1)&quot;</span><br><span class="line">              &gt;-&lt;&#x2F;a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;!-- 直接输入 --&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              autocomplete&#x3D;&quot;off&quot;</span><br><span class="line">              type&#x3D;&quot;text&quot;</span><br><span class="line">              minnum&#x3D;&quot;1&quot;</span><br><span class="line">              class&#x3D;&quot;itxt&quot;</span><br><span class="line">              :value&#x3D;&quot;item.skuNum&quot;</span><br><span class="line">              @change&#x3D;&quot;changeCount2(item, $event.target.value * 1 - item.skuNum)&quot;</span><br><span class="line">            &#x2F;&gt;</span><br><span class="line">            &lt;!-- 加 --&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              href&#x3D;&quot;javascript:void(0)&quot;</span><br><span class="line">              class&#x3D;&quot;plus&quot;</span><br><span class="line">              @click&#x3D;&quot;changeCount2(item, 1)&quot;</span><br><span class="line">              &gt;+&lt;&#x2F;a</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 总价 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con6&quot;&gt;</span><br><span class="line">            &lt;span class&#x3D;&quot;sum&quot;&gt;&#123;&#123; item.skuPrice * item.skuNum &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">          &lt;!-- 删除 --&gt;</span><br><span class="line">          &lt;li class&#x3D;&quot;cart-list-con7&quot;&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;sindelet&quot; @click&#x3D;&quot;deleteCartItem(item.skuId)&quot;</span><br><span class="line">              &gt;删除&lt;&#x2F;a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;br &#x2F;&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;#&quot;&gt;移到收藏&lt;&#x2F;a&gt;</span><br><span class="line">          &lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;cart-tool&quot;&gt;</span><br><span class="line">      &lt;!-- 全选 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;select-all&quot;&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">          class&#x3D;&quot;chooseAll&quot;</span><br><span class="line">          type&#x3D;&quot;checkbox&quot;</span><br><span class="line">          :checked&#x3D;&quot;isCheckAll&quot;</span><br><span class="line">          @change&#x3D;&quot;checkCartItems&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">        &lt;span&gt;全选&lt;&#x2F;span&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;!-- 删除选择的商品 --&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;option&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;javascript:;&quot; @click&#x3D;&quot;deleteCartItems&quot;&gt;删除选中的商品&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;javascript:;&quot;&gt;移到我的关注&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;javascript:;&quot;&gt;清除下柜商品&lt;&#x2F;a&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;money-box&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;chosed&quot;&gt;</span><br><span class="line">          已选择 &lt;span&gt;&#123;&#123; totalCount &#125;&#125;&lt;&#x2F;span</span><br><span class="line">          &gt;件商品</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;sumprice&quot;&gt;</span><br><span class="line">          &lt;em&gt;总价（不含运费） ：&lt;&#x2F;em&gt;</span><br><span class="line">          &lt;i class&#x3D;&quot;summoney&quot;&gt;&#123;&#123; totalPrice &#125;&#125;&lt;&#x2F;i&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;sumbtn&quot;&gt;</span><br><span class="line">          &lt;a class&#x3D;&quot;sum-btn&quot; href&#x3D;&quot;###&quot; target&#x3D;&quot;_blank&quot;&gt;结算&lt;&#x2F;a&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; mapState, mapGetters &#125; from &#39;vuex&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;ShopCart&#39;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    &#x2F;&#x2F; 获取购物车中的商品数据</span><br><span class="line">    this.getShopCartList()</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123; shopList: state &#x3D;&gt; state.shopcart.shopList &#125;),</span><br><span class="line">    ...mapGetters([</span><br><span class="line">      &#39;totalCount&#39;,</span><br><span class="line">      &#39;totalPrice&#39;,</span><br><span class="line">      &#39;isCheckAll&#39;,</span><br><span class="line">      &#39;selectedCartItems&#39;</span><br><span class="line">    ])</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    &#x2F;&#x2F; 获取购物车</span><br><span class="line">    getShopCartList() &#123;</span><br><span class="line">      this.$store.dispatch(&#39;getShopList&#39;)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 删除</span><br><span class="line">    async deleteCartItem(skuId) &#123;</span><br><span class="line">      if (window.confirm(&#39;你确定要删除吗？&#39;)) &#123;</span><br><span class="line">        const error &#x3D; await this.$store.dispatch(&#39;deleteCartItem1&#39;, skuId)</span><br><span class="line">        &#x2F;&#x2F; 删除成功</span><br><span class="line">        if (!error) &#123;</span><br><span class="line">          this.getShopCartList()</span><br><span class="line">          &#x2F;&#x2F; 删除失败</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          alert(error)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 删除所有选中的购物项</span><br><span class="line">    async deleteCartItems(skuId) &#123;</span><br><span class="line">      const &#123; selectedCartItems &#125; &#x3D; this</span><br><span class="line">      &#x2F;&#x2F; 如果该数组中的数据是没有的，那么也没有必要删除</span><br><span class="line">      if (selectedCartItems.length &#x3D;&#x3D;&#x3D; 0) return</span><br><span class="line">      if (window.confirm(&#39;你确定要删除所有选中的购物项吗&#39;)) &#123;</span><br><span class="line">        &#x2F;&#x2F; 定义一个储存Promise的数组</span><br><span class="line">        const promises &#x3D; []</span><br><span class="line">        &#x2F;&#x2F; 遍历数组，一个一个删除</span><br><span class="line">        selectedCartItems.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; 分发action</span><br><span class="line">          const promise &#x3D; this.$store.dispatch(&#39;deleteCartItem2&#39;, item.skuId)</span><br><span class="line">          promises.push(promise)</span><br><span class="line">        &#125;)</span><br><span class="line">        &#x2F;&#x2F; 统一的处理 Promise</span><br><span class="line">        Promise.all(promises).then(() &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; 成功了</span><br><span class="line">          this.getShopCartList()</span><br><span class="line">        &#125;),</span><br><span class="line">          error &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; 失败了</span><br><span class="line">            alert(error.message)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 设置购物项商品的选中状态</span><br><span class="line">    async checkCartItem(item) &#123;</span><br><span class="line">      const isChecked &#x3D; item.isChecked &#x3D;&#x3D;&#x3D; 1 ? 0 : 1</span><br><span class="line">      &#x2F;&#x2F; 分发</span><br><span class="line">      this.$store</span><br><span class="line">        .dispatch(&#39;checkCartItem1&#39;, &#123; skuId: item.skuId, isChecked &#125;)</span><br><span class="line">        .then(value &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; 成功了，重新获取购物车的数据</span><br><span class="line">          this.getShopCartList()</span><br><span class="line">        &#125;),</span><br><span class="line">        error &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; 失败了</span><br><span class="line">          alert(error.message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 切换全选&#x2F;全不选择操作</span><br><span class="line">    async checkCartItems(e) &#123;</span><br><span class="line">      &#x2F;&#x2F; 获取当前复选框的选中状态</span><br><span class="line">      const isChecked &#x3D; e.target.checked * 1</span><br><span class="line">      &#x2F;&#x2F; const promises &#x3D; []</span><br><span class="line">      &#x2F;&#x2F; 遍历购物车中所有的购物项,统一修改选中状态</span><br><span class="line">      &#x2F;&#x2F; this.shopList.forEach((item) &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F;   &#x2F;&#x2F; 分发action</span><br><span class="line">      &#x2F;&#x2F;   const promise &#x3D; this.$store.dispatch(&#39;checkCartItem1&#39;, &#123;</span><br><span class="line">      &#x2F;&#x2F;     skuId: item.skuId,</span><br><span class="line">      &#x2F;&#x2F;     isChecked,</span><br><span class="line">      &#x2F;&#x2F;   &#125;)</span><br><span class="line">      &#x2F;&#x2F;   &#x2F;&#x2F; 放在promises数组中</span><br><span class="line">      &#x2F;&#x2F;   promises.push(promise)</span><br><span class="line">      &#x2F;&#x2F; &#125;)</span><br><span class="line">      &#x2F;&#x2F; 使用reduce</span><br><span class="line">      &#x2F;&#x2F; const promises &#x3D; this.shopList.reduce((pre, item) &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F;   const promise &#x3D; this.$store.dispatch(&#39;checkCartItem1&#39;, &#123;</span><br><span class="line">      &#x2F;&#x2F;     skuId: item.skuId,</span><br><span class="line">      &#x2F;&#x2F;     isChecked,</span><br><span class="line">      &#x2F;&#x2F;   &#125;)</span><br><span class="line">      &#x2F;&#x2F;   pre.push(promise)</span><br><span class="line">      &#x2F;&#x2F;   return pre</span><br><span class="line">      &#x2F;&#x2F; &#125;, [])</span><br><span class="line">      &#x2F;&#x2F; 使用map</span><br><span class="line">      const promises &#x3D; this.shopList.map(item &#x3D;&gt; &#123;</span><br><span class="line">        return this.$store.dispatch(&#39;checkCartItem1&#39;, &#123;</span><br><span class="line">          skuId: item.skuId,</span><br><span class="line">          isChecked</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      &#x2F;&#x2F; 统一处理</span><br><span class="line">      try &#123;</span><br><span class="line">        await Promise.all(promises)</span><br><span class="line">        &#x2F;&#x2F; 成功了,重新获取数据</span><br><span class="line">        this.getShopCartList()</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        alert(error.message)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#x2F;&#x2F; 修改商品购物项的数量</span><br><span class="line">    async changeCount(item, changeNum) &#123;</span><br><span class="line">      &#x2F;&#x2F; 获取skuId</span><br><span class="line">      const &#123; skuId &#125; &#x3D; item</span><br><span class="line">      &#x2F;&#x2F; 判断当前商品的数量和传入进来的修改的数量相加,要大于0</span><br><span class="line">      if (item.skuNum + changeNum &gt; 0) &#123;</span><br><span class="line">        &#x2F;&#x2F; 分发action</span><br><span class="line">        const errorMsg &#x3D; await this.$store.dispatch(&#39;addToCart2&#39;, &#123;</span><br><span class="line">          skuId,</span><br><span class="line">          skuNum: changeNum</span><br><span class="line">        &#125;)</span><br><span class="line">        if (!errorMsg) &#123;</span><br><span class="line">          &#x2F;&#x2F; 成功了</span><br><span class="line">          this.getShopCartList()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          &#x2F;&#x2F; 失败了</span><br><span class="line">          alert(errorMsg)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    changeCount2(item, changeNum) &#123;</span><br><span class="line">      &#x2F;&#x2F; 获取skuId</span><br><span class="line">      const &#123; skuId &#125; &#x3D; item</span><br><span class="line">      &#x2F;&#x2F; 判断当前商品的数量和传入进来的修改的数量相加,要大于0</span><br><span class="line">      if (item.skuNum + changeNum &gt; 0) &#123;</span><br><span class="line">        &#x2F;&#x2F; 分发action</span><br><span class="line">        this.$store.dispatch(&#39;addToCart3&#39;, &#123;</span><br><span class="line">          skuId,</span><br><span class="line">          skuNum: changeNum</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; end</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>shopcart.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reqAddToCart,</span><br><span class="line">  reqShopCartList,</span><br><span class="line">  reqDeleteCartItem,</span><br><span class="line">  reqCheckCartItem</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    shopList: [] <span class="comment">// 购物车中的商品信息按钮</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接修改 shopList 数据</span></span><br><span class="line">    RECEIVE_SHOP_LIST(state, shopList) &#123;</span><br><span class="line">      state.shopList = shopList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 添加购物车操作</span></span><br><span class="line">    <span class="keyword">async</span> addToCart1(&#123; commit &#125;, &#123; skuId, skuNum, callback &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum, callback)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        callback(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(result.message || <span class="string">&#x27;添加失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> addToCart2(&#123; commit &#125;, &#123; skuId, skuNum &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum)</span><br><span class="line">      <span class="keyword">return</span> result.code === <span class="number">200</span> ? <span class="string">&#x27;&#x27;</span> : result.message || <span class="string">&#x27;添加失败&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> addToCart3(&#123; commit, dispatch &#125;, &#123; skuId, skuNum &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddToCart(skuId, skuNum)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 成功了</span></span><br><span class="line">        dispatch(<span class="string">&#x27;getShopList&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 失败了</span></span><br><span class="line">        alert(result.message)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取购物车中的商品信息对象</span></span><br><span class="line">    <span class="keyword">async</span> getShopList(&#123; commit &#125;) &#123;</span><br><span class="line">      <span class="comment">// 调用 api 接口，发送异步请求</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqShopCartList()</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 更新数据</span></span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_SHOP_LIST&#x27;</span>, result.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 删除购物车的商品信息对象</span></span><br><span class="line">    <span class="keyword">async</span> deleteCartItem1(&#123; commit &#125;, skuId) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqDeleteCartItem(skuId)</span><br><span class="line">      <span class="keyword">return</span> result.code === <span class="number">200</span> ? <span class="string">&#x27;&#x27;</span> : result.message || <span class="string">&#x27;删除失败&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> deleteCartItem2(&#123; commit &#125;, skuId) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqDeleteCartItem(skuId)</span><br><span class="line">      <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 抛出一个异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 切换购物选中状态</span></span><br><span class="line">    <span class="keyword">async</span> checkCartItem1(&#123; commit &#125;, &#123; skuId, isChecked &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqCheckCartItem(skuId, isChecked)</span><br><span class="line">      <span class="comment">// 失败的问题</span></span><br><span class="line">      <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message || <span class="string">&#x27;切换勾选状态失败&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// end</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    <span class="comment">// 总数量</span></span><br><span class="line">    totalCount(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.shopList.reduce(<span class="function">(<span class="params">pre, item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> item.isChecked === <span class="number">1</span> ? pre + item.skuNum : pre</span><br><span class="line">      &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 总价格</span></span><br><span class="line">    totalPrice(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.shopList.reduce(<span class="function">(<span class="params">pre, item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> item.isChecked === <span class="number">1</span> ? pre + item.skuNum * item.skuPrice : pre</span><br><span class="line">      &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 是否全部选中</span></span><br><span class="line">    isCheckAll(state) &#123;</span><br><span class="line">      <span class="comment">// 数组中要有数据,并且每个数据都是选中的,才有意义</span></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        state.shopList.length &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        state.shopList.every(<span class="function"><span class="params">item</span> =&gt;</span> item.isChecked === <span class="number">1</span>)</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取所有选中的购物项</span></span><br><span class="line">    selectedCartItems(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.shopList.filter(<span class="function"><span class="params">item</span> =&gt;</span> item.isChecked === <span class="number">1</span>)</span><br><span class="line">      <span class="comment">// return state.shopList.reduce((pre, item) =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//   判断是否选中</span></span><br><span class="line">      <span class="comment">//   if (item.isChecked === 1) &#123;</span></span><br><span class="line">      <span class="comment">//     pre.push(item)</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">//   return pre</span></span><br><span class="line">      <span class="comment">// &#125;, [])</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p75-deng-lu-zhu-ce-tui-chu-api-jie-kou">75 登陆/注册/退出 api接口</span><a href="#p75-deng-lu-zhu-ce-tui-chu-api-jie-kou" class="header-anchor">#</a></h2>
<p>api +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqLogin = <span class="function">(<span class="params">mobile, password</span>) =&gt;</span></span><br><span class="line">  ajax.post(<span class="string">`/user/passport/login`</span>, &#123; mobile, password &#125;)</span><br><span class="line"><span class="comment">// 注册接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqRegister = <span class="function"><span class="params">userInfo</span> =&gt;</span></span><br><span class="line">  ajax.post(<span class="string">`/user/passport/register`</span>, userInfo)</span><br><span class="line"><span class="comment">// 退出接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqLogout = <span class="function">() =&gt;</span> ajax.get(<span class="string">`/user/passport/logout`</span>)</span><br></pre></td></tr></table></figure>
<p>13700000000</p>
<p>111111</p>
<h1><span id="9-yue-27-ri-day-8">9月27日（day 8）</span><a href="#9-yue-27-ri-day-8" class="header-anchor">#</a></h1>
<h2><span id="p76-vuex-feng-zhuang">76 vuex封装</span><a href="#p76-vuex-feng-zhuang" class="header-anchor">#</a></h2>
<p>user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模块</span></span><br><span class="line"><span class="comment">// 引入 生成uuid 工具</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUUID &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storageUtils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reqLogin, reqRegister, reqLogout &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    userInfo: &#123;&#125;, <span class="comment">// 用户信息对象</span></span><br><span class="line">    userTempId: getUUID() <span class="comment">// 用户的临时id</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接更新用户信息数据（登陆成功）</span></span><br><span class="line">    RECEIVE_USER_INFO(state, userInfo) &#123;</span><br><span class="line">      state.userInfo = userInfo</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 清空用户信息数据（退出）</span></span><br><span class="line">    RESET_USER_INFO(state) &#123;</span><br><span class="line">      state.userInfo = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 登陆</span></span><br><span class="line">    <span class="keyword">async</span> login(&#123; commit &#125;, &#123; mobile, password &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqLogin(mobile, password)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> userInfo = result.data</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_USER_INFO&#x27;</span>, userInfo)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;登陆失败了&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="keyword">async</span> register(&#123; commit &#125;, userInfo) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqRegister(userInfo)</span><br><span class="line">      <span class="keyword">if</span> (result.code !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;注册失败了&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 退出</span></span><br><span class="line">    <span class="keyword">async</span> logout(&#123; commit &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqLogout()</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 清空用户信息数组（坑）</span></span><br><span class="line">        commit(<span class="string">&#x27;RESET_USER_INFO&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;退出失败了&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p77-zhu-ce-1">77 注册1</span><a href="#p77-zhu-ce-1" class="header-anchor">#</a></h2>
<p>Register 12行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>手机号:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的手机号&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;mobile&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;/api/user/passport/code&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>登录密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的登录密码&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>确认密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入确认密码&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;password2&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;m1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isAgree&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>同意协议并注册《尚品汇用户协议》<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第16行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;code&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;http://182.92.128.115/api/user/passport/code&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">alt</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;updateCode&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第38行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;btn&quot;</span>&gt;</span><br><span class="line">  &lt;a href=<span class="string">&quot;javascript:&quot;</span> @click=<span class="string">&quot;register&quot;</span>&gt;完成注册&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>点图形验证码可以切换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Register&#x27;</span>,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      mobile: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 手机号</span></span><br><span class="line">      password: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 收集密码</span></span><br><span class="line">      password2: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 确认密码</span></span><br><span class="line">      code: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 保存验证码信息</span></span><br><span class="line">      isAgree: <span class="literal">true</span> <span class="comment">// 控制是否同意</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    <span class="comment">// 更新图形验证码</span></span><br><span class="line">    updateCode()&#123;</span><br><span class="line">      <span class="built_in">this</span>.$refs.code.src = <span class="string">&#x27;/api/user/passport/code?time=&#x27;</span>+<span class="built_in">Date</span>.now()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    register()&#123;</span><br><span class="line">      <span class="comment">// 获取所需要的验证码</span></span><br><span class="line">      <span class="keyword">const</span> &#123;mobile, password, password2, code, isAgree&#125; = <span class="built_in">this</span></span><br><span class="line">      <span class="comment">// 验证</span></span><br><span class="line">      <span class="keyword">if</span>(!isAgree)&#123;</span><br><span class="line">        alert(<span class="string">&#x27;请勾选是否同意&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(password!==password2)&#123;</span><br><span class="line">        alert(<span class="string">&quot;密码不一致&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p78-biao-dan-yan-zheng">78 表单验证</span><a href="#p78-biao-dan-yan-zheng" class="header-anchor">#</a></h2>
<p>npm install vee-validate@2.2.13</p>
<p>utils 新建 validate.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VeeValidate <span class="keyword">from</span> <span class="string">&#x27;vee-validate&#x27;</span></span><br><span class="line"><span class="keyword">import</span> zh_CN <span class="keyword">from</span> <span class="string">&#x27;vee-validate/dist/locale/zh_CN&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VeeValidate)</span><br><span class="line"></span><br><span class="line">VeeValidate.Validator.localize(<span class="string">&#x27;zh_CN&#x27;</span>, &#123;</span><br><span class="line">  messages: zh_CN.messages,</span><br><span class="line">  attributes: &#123;</span><br><span class="line">    mobile: <span class="string">&#x27;手机号码&#x27;</span>,</span><br><span class="line">    code: <span class="string">&#x27;图形验证码&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    password2: <span class="string">&#x27;确认密码&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">VeeValidate.Validator.extend(<span class="string">&#x27;phone&#x27;</span>, &#123;</span><br><span class="line">  getMessage: <span class="function"><span class="params">field</span> =&gt;</span> <span class="string">&#x27;清输入正确的&#x27;</span> + field,</span><br><span class="line">  validate: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^[1]\d&#123;10&#125;$/</span>.test(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">VeeValidate.Validator.extend(<span class="string">&#x27;code1&#x27;</span>, &#123;</span><br><span class="line">  getMessage: <span class="function"><span class="params">field</span> =&gt;</span> <span class="string">&#x27;请输入正确的&#x27;</span> + field,</span><br><span class="line">  <span class="comment">// 文本框输入的内容</span></span><br><span class="line">  validate: <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^\d&#123;4&#125;$/</span>.test(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Register</p>
<p>引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/utils/validate&#x27;</span></span><br></pre></td></tr></table></figure>
<p>更新</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注册 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">      注册新用户</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;go&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>我有账号，去</span><br><span class="line">        <span class="comment">&lt;!-- &lt;a href=&quot;login.html&quot; target=&quot;_blank&quot;&gt;登陆&lt;/a&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登陆<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>手机号:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的手机号&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;mobile&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-validate</span>=<span class="string">&quot;&#x27;required|phone&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;mobile&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; errors.first(&#x27;mobile&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>验证码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-validate</span>=<span class="string">&quot;&#x27;required|code1&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ref</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;/api/user/passport/code&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alt</span>=<span class="string">&quot;code&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;updateCode&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; errors.first(&#x27;code&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>登录密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入你的登录密码&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-validate</span>=<span class="string">&quot;&#x27;required&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; errors.first(&#x27;password&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>确认密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入确认密码&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">&quot;password2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-validate</span>=<span class="string">&quot;&#x27;required&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;password2&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; errors.first(&#x27;password2&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;m1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isAgree&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>同意协议并注册《尚品汇用户协议》<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;register&quot;</span>&gt;</span>完成注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p79-biao-dan-yan-zheng-2">79 表单验证2</span><a href="#p79-biao-dan-yan-zheng-2" class="header-anchor">#</a></h2>
<p>register 更新</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line">    <span class="keyword">async</span> register() &#123;</span><br><span class="line">      <span class="comment">// 获取所需要的验证码</span></span><br><span class="line">      <span class="keyword">const</span> &#123; mobile, password, password2, code, isAgree &#125; = <span class="built_in">this</span></span><br><span class="line">      <span class="comment">// 验证</span></span><br><span class="line">      <span class="keyword">if</span> (!isAgree) &#123;</span><br><span class="line">        alert(<span class="string">&#x27;请勾选是否同意&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (password !== password2) &#123;</span><br><span class="line">        alert(<span class="string">&#x27;密码不一致&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 表单的验证</span></span><br><span class="line">      <span class="comment">// -- 准备字段数组</span></span><br><span class="line">      <span class="keyword">const</span> names = [<span class="string">&#x27;mobile&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">      <span class="comment">// -- 仅当所有表单验证通过才是 true</span></span><br><span class="line">      <span class="keyword">const</span> success = <span class="keyword">await</span> <span class="built_in">this</span>.$validator.validateAll(names)</span><br><span class="line">      <span class="keyword">if</span> (success) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// 实现 注册</span></span><br><span class="line">          <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;register&#x27;</span>, &#123; mobile, password, code &#125;)</span><br><span class="line">          <span class="comment">// 路由跳转 -- 登录界面</span></span><br><span class="line">          <span class="built_in">this</span>.$router.replace(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          alert(error.message)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p80-deng-lu">80 登录</span><a href="#p80-deng-lu" class="header-anchor">#</a></h2>
<p>Login</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  &lt;div class&#x3D;&quot;input-text clearFix&quot;&gt;</span><br><span class="line">    &lt;span class&#x3D;&quot;pwd&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; placeholder&#x3D;&quot;请输入密码&quot; v-model&#x3D;&quot;password&quot; &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;setting clearFix&quot;&gt;</span><br><span class="line">    &lt;label class&#x3D;&quot;checkbox inline&quot;&gt;</span><br><span class="line">      &lt;input name&#x3D;&quot;m1&quot; type&#x3D;&quot;checkbox&quot; value&#x3D;&quot;2&quot; checked&#x3D;&quot;&quot; &#x2F;&gt;</span><br><span class="line">      自动登录</span><br><span class="line">    &lt;&#x2F;label&gt;</span><br><span class="line">    &lt;span class&#x3D;&quot;forget&quot;&gt;忘记密码？&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;button class&#x3D;&quot;btn&quot; @click.prevent&#x3D;&quot;login&quot;&gt;登&amp;nbsp;&amp;nbsp;录&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure>
<p>script</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      mobile: <span class="string">&#x27;13700000000&#x27;</span>,</span><br><span class="line">      password: <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">async</span> login() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; mobile, password &#125; = <span class="built_in">this</span></span><br><span class="line">      <span class="comment">// 简单的验证</span></span><br><span class="line">      <span class="keyword">if</span> (mobile === <span class="string">&#x27;&#x27;</span> || password === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&#x27;请输入手机号码或者密码&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 手机号码和密码都已经收到</span></span><br><span class="line">      <span class="comment">// 分发action</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;login&#x27;</span>, &#123; mobile, password &#125;)</span><br><span class="line">        <span class="built_in">this</span>.$router.replace(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        alert(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p81-deng-lu-zhi-hou-xian-shi-yong-hu-ming">81 登录之后显示用户名</span><a href="#p81-deng-lu-zhi-hou-xian-shi-yong-hu-ming" class="header-anchor">#</a></h2>
<p>Header 7</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>商城欢迎您！<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;userInfo.name&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; userInfo.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>请<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  ...mapState(&#123;</span><br><span class="line">    userInfo: <span class="function"><span class="params">state</span> =&gt;</span> state.user.userInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>保存登录信息 user.js 刷新不会掉线</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">state: &#123;</span><br><span class="line">  <span class="comment">// 1 将token放在缓存中</span></span><br><span class="line">  userInfo: <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;user_info_key&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>),</span><br><span class="line">    </span><br><span class="line">actions: &#123;</span><br><span class="line">  <span class="comment">// 登陆</span></span><br><span class="line">  <span class="keyword">async</span> login(&#123; commit &#125;, &#123; mobile, password &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqLogin(mobile, password)</span><br><span class="line">    <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> userInfo = result.data</span><br><span class="line">      commit(<span class="string">&#x27;RECEIVE_USER_INFO&#x27;</span>, userInfo)</span><br><span class="line">      <span class="comment">// 2 缓存</span></span><br><span class="line">      <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;user_info_key&#x27;</span>, <span class="built_in">JSON</span>.stringify(userInfo))</span><br></pre></td></tr></table></figure>
<h2><span id="p82-token">82 token</span><a href="#p82-token" class="header-anchor">#</a></h2>
<p>user.js +</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state</span></span><br><span class="line">userInfo: <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;user_info_key&#x27;</span>) || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ajax 请求拦截器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 token</span></span><br><span class="line"><span class="keyword">const</span> token = store.state.user.userInfo.token</span><br><span class="line"><span class="comment">// 判断 token 是否存在</span></span><br><span class="line"><span class="keyword">if</span> (token) &#123;</span><br><span class="line">  config.headers[<span class="string">&#x27;token&#x27;</span>] = token</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p83-deng-chu">83 登出</span><a href="#p83-deng-chu" class="header-anchor">#</a></h2>
<p>Header 13</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>methods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">logout()&#123;</span><br><span class="line">  this.$store.dispatch(&#39;logout&#39;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>store/modules/user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空用户信息数据（退出）</span></span><br><span class="line">RESET_USER_INFO(state) &#123;</span><br><span class="line">  state.userInfo = &#123;&#125;</span><br><span class="line">  <span class="comment">// 清空浏览器中缓存信息中的用户信息</span></span><br><span class="line">  <span class="built_in">localStorage</span>.removeItem(<span class="string">&#x27;user_info_key&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-28-ri-day-9">9月28日（day 9）</span><a href="#9-yue-28-ri-day-9" class="header-anchor">#</a></h1>
<h2><span id="p84-da-jian-lu-you-he-tiao-zhuan">84 搭建路由和跳转</span><a href="#p84-da-jian-lu-you-he-tiao-zhuan" class="header-anchor">#</a></h2>
<p>拷贝四个路由组件到 pages</p>
<p><code>@\router\routes.js</code> 引入四路由组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Trade <span class="keyword">from</span> <span class="string">&#x27;@/pages/Trade&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Pay <span class="keyword">from</span> <span class="string">&#x27;@/pages/Pay&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PaySuccess <span class="keyword">from</span> <span class="string">&#x27;@/pages/PaySuccess&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Center <span class="keyword">from</span> <span class="string">&#x27;@/pages/Center&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Trade</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/trade&#x27;</span>,</span><br><span class="line">    component: Trade</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Pay</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/pay&#x27;</span>,</span><br><span class="line">    component: Pay</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// PaySuccess</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/paysuccess&#x27;</span>,</span><br><span class="line">    component: PaySuccess</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Center</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/center&#x27;</span>,</span><br><span class="line">    component: Center</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>Header 修改跳转链接（路由链接）  我的订单 21行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;typeList&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/center&quot;</span>&gt;</span>我的订单<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/shopcart&quot;</span>&gt;</span>我的购物车<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p85-wo-de-ding-dan-xie-jie-kou">85 我的订单写接口</span><a href="#p85-wo-de-ding-dan-xie-jie-kou" class="header-anchor">#</a></h2>
<p>写接口 <code>api/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取订单的详情信息数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqTradeInfo = <span class="function">() =&gt;</span> ajax.get(<span class="string">&#x27;/order/auth/trade&#x27;</span>)</span><br><span class="line"><span class="comment">// 获取订单的列表信息数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqOrderList = <span class="function">(<span class="params">page, limit</span>) =&gt;</span></span><br><span class="line">  ajax.get(<span class="string">`/order/auth/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交订单</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqSubmitOrder = <span class="function">(<span class="params">tradeNo, orderInfo</span>) =&gt;</span></span><br><span class="line">  ajax(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>, <span class="comment">// 请求方式</span></span><br><span class="line">    url: <span class="string">&#x27;/order/auth/submitOrder&#x27;</span>, <span class="comment">// 请求地址</span></span><br><span class="line">    params: &#123; tradeNo &#125;, <span class="comment">// 参数</span></span><br><span class="line">    data: orderInfo <span class="comment">// 数据参数</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取订单支付信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqPayInfo = <span class="function"><span class="params">orderId</span> =&gt;</span></span><br><span class="line">  ajax.get(<span class="string">`/payment/weixin/createNative/<span class="subst">$&#123;orderId&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询支付状态</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqPayStatus = <span class="function"><span class="params">orderId</span> =&gt;</span></span><br><span class="line">  ajax.get(<span class="string">`/payment/weixin/queryPayStatus/<span class="subst">$&#123;orderId&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="p86-er-ji-lu-you">86 二级路由</span><a href="#p86-er-ji-lu-you" class="header-anchor">#</a></h2>
<p>结构和样式一起带走，图片</p>
<p>pages/Center 新建 MyOrder 和 GroupBuy 新建 index.vue</p>
<p>MyOrder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;order-content&quot;&gt;</span><br><span class="line">...</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;MyOrder&#39;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;</span><br><span class="line">&#x2F;&#x2F;订单部分</span><br><span class="line">.order-content &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>GroupBuy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;111111&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;h2&gt;111111&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;h2&gt;111111&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;h2&gt;111111&lt;&#x2F;h2&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;GroupBuy&#39;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>Center 58行 剪切（加路由视图） ，以及下面样式 以及图片 到 MyOrder</p>
<p>第9行加路由链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dd&gt;</span><br><span class="line">  &lt;router-link to&#x3D;&quot;&#x2F;center&#x2F;myorder&quot;&gt;我的订单&lt;&#x2F;router-link&gt;</span><br><span class="line">&lt;&#x2F;dd&gt;</span><br><span class="line">&lt;dd&gt;</span><br><span class="line">  &lt;router-link to&#x3D;&quot;&#x2F;center&#x2F;groupbuy&quot;&gt;团购订单&lt;&#x2F;router-link&gt;</span><br></pre></td></tr></table></figure>
<p>路由中引入并创建二级路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Center <span class="keyword">from</span> <span class="string">&#x27;@/pages/Center&#x27;</span></span><br><span class="line"><span class="keyword">import</span> MyOrder <span class="keyword">from</span> <span class="string">&#x27;@/pages/Center/MyOrder&#x27;</span></span><br><span class="line"><span class="keyword">import</span> GroupBuy <span class="keyword">from</span> <span class="string">&#x27;@/pages/Center/GroupBuy&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Center</span></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/center&#x27;</span>,</span><br><span class="line">    component: Center,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/center/myorder&#x27;</span>,</span><br><span class="line">        component: MyOrder</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        path: <span class="string">&#x27;/center/groupbuy&#x27;</span>,</span><br><span class="line">        component: GroupBuy</span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        path: <span class="string">&#x27;/center&#x27;</span>,</span><br><span class="line">        redirect: <span class="string">&#x27;/center/myorder&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p87-xian-shi-ding-dan">87 显示订单</span><a href="#p87-xian-shi-ding-dan" class="header-anchor">#</a></h2>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入api接口并绑定在Vue原型对象上</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> API <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line">Vue.prototype.$API = API</span><br></pre></td></tr></table></figure>
<p>MyOrder</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;MyOrder&#x27;</span>,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      pageNo: <span class="number">1</span>, <span class="comment">// 默认第一页</span></span><br><span class="line">      limit: <span class="number">10</span>, <span class="comment">// 每页的条数</span></span><br><span class="line">      total: <span class="number">0</span>, <span class="comment">// 总条数数据</span></span><br><span class="line">      orders: [] <span class="comment">// 存储当前每页的订单信息数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="built_in">this</span>.getMyOrderList()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 获取订单信息数据列表</span></span><br><span class="line">    <span class="keyword">async</span> getMyOrderList() &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="built_in">this</span>.$API.reqOrderList(<span class="built_in">this</span>.pageNo, <span class="built_in">this</span>.limit)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; records, total &#125; = result.data</span><br><span class="line">        <span class="comment">// 更新数据</span></span><br><span class="line">        <span class="built_in">this</span>.total = total</span><br><span class="line">        <span class="built_in">this</span>.orders = records</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>20行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;orders&quot;&gt;</span><br><span class="line">  &lt;!-- 这是订单 --&gt;</span><br><span class="line">  &lt;table class&#x3D;&quot;order-item&quot; v-for&#x3D;&quot;(item, index) in orders&quot; :key&#x3D;&quot;item.id&quot;&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">      &lt;tr&gt;</span><br><span class="line">        &lt;th colspan&#x3D;&quot;5&quot;&gt;</span><br><span class="line">          &lt;span class&#x3D;&quot;ordertitle&quot;</span><br><span class="line">            &gt;&#123;&#123; item.createTime &#125;&#125; 订单编号：&#123;&#123; item.outTradeNo &#125;&#125;</span><br><span class="line">            &lt;span class&#x3D;&quot;pull-right delete&quot;</span><br><span class="line">              &gt;&lt;img src&#x3D;&quot;.&#x2F;images&#x2F;delete.png&quot;&#x2F;&gt;&lt;&#x2F;span</span><br><span class="line">          &gt;&lt;&#x2F;span&gt;</span><br><span class="line">        &lt;&#x2F;th&gt;</span><br><span class="line">      &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;thead&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">      &lt;tr v-for&#x3D;&quot;(goods, index) in item.orderDetailList&quot; :key&#x3D;&quot;goods.id&quot;&gt;</span><br><span class="line">        &lt;td width&#x3D;&quot;60%&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;typographic&quot;&gt;</span><br><span class="line">            &lt;img :src&#x3D;&quot;goods.imgUrl&quot; &#x2F;&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;block-text&quot;&gt;&#123;&#123; goods.skuName &#125;&#125;&lt;&#x2F;a&gt;</span><br><span class="line">            &lt;span&gt;x&#123;&#123; goods.skuNum &#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;service&quot;&gt;售后申请&lt;&#x2F;a&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;td&gt;</span><br><span class="line">        &lt;template v-if&#x3D;&quot;index &#x3D;&#x3D;&#x3D; 0&quot;&gt;</span><br><span class="line">          &lt;td</span><br><span class="line">            :rowspan&#x3D;&quot;item.orderDetailList.length&quot;</span><br><span class="line">            width&#x3D;&quot;8%&quot;</span><br><span class="line">            class&#x3D;&quot;center&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;&#123; item.consignee &#125;&#125;</span><br><span class="line">          &lt;&#x2F;td&gt;</span><br><span class="line">          &lt;td</span><br><span class="line">            :rowspan&#x3D;&quot;item.orderDetailList.length&quot;</span><br><span class="line">            width&#x3D;&quot;13%&quot;</span><br><span class="line">            class&#x3D;&quot;center&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;ul class&#x3D;&quot;unstyled&quot;&gt;</span><br><span class="line">              &lt;li&gt;总金额¥&#123;&#123; item.totalAmount &#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">              &lt;li&gt;</span><br><span class="line">                &#123;&#123; item.paymentWay &#x3D;&#x3D;&#x3D; &#39;ONLINE&#39; ? &#39;在线支付&#39; : &#39;货到付款&#39; &#125;&#125;</span><br><span class="line">              &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;&#x2F;ul&gt;</span><br><span class="line">          &lt;&#x2F;td&gt;</span><br><span class="line">          &lt;td</span><br><span class="line">            :rowspan&#x3D;&quot;item.orderDetailList.length&quot;</span><br><span class="line">            width&#x3D;&quot;8%&quot;</span><br><span class="line">            class&#x3D;&quot;center&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;btn&quot;</span><br><span class="line">              &gt;&#123;&#123; item.orderStatus &#x3D;&#x3D;&#x3D; &#39;UNPAID&#39; ? &#39;未支付&#39; : &#39;已完成&#39; &#125;&#125;</span><br><span class="line">            &lt;&#x2F;a&gt;</span><br><span class="line">          &lt;&#x2F;td&gt;</span><br><span class="line">          &lt;td</span><br><span class="line">            :rowspan&#x3D;&quot;item.orderDetailList.length&quot;</span><br><span class="line">            width&#x3D;&quot;13%&quot;</span><br><span class="line">            class&#x3D;&quot;center&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;ul class&#x3D;&quot;unstyled&quot;&gt;</span><br><span class="line">              &lt;li&gt;</span><br><span class="line">                &lt;a href&#x3D;&quot;mycomment.html&quot; target&#x3D;&quot;_blank&quot;&gt;评价|晒单&lt;&#x2F;a&gt;</span><br><span class="line">              &lt;&#x2F;li&gt;</span><br><span class="line">            &lt;&#x2F;ul&gt;</span><br><span class="line">          &lt;&#x2F;td&gt;</span><br><span class="line">        &lt;&#x2F;template&gt;</span><br><span class="line">      &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;tbody&gt;</span><br><span class="line">  &lt;&#x2F;table&gt;</span><br></pre></td></tr></table></figure>
<p>样式修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.typographic &#123;</span><br><span class="line">  img &#123;</span><br><span class="line">    float: left;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    width: 100px;</span><br><span class="line">    height: 100px;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p88-fen-ye">88 分页</span><a href="#p88-fen-ye" class="header-anchor">#</a></h2>
<p>MyOrder 89行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Pagination</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:pageConfig</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">    total,</span></span></span><br><span class="line"><span class="tag"><span class="string">    pageNo,</span></span></span><br><span class="line"><span class="tag"><span class="string">    pageSize: limit,</span></span></span><br><span class="line"><span class="tag"><span class="string">    showPageNo: 5</span></span></span><br><span class="line"><span class="tag"><span class="string">  &#125;&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">changeCurrentPage</span>=<span class="string">&quot;getMyOrderList&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改 117行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取订单信息数据列表</span></span><br><span class="line"><span class="keyword">async</span> getMyOrderList(pageNo = <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="built_in">this</span>.pageNo = pageNo</span><br></pre></td></tr></table></figure>
<p>去掉后面的样式 <code>.choose-order</code></p>
<h2><span id="p89-jie-suan-zhi-qian">89 结算之前</span><a href="#p89-jie-suan-zhi-qian" class="header-anchor">#</a></h2>
<p>ShopCart 105行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 结算 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/trade&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sum-btn&quot;</span>&gt;</span>结算<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>store新建order.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reqPayInfo, reqTradeInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    tradeInfo: &#123;&#125;, <span class="comment">// 订单信息数据对象</span></span><br><span class="line">    payInfo: &#123;&#125; <span class="comment">// 支付信息数据对象</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    <span class="comment">// 直接更新订单数据</span></span><br><span class="line">    RECEIVE_TRADE_INFO(state, &#123; tradeInfo &#125;) &#123;</span><br><span class="line">      state.tradeInfo = tradeInfo</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 直接更新支付数据</span></span><br><span class="line">    RECEIVE_PAY_INFO(state, &#123; payInfo &#125;) &#123;</span><br><span class="line">      state.payInfo = payInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 获取订单的数据</span></span><br><span class="line">    <span class="keyword">async</span> getTradeInfo(&#123; commit &#125;) &#123;</span><br><span class="line">      <span class="comment">// 调用接口获取数据</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqTradeInfo()</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> tradeInfo = result.data</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_TRADE_INFO&#x27;</span>, &#123; tradeInfo &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 抛错处理</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message || <span class="string">&#x27;获取订单失败了&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 获取支付的数据</span></span><br><span class="line">    <span class="keyword">async</span> getPayInfo(&#123; commit &#125;, orderId) &#123;</span><br><span class="line">      <span class="comment">// 调用接口获取数据</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> reqPayInfo(orderId)</span><br><span class="line">      <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> payInfo = result.data</span><br><span class="line">        commit(<span class="string">&#x27;RECEIVE_PAY_INFO&#x27;</span>, &#123; payInfo &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 抛错处理</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(result.message || <span class="string">&#x27;获取支付信息失败了&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在index中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> home <span class="keyword">from</span> <span class="string">&#x27;./home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./search&#x27;</span></span><br><span class="line"><span class="keyword">import</span> detail <span class="keyword">from</span> <span class="string">&#x27;./detail&#x27;</span></span><br><span class="line"><span class="keyword">import</span> shopcart <span class="keyword">from</span> <span class="string">&#x27;./shopcart&#x27;</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> order <span class="keyword">from</span> <span class="string">&#x27;./order&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  home,</span><br><span class="line">  search,</span><br><span class="line">  detail,</span><br><span class="line">  shopcart,</span><br><span class="line">  user,</span><br><span class="line">  order</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p90-bian-li-shou-jian-ren-xiang-guan-xin-xi">90 遍历收件人相关信息</span><a href="#p90-bian-li-shou-jian-ren-xiang-guan-xin-xi" class="header-anchor">#</a></h2>
<p>Trade 6</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;address clearFix&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">&quot;(addr, index) in tradeInfo.userAddressList&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">&quot;addr.id&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;&#123; selected: selectedAddress === addr &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>&#123;&#123; addr.consignee &#125;&#125;<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;selectedAddress = addr&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;s1&quot;</span>&gt;</span>&#123;&#123; addr.userAddress &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;s2&quot;</span>&gt;</span>&#123;&#123; addr.phoneNum &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;s3&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;addr.isDefault === &#x27;1&#x27;&quot;</span>&gt;</span>默认地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Trade&#x27;</span>,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      selectedAddress: &#123;&#125; <span class="comment">// 用来储存选中是收件人的用户信息地址对象</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="comment">// 获取当前订单信息</span></span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getTradeInfo&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      tradeInfo: <span class="function"><span class="params">state</span> =&gt;</span> state.order.tradeInfo</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="comment">// 监视的是收件人信息数组</span></span><br><span class="line">    <span class="string">&#x27;tradeInfo.userAddressList&#x27;</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 从数组中查找isDefault属性为1的对象</span></span><br><span class="line">      <span class="keyword">const</span> defaultAddr = value.find(<span class="function"><span class="params">addr</span> =&gt;</span> addr.isDefault === <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">      <span class="comment">// 判断这个对象是否存在</span></span><br><span class="line">      <span class="keyword">if</span> (defaultAddr) &#123;</span><br><span class="line">        <span class="comment">// 保存起来</span></span><br><span class="line">        <span class="built_in">this</span>.selectedAddress = defaultAddr</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p91-bian-li-shang-pin-lie-biao">91 遍历商品列表</span><a href="#p91-bian-li-shang-pin-lie-biao" class="header-anchor">#</a></h2>
<p>Trade 37</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>商品清单<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;list clearFix&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">&quot;(goods, index) in tradeInfo.detailArrayList&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">&quot;goods.skuId&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;goods.imgUrl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">              &#123;&#123; goods.skuName &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h4</span>&gt;</span>7天无理由退货<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>￥&#123;&#123; goods.orderPrice &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>X&#123;&#123; goods.skuNum &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>有货<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bbs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>买家留言：<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span></span></span><br><span class="line"><span class="tag">          <span class="attr">placeholder</span>=<span class="string">&quot;建议留言前先与商家沟通确认&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;remarks-cont&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;line&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bill&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>发票信息：<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>普通发票（电子） 个人 明细<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span>使用优惠/抵用<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;money clearFix&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">b</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>&#123;&#123; tradeInfo.totalNum &#125;&#125;<span class="tag">&lt;/<span class="name">i</span></span></span><br><span class="line"><span class="tag">            &gt;</span>件商品，总商品金额<span class="tag">&lt;/<span class="name">b</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>¥&#123;&#123; tradeInfo.totalAmount &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">b</span>&gt;</span>返现：<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>0.00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">b</span>&gt;</span>运费：<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>0.00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;trade&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;price&quot;</span>&gt;</span></span><br><span class="line">        应付金额: <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; tradeInfo.totalAmount &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;receiveInfo&quot;</span>&gt;</span></span><br><span class="line">        寄送至:</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; selectedAddress.userAddress &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        收货人：<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; selectedAddress.consignee &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; selectedAddress.phoneNum &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sub clearFix&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;router-link class=&quot;subBtn&quot; to=&quot;/pay&quot;&gt;提交订单&lt;/router-link&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;subBtn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;pay&quot;</span>&gt;</span>提交订单<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Trade 263</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.list &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  background-color: #feedef;</span><br><span class="line">  margin: <span class="number">5</span>px <span class="number">0</span>;</span><br><span class="line">  li &#123;</span><br><span class="line">    line-height: <span class="number">30</span>px;</span><br><span class="line">    img&#123;</span><br><span class="line">      width: <span class="number">100</span>px;</span><br><span class="line">      height: <span class="number">100</span>px;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p92-lu-you-props-chuan-can">92 路由props传参</span><a href="#p92-lu-you-props-chuan-can" class="header-anchor">#</a></h2>
<p>Trade</p>
<p>更新 pay</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 支付</span></span><br><span class="line">  pay() &#123;</span><br><span class="line">    <span class="comment">// 获取订单编号，商品列表数据</span></span><br><span class="line">    <span class="keyword">const</span> &#123; tradeNo, detailArrayList &#125; = <span class="built_in">this</span>.tradeInfo</span><br><span class="line">    <span class="comment">// 收件人名字，电话，地址</span></span><br><span class="line">    <span class="keyword">const</span> &#123; consignee, phoneNum, userAddress &#125; = <span class="built_in">this</span>.selectedAddress</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> orderInfo = &#123;</span><br><span class="line">      consignee, <span class="comment">// 收件人</span></span><br><span class="line">      consigneeTel: phoneNum, <span class="comment">// 收件人的电话</span></span><br><span class="line">      deliveryAddress: userAddress, <span class="comment">// 收件人的地址</span></span><br><span class="line">      paymentWay: <span class="string">&#x27;ONLINE&#x27;</span>, <span class="comment">// 支付方式</span></span><br><span class="line">      orderComment: <span class="built_in">this</span>.orderComment, <span class="comment">// 订单的备注</span></span><br><span class="line">      orderDetailList: detailArrayList <span class="comment">// 商品列表数据</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$API</span><br><span class="line">      .reqSubmitOrder(tradeNo, orderInfo)</span><br><span class="line">      .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 接口调用成功，路由跳转，并传参，query的方式传参</span></span><br><span class="line">        <span class="comment">// 订单提交成功后，返回的是订单的id</span></span><br><span class="line">        <span class="keyword">const</span> orderId = result.data</span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/pay&#x27;</span>, <span class="attr">query</span>: &#123; orderId &#125; &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        alert(error.mess)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>新增 <code>orderComment</code> 数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    selectedAddress: &#123;&#125;, <span class="comment">// 用来储存选中是收件人的用户信息地址对象</span></span><br><span class="line">    orderComment: <span class="string">&#x27;这是文本&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>66行 新增 v-model</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bbs&quot;</span>&gt;</span><br><span class="line">  &lt;h5&gt;买家留言：&lt;/h5&gt;</span><br><span class="line">  &lt;textarea</span><br><span class="line">    placeholder=<span class="string">&quot;建议留言前先与商家沟通确认&quot;</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;remarks-cont&quot;</span></span><br><span class="line">    v-model=<span class="string">&quot;orderComment&quot;</span></span><br><span class="line">  &gt;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>
<p>Pay 更新</p>
<p>11行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;paymark&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fl&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>请您在提交订单<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;orange time&quot;</span>&gt;</span>4小时<span class="tag">&lt;/<span class="name">em</span></span></span><br><span class="line">    &gt;之内完成支付，超时订单会自动取消。订单号：&lt;em&gt;&#123;&#123;payInfo.orderId&#125;&#125;&lt;&lt;/em&gt;&lt;/span</span><br><span class="line">  &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fr&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;lead&quot;</span>&gt;</span>应付金额：&#123;&#123;payInfo.totalFee&#125;&#125;<span class="tag">&lt;/<span class="name">em</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Pay&#x27;</span>,</span><br><span class="line">  props: [<span class="string">&#x27;orderId&#x27;</span>],</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      payInfo: <span class="function"><span class="params">state</span> =&gt;</span> state.order.payInfo</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="comment">// 分发action</span></span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;getPayInfo&#x27;</span>, <span class="built_in">this</span>.orderId)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>routes.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pay</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/pay&#x27;</span>,</span><br><span class="line">  component: Pay,</span><br><span class="line">  <span class="comment">// 通过props的方式来进行参数的传递,让组件和$route之间的关闭不那么的密切(解耦)</span></span><br><span class="line">  props:<span class="function">(<span class="params">route</span>)=&gt;</span>(&#123;<span class="attr">orderId</span>:route.query.orderId&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h1><span id="9-yue-29-ri-day-10">9月29日（day 10）</span><a href="#9-yue-29-ri-day-10" class="header-anchor">#</a></h1>
<p>需求</p>
<ul>
<li>
<p>只有在登录的情况下才能访问 /trade /pay /center及其子目录</p>
</li>
<li>
<p>只有在没登录的情况下才能进入登录界面，如果登录了自动进入首页</p>
</li>
<li>
<p>只有 skuId /skuNum / skuInfo 数据都存在的情况下才能进入 /addsuccess</p>
</li>
<li>
<p>只有从 /shopcart 才能进入 /trade</p>
</li>
<li>
<p>只有从 /trade 才能进入 /pay</p>
</li>
<li>
<p>只有从 /pay 才能进入 /paysucces</p>
</li>
<li>
<p>如果访问的是 /center 但是没有登录，先跳转到登录界面 登录成功自动进入 /center</p>
</li>
<li>
<p>如果退出，直接进入首页</p>
</li>
</ul>
<p>路由守卫（导航守卫）</p>
<ul>
<li>
<p>全局导航守卫（在实例化路由器对象的时候进行设置）</p>
<p>全局前置导航守卫 beforeEach △</p>
<p>全局解析导航守卫 beforeResolve</p>
<p>全局后置导航守卫 afterEach</p>
</li>
<li>
<p>路由独享守卫（在注册路由组件对象中进行设置）</p>
<p>boforeEnter △</p>
</li>
<li>
<p>组件内的守卫（在组件对象中进行设置）</p>
<p>beforeRouterEnter △</p>
<p>beforeRouteUpdate</p>
<p>beforeRouteLeave</p>
</li>
</ul>
<p>参数</p>
<ul>
<li>to — 目标路由对象</li>
<li>from — 离开前的对象</li>
<li>next — 函数</li>
</ul>
<h2><span id="p93-zhi-you-zai-deng-lu-de-qing-kuang-xia-cai-neng-jin-ru">93 只有在登录的情况下才能进入…</span><a href="#p93-zhi-you-zai-deng-lu-de-qing-kuang-xia-cai-neng-jin-ru" class="header-anchor">#</a></h2>
<p>router/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明使用路由器插件</span></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  mode: <span class="string">&#x27;history&#x27;</span>, <span class="comment">// 地址栏中不带#</span></span><br><span class="line">  routes,</span><br><span class="line">  <span class="comment">// 解决路由器跳转到滚动的位置的问题</span></span><br><span class="line">  scrollBehavior(to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      x: <span class="number">0</span>,</span><br><span class="line">      y: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局前置路由守卫</span></span><br><span class="line"><span class="comment">// router.beforeEach((to, from, next) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   访问的地址不是登录页面，让其跳转到登录页面</span></span><br><span class="line"><span class="comment">//   if (to.path !== &#x27;/login&#x27;) &#123;</span></span><br><span class="line"><span class="comment">//     next(&#x27;/login&#x27;)</span></span><br><span class="line"><span class="comment">//   &#125; else &#123;</span></span><br><span class="line"><span class="comment">//     next()</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局前置路由守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 只有在登录的情况下才能访问 /trade /pay / center //</span></span><br><span class="line">  <span class="comment">// 获取目标路由中的访问地址</span></span><br><span class="line">  <span class="keyword">const</span> targetPath = to.path</span><br><span class="line">  <span class="comment">// 准备一个需要检测的路由的数组</span></span><br><span class="line">  <span class="keyword">const</span> checkPath = [<span class="string">&#x27;/trade&#x27;</span>, <span class="string">&#x27;/pay&#x27;</span>, <span class="string">&#x27;/center&#x27;</span>]</span><br><span class="line">  <span class="comment">// if (checkPath.indexOf(targetPath) !== -1) &#123;</span></span><br><span class="line">  <span class="keyword">if</span> (checkPath.find(<span class="function"><span class="params">path</span> =&gt;</span> targetPath.indexOf(path) !== <span class="number">-1</span>)) &#123;</span><br><span class="line">    <span class="comment">// 判断是否已经登录</span></span><br><span class="line">    <span class="keyword">if</span> (store.state.user.userInfo.token) &#123;</span><br><span class="line">      <span class="comment">// 放行</span></span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 跳转到登录界面</span></span><br><span class="line">      next(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 正常的放行</span></span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化路由器对象,并暴露出去</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p94-zhi-you-zai-mei-deng-lu-de-qing-kuang-xia-cai-neng-jin-ru-deng-lu-jie-mian-ru-guo-deng-lu-liao-zi-dong-jin-ru-shou-ye">94 只有在没登录的情况下才能进入登录界面，如果登录了自动进入首页</span><a href="#p94-zhi-you-zai-mei-deng-lu-de-qing-kuang-xia-cai-neng-jin-ru-deng-lu-jie-mian-ru-guo-deng-lu-liao-zi-dong-jin-ru-shou-ye" class="header-anchor">#</a></h2>
<p>router/routes.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入vuex</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    component: Login,</span><br><span class="line">    <span class="comment">// 参数数据</span></span><br><span class="line">    meta: &#123;</span><br><span class="line">      isHideFooter: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ? 只有在没有登录的情况下才能进入登录页面，已经登录，就进入首页</span></span><br><span class="line">    <span class="comment">// 路由独享守卫</span></span><br><span class="line">    beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断有没有登录</span></span><br><span class="line">      <span class="keyword">if</span> (store.state.user.userInfo.name) &#123;</span><br><span class="line">        next(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>或者在 Login 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 组件内的路由前置守卫</span></span><br><span class="line">  beforeRouteEnter(to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 先判断是否登录</span></span><br><span class="line">      <span class="comment">// ! 不能用 this</span></span><br><span class="line">      <span class="keyword">if</span> (vm.$store.state.user.userInfo.name) &#123;</span><br><span class="line">        next(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2><span id="p95-zhi-you-shu-ju-du-cun-zai-de-qing-kuang-xia-cai-neng-jin-ru-addsuccess">95 只有数据都存在的情况下才能进入 /addsuccess</span><a href="#p95-zhi-you-shu-ju-du-cun-zai-de-qing-kuang-xia-cai-neng-jin-ru-addsuccess" class="header-anchor">#</a></h2>
<p>只有 skuId /skuNum / skuInfo 数据都存在的情况下才能进入 /addsuccess</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddCartSuccess -- query</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/addcartsuccess&#x27;</span>,</span><br><span class="line">  component: AddCartSuccess,</span><br><span class="line">  <span class="comment">// ? 只有参数存在的情况下才能进入这个页面</span></span><br><span class="line">  beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 先获取参数数据</span></span><br><span class="line">    <span class="keyword">const</span> &#123; skuId, skuNum &#125; = to.query</span><br><span class="line">    <span class="keyword">const</span> skuInfo = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;SKU_INFO&#x27;</span>)</span><br><span class="line">    <span class="comment">// 判断这三个数据是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (skuId &amp;&amp; skuNum &amp;&amp; skuInfo) &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 从哪里来，哪里去</span></span><br><span class="line">      next(<span class="keyword">from</span>.path)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p96-zhi-you-cong-cai-neng-jin-ru">96 只有从…才能进入…</span><a href="#p96-zhi-you-cong-cai-neng-jin-ru" class="header-anchor">#</a></h2>
<ul>
<li>只有从 /shopcart 才能进入 /trade</li>
<li>只有从 /trade 才能进入 /pay</li>
<li>只有从 /pay 才能进入 /paysucces</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pay</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/pay&#x27;</span>,</span><br><span class="line">  component: Pay,</span><br><span class="line">  <span class="comment">// 通过props的方式来进行参数的传递,让组件和$route之间的关闭不那么的密切(解耦)</span></span><br><span class="line">  props: <span class="function"><span class="params">route</span> =&gt;</span> (&#123; <span class="attr">orderId</span>: route.query.orderId &#125;),</span><br><span class="line">  <span class="comment">// ? 只有从/trade才能进入/pay</span></span><br><span class="line">  beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">from</span>.path === <span class="string">&#x27;/trade&#x27;</span>) &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(<span class="string">&#x27;/trade&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// PaySuccess</span></span><br><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/paysuccess&#x27;</span>,</span><br><span class="line">  component: PaySuccess,</span><br><span class="line">  <span class="comment">// ? 只有从 /pay 才能进入 / PaySuccess</span></span><br><span class="line">  beforeEnter: <span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">from</span>.path === <span class="string">&#x27;/pay&#x27;</span>) &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(<span class="string">&#x27;/pay&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2><span id="p97-ru-guo-fang-wen-de-shi-center-dan-shi-mei-you-deng-lu">97 如果访问的是 /center 但是没有登录…</span><a href="#p97-ru-guo-fang-wen-de-shi-center-dan-shi-mei-you-deng-lu" class="header-anchor">#</a></h2>
<p>如果访问的是 /center 但是没有登录，先跳转到登录界面 登录成功自动进入 /center</p>
<p>router / index.js 60</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (store.state.user.userInfo.token) &#123;</span><br><span class="line">  <span class="comment">// 放行</span></span><br><span class="line">  next()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 跳转到登录界面</span></span><br><span class="line">  <span class="comment">// ? 如果我访问的是 /center ，但是没有登录，先跳转到登录界面</span></span><br><span class="line">  <span class="comment">// ? 登录成功之后自动进入到 /center 中</span></span><br><span class="line">  next(<span class="string">&#x27;/login?redirect=&#x27;</span> + targetPath)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Login 72</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手机号码和密码都已经收到</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 分发action</span></span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;login&#x27;</span>, &#123; mobile, password &#125;)</span><br><span class="line">  <span class="comment">// 从query中获取储存的参数</span></span><br><span class="line">  <span class="keyword">const</span> &#123; redirect &#125; = <span class="built_in">this</span>.$route.query</span><br><span class="line">  <span class="comment">// 如果query中的redirect中有数据（有目标路径），那么就像这个路径中跳转</span></span><br><span class="line">  <span class="comment">// 如果没有，则直接进入到首页</span></span><br><span class="line">  <span class="built_in">this</span>.$router.replace(redirect || <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  alert(error.message)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Header</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">logout() &#123;</span><br><span class="line">  <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;logout&#x27;</span>)</span><br><span class="line">  <span class="comment">// 如果退出，则直接进入首页</span></span><br><span class="line">  <span class="built_in">this</span>.$router.replace(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p98-an-zhuang-element-ui-bing-yin-ru">98 安装element-ui并引入</span><a href="#p98-an-zhuang-element-ui-bing-yin-ru" class="header-anchor">#</a></h2>
<p>支付需使用组件库</p>
<p>安装 按需引入</p>
<p>npm i element-ui</p>
<p>npm i babel-plugin-component -D</p>
<p><code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [</span><br><span class="line">    <span class="string">&#x27;@vue/cli-plugin-babel/preset&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;component&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;libraryName&quot;</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">        <span class="string">&quot;styleLibraryName&quot;</span>: <span class="string">&quot;theme-chalk&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>utils / elementui.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入Vue</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// 引入element-ui中的部分组件</span></span><br><span class="line"><span class="keyword">import</span> &#123;  MessageBox, Message &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"><span class="comment">// 把相关的组件绑定到Vue的原想上, 组件的实例对象可以直接使用</span></span><br><span class="line">Vue.prototype.$msgbox = MessageBox <span class="comment">// 弹框</span></span><br><span class="line">Vue.prototype.$alert = MessageBox.alert</span><br><span class="line">Vue.prototype.$message = Message</span><br></pre></td></tr></table></figure>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/utils/elementui&#x27;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p99-zhi-fu-yu-er-wei-ma-gong-ju">99 支付与二维码工具</span><a href="#p99-zhi-fu-yu-er-wei-ma-gong-ju" class="header-anchor">#</a></h2>
<p>安装二维码工具（产生二维码）</p>
<p>npm i qrcode</p>
<p>Pay</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入QRCode</span></span><br><span class="line"><span class="keyword">import</span> QRCode <span class="keyword">from</span> <span class="string">&#x27;qrcode&#x27;</span></span><br></pre></td></tr></table></figure>
<p>76</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;router-link class=&quot;btn&quot; to=&quot;/paysuccess&quot;&gt;立即支付&lt;/router-link&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;pay&quot;</span>&gt;</span>立即支付<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">pay() &#123;</span><br><span class="line">  QRCode.toDataURL(<span class="built_in">this</span>.payInfo.codeUrl)</span><br><span class="line">    .then(<span class="function"><span class="params">imgURL</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 这个对话框返回 Promise 对象</span></span><br><span class="line">      <span class="built_in">this</span>.$alert(<span class="string">`&lt;img src=&quot;<span class="subst">$&#123;imgURL&#125;</span>&quot;&gt;`</span>, <span class="string">&#x27;请使用微信扫码字符&#x27;</span>, &#123;</span><br><span class="line">        dangerouslyUseHTMLString: <span class="literal">true</span>, <span class="comment">// 是否第一个参数用html解析</span></span><br><span class="line">        showClose: <span class="literal">false</span>, <span class="comment">// 是否显示关闭小图标（右上角）</span></span><br><span class="line">        showCancelButton: <span class="literal">true</span>, <span class="comment">// 是否显示取消按钮</span></span><br><span class="line">        showConfirmButton: <span class="literal">true</span>, <span class="comment">// 是否显示确定按钮</span></span><br><span class="line">        cancelButtonText: <span class="string">&#x27;支付中遇到问题&#x27;</span>, <span class="comment">// 取消按钮的文本</span></span><br><span class="line">        confirmButtonText: <span class="string">&#x27;我已成功支付&#x27;</span>, <span class="comment">// 确定按钮的文本</span></span><br><span class="line">        center: <span class="literal">true</span> <span class="comment">// 是否居中显示</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 清理定时器</span></span><br><span class="line">          <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timeId)</span><br><span class="line">          <span class="comment">// 关闭当前对话框</span></span><br><span class="line">          <span class="built_in">this</span>.$msgbox.close()</span><br><span class="line">          <span class="comment">// 提示信息</span></span><br><span class="line">          <span class="built_in">this</span>.$message.success(<span class="string">&#x27;恭喜支付成功&#x27;</span>)</span><br><span class="line">          <span class="comment">// 路由跳转</span></span><br><span class="line">          <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/paysuccess&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.$message.warning(<span class="string">&#x27;请迅速联系破晓小姐姐退钱！&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.timeId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$API</span><br><span class="line">          .reqPayStatus(<span class="built_in">this</span>.orderId)</span><br><span class="line">          .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 是否支付成功</span></span><br><span class="line">            <span class="keyword">if</span> (result.code === <span class="number">200</span>) &#123;</span><br><span class="line">              <span class="comment">// 清理定时器</span></span><br><span class="line">              <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timeId)</span><br><span class="line">              <span class="comment">// 关闭当前对话框</span></span><br><span class="line">              <span class="built_in">this</span>.$msgbox.close()</span><br><span class="line">              <span class="comment">// 提示信息</span></span><br><span class="line">              <span class="built_in">this</span>.$message.success(<span class="string">&#x27;恭喜支付成功&#x27;</span>)</span><br><span class="line">              <span class="comment">// 路由跳转</span></span><br><span class="line">              <span class="built_in">this</span>.$router.push(<span class="string">&#x27;/paysuccess&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 清理定时器</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timeId)</span><br><span class="line">            <span class="built_in">this</span>.$message.error(error.message || <span class="string">&#x27;支付失败&#x27;</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$message.error(<span class="string">&#x27;支付二维码生成失败&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, </span><br><span class="line"><span class="comment">// end</span></span><br></pre></td></tr></table></figure>
<h2><span id="p100-lie-biao-guo-du-xiao-guo">100 列表过渡效果</span><a href="#p100-lie-biao-guo-du-xiao-guo" class="header-anchor">#</a></h2>
<p>TypeNav 7</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;move&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 这里加了一个点击事件（事件委托） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sort&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toSearch&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;isShowFirst&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>less</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sort</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">45px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">210px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">461px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fafafa</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-class">.move-enter-active</span>,</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-class">.move-leave-active</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-class">.move-enter</span>,</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-class">.move-leave-to</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2><span id="p101-tu-pian-lan-jia-zai">101 图片懒加载</span><a href="#p101-tu-pian-lan-jia-zai" class="header-anchor">#</a></h2>
<p>安装 懒加载 插件</p>
<p><code>npm install vue-lazyload --save-dev</code></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/rachelch/p/9802227.html">https://www.cnblogs.com/rachelch/p/9802227.html</a></p>
<p>找个 图片放 assets/ljz.gif 目录</p>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入懒加载的插件</span></span><br><span class="line"><span class="keyword">import</span> VueLazyload <span class="keyword">from</span> <span class="string">&#x27;vue-lazyload&#x27;</span></span><br><span class="line"><span class="keyword">import</span> loading <span class="keyword">from</span> <span class="string">&#x27;./assets/ljz.gif&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueLazyload, &#123;</span><br><span class="line">  loading</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Search 78</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;`/detail/$&#123;goods.id&#125;`&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-lazy</span>=<span class="string">&quot;goods.defaultImg&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2><span id="p102-lu-you-lan-jia-zai">102  路由懒加载</span><a href="#p102-lu-you-lan-jia-zai" class="header-anchor">#</a></h2>
<p>router / routes.js</p>
<pre class="line-numbers language-language-js"><code class="language-language-js">// 路由的懒加载
// import GroupBuy from '@/pages/Center/GroupBuy'
const GroupBuy =() => import('@/pages/Center/GroupBuy')
`
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Vue/" rel="tag"><i class="fa fa-tag"></i> Vue</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/182001/" rel="prev" title="Kindle 使用教程">
      <i class="fa fa-chevron-left"></i> Kindle 使用教程
    </a></div>
      <div class="post-nav-item">
    <a href="/730201/" rel="next" title="歌词 / なごり雪">
      歌词 / なごり雪 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月16日（day 0）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">0 开发所需</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">1 新建项目并安装项目依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">2 项目目录配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">3 配置主入口文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">4 配置根组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">5 新建组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">6 配置路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">7 注册路由器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月18日（day 1）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">8 加载路由视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">9 路由中添加参数数据，更新视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">10 index.html 加入样式文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">11 拆分静态页面之一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">12 拆分静态页面之二</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">13 新建 TypeNav 组件 并注册为公共组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">14 拆分静态页面之三</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">15 拆分静态页面之四</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">16 加几个路由链接（声明式路由跳转）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">17 点击搜索后跳转 search（编程式路由跳转）  △</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">18 重写 push 和 replace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">19 路由传参（params） △</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">20 二次封装 axios △</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">21 vue.config.js &#x2F; eslint 设置 &#x2F; 跨域代理设置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月19日（day 2）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">22 store 搭建和注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">23 Vuex 之 modules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">24 Home组件相关的 store</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">25 遍历 TypeNav 三级分类数据并显示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">26 鼠标移入移出效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">27 按需引入lodash中节流函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">28 query方式路由传参 + 事件委托（冒泡） △</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">29 Search 页面添加 TypeNav</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">30 引入 mockJS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">31 mock相关数据加入 store 中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">32 Swiper 实现轮播图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月21日（day 3）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">33 项目优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">34 轮播图与数据加载与渲染，Swiper对象创建时机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">35 Floor 视图生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">36 轮播图封装为公共组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">37 修复轮播图问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">38 Search 组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">39 遍历商品分类信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月22日（day 4）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">40 Search 组件显示商品信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">41 解决一个跳转bug</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">42 Search 分发时传入参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">43 点击标签的移除以及地址的修正</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">44 点击品牌标签进行筛选</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">45 平台属性相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">46 排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">47 清理空数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月23日（day 5）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">48 分页组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">49 自己实现分页组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">50 没有数据的时候，分页组件的相关处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">51 商品详情页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">52 商品详情页-接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">53 封装 Vuex</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">54 显示基本信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">55 遍历销售属性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月24日（day 6）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">56 数量的增加和减少操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">57 显示详情图片（轮播）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">58 引入轮播图组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">59 放大镜1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">60 放大镜2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">61 添加购物车成功</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">62 封装api接口函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">63 回调函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">64 dispatch 返回 Promise</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">65 AddCartSuccess 更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">66 购物车</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">67 生成临时用户id</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月25日（day 7）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">68 获取购物车数据（封装api + vuex）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">69 渲染购物车内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">69 渲染购物车界面2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">70 购物车删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">71 清空购物车</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">72 切换选中状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">73 全选&#x2F;全不选</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">74 数量操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">75 登陆&#x2F;注册&#x2F;退出 api接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月27日（day 8）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">76 vuex封装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">77 注册1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">78 表单验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">79 表单验证2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">80 登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">81 登录之后显示用户名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">82 token</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">83 登出</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月28日（day 9）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">84 搭建路由和跳转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">85 我的订单写接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">86 二级路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">87 显示订单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">88 分页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">89 结算之前</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">90 遍历收件人相关信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">91 遍历商品列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">92 路由props传参</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">9月29日（day 10）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">93 只有在登录的情况下才能进入…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">94 只有在没登录的情况下才能进入登录界面，如果登录了自动进入首页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">95 只有数据都存在的情况下才能进入 &#x2F;addsuccess</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">96 只有从…才能进入…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">97 如果访问的是 &#x2F;center 但是没有登录…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">98 安装element-ui并引入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">99 支付与二维码工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">100 列表过渡效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">101 图片懒加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">102  路由懒加载</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">KEEL</p>
  <div class="site-description" itemprop="description">这个人很懒，什么都没留下。 </div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">KEEL</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">385k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:50</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

</body>
</html>
